import{j as ze,d as f,h as Ee,r as $e,w as ue,$ as _,a1 as l,_ as v,n as e,y as r,V as p,Z as b,a0 as D,aa as i,a6 as Ve,ac as Ne,ad as Ge,ai as Ae,F as xe,ah as ke,q as _e,D as Pe,u as de,U as je,Y as Le,v as Oe,ab as Me}from"./vendor-vue-BKuzT1x2.js";import{r as q}from"./rule-templates-B0ScTQqJ.js";import{r as Ke}from"./rules-DAo5MLov.js";import{u as Je}from"./useDemoMode-DpDjlFnd.js";import{v as He,a as c,b as y,c as he,_ as Re}from"./index-gFSB3kms.js";import{V as Ie}from"./VDialog-BfRWf8LZ.js";import{V as Qe}from"./VForm-DthKd8zl.js";import{V as se,a as g}from"./VRow-C_u8820H.js";import{V as J,a as B}from"./VSelect-BorMXFwi.js";import{V as Y,c as Ye,a as te,b as Ze}from"./VList-Dg4abNUz.js";import{a as k,b as We,V as Xe}from"./VChip-BfcyEr4e.js";import{V as ae}from"./VTextarea-CqCSgYZa.js";import{V as T,a as oe,b as R,c as el}from"./VGrid-CBGRWS1y.js";import{V as me}from"./VSwitch-D3bnvThN.js";import{V as ll}from"./VPagination-B83tja3x.js";import{V as tl}from"./VMenu-BCjbZdow.js";import{V as al}from"./VSpacer-CTPiANoM.js";import"./auth.service-BozCwdnf.js";import"./vendor-utils-6xD0fNU8.js";import"./token-storage.service-BqAv9k07.js";import"./auth--EmZq-C7.js";import"./vendor-ui-Ca7vMALJ.js";import"./dialog-transition-B8nu4acL.js";import"./form-PEXhLZdP.js";import"./autofocus-Cv2p5X6o.js";import"./ssrBoot-DJyMk-ri.js";const ol={class:"dialog-header"},sl={class:"dialog-header-content"},il={class:"dialog-icon-wrapper"},rl={class:"dialog-title-section"},nl={class:"dialog-title"},dl={class:"dialog-subtitle"},ul={class:"dialog-content"},ml={key:0,class:"text-center py-8"},cl={key:1,class:"text-center py-8"},vl={class:"text-body-2 text-grey-darken-1 mb-4"},pl={class:"d-flex align-start gap-2 mb-3"},gl={key:0,class:"d-flex flex-wrap gap-2"},fl={key:1,class:"text-body-2 text-grey-darken-1 mt-2"},yl={class:"d-flex align-start gap-2 mb-3"},bl={key:0,class:"d-flex flex-wrap gap-2"},Vl={key:1,class:"text-body-2 text-grey-darken-1 mt-2"},xl={class:"d-flex align-center gap-4"},kl={class:"dialog-footer"},_l={class:"dialog-actions"},Cl=ze({__name:"RuleTemplateFormDialog",props:{modelValue:{type:Boolean},templateId:{default:null}},emits:["update:modelValue","saved"],setup(ce,{emit:ie}){const w=ce,I=ie,U=f(),L=f(!1),O=f(!1),F=f(!1),$=f(null),S=f(null),N=He(),x=f(""),h=f(""),V=Ee(()=>!!w.templateId),a=$e({title:"",rule:"",whyIsThisImportant:"",severity:"medium",badExample:"",goodExample:"",language:"general",buckets:[],scope:"file",category:"",isActive:!0,isGlobal:!0,version:"1.0.0",author:"",tags:[],description:""}),G=[{title:"JavaScript",value:"javascript"},{title:"TypeScript",value:"typescript"},{title:"Python",value:"python"},{title:"Java",value:"java"},{title:"PHP",value:"php"},{title:"Go",value:"go"},{title:"Rust",value:"rust"},{title:"C#",value:"csharp"},{title:"Geral",value:"general"}],Z=[{title:"Baixa",value:"low"},{title:"Média",value:"medium"},{title:"Alta",value:"high"},{title:"Crítica",value:"critical"}],M=[{title:"Pull Request",value:"pull-request"},{title:"Arquivo",value:"file"},{title:"Projeto",value:"project"},{title:"Organização",value:"organization"}],P=[s=>!!s||"Título é obrigatório",s=>s.length>=3||"Título deve ter pelo menos 3 caracteres",s=>s.length<=255||"Título deve ter no máximo 255 caracteres"],W=[s=>!!s||"Linguagem é obrigatória"],X=[s=>!!s||"Categoria é obrigatória",s=>s.length<=100||"Categoria deve ter no máximo 100 caracteres"],u=[s=>!!s||"Severidade é obrigatória"],ve=[s=>!!s||"Escopo é obrigatório"],pe=[s=>!!s||"Regra é obrigatória",s=>s.length>=10||"Regra deve ter pelo menos 10 caracteres"],ge=[s=>!!s||"Explicação da importância é obrigatória",s=>s.length>=10||"Explicação deve ter pelo menos 10 caracteres"],fe=[s=>!!s||"Versão é obrigatória",s=>/^\d+\.\d+\.\d+$/.test(s)||"Formato de versão inválido (ex: 1.0.0)"],K=s=>({low:"success",medium:"warning",high:"orange",critical:"error"})[s]||"grey",re=async()=>{if(w.templateId){F.value=!0,$.value=null;try{const s=await q.getRuleTemplate(w.templateId);S.value=s,ye(s)}catch(s){$.value=s instanceof Error?s.message:"Erro ao carregar template"}finally{F.value=!1}}},ye=s=>{a.title=s.title,a.rule=s.rule,a.whyIsThisImportant=s.whyIsThisImportant,a.severity=s.severity,a.badExample=s.badExample||"",a.goodExample=s.goodExample||"",a.language=s.language,a.buckets=s.buckets||[],a.scope=s.scope,a.category=s.category,a.isActive=s.isActive,a.isGlobal=s.isGlobal,a.version=s.version,a.author=s.author||"",a.tags=s.tags||[],a.description=s.description||""},j=()=>{a.title="",a.rule="",a.whyIsThisImportant="",a.severity="medium",a.badExample="",a.goodExample="",a.language="general",a.buckets=[],a.scope="file",a.category="",a.isActive=!0,a.isGlobal=!0,a.version="1.0.0",a.author="",a.tags=[],a.description="",x.value="",h.value="",U.value?.resetValidation(),L.value=!1},ee=()=>{const s=x.value.trim();s&&!a.buckets.includes(s)&&a.buckets.push(s),x.value=""},le=s=>{a.buckets.splice(s,1)},C=()=>{const s=h.value.trim();s&&!a.tags.includes(s)&&a.tags.push(s),h.value=""},A=s=>{a.tags.splice(s,1)},H=async()=>{if(U.value?.validate()){O.value=!0;try{const s={title:a.title,rule:a.rule,whyIsThisImportant:a.whyIsThisImportant,severity:a.severity,badExample:a.badExample||void 0,goodExample:a.goodExample||void 0,language:a.language,buckets:a.buckets,scope:a.scope,category:a.category,isActive:a.isActive,isGlobal:a.isGlobal,version:a.version,author:a.author||void 0,tags:a.tags.length?a.tags:void 0,description:a.description||void 0};V.value&&w.templateId?await q.updateRuleTemplate(w.templateId,s):await q.createRuleTemplate(s),I("saved"),N.success(V.value?"Template atualizado com sucesso!":"Template criado com sucesso!","Sucesso!",4e3)}catch(s){console.error("Erro ao salvar template:",s);let o="Erro desconhecido ao salvar template";if(s?.response?.data){const n=s.response.data;n.message&&Array.isArray(n.message)?o=n.message.join(", "):n.message&&typeof n.message=="string"?o=n.message:n.error&&(o=n.error)}else s instanceof Error&&(o=s.message);N.error(o,"Erro ao salvar template",6e3)}finally{O.value=!1}}},ne=()=>{j(),I("update:modelValue",!1)};return ue(()=>w.modelValue,s=>{s?V.value?re():j():($.value=null,S.value=null,j())}),ue(()=>w.templateId,()=>{j(),$.value=null,S.value=null}),(s,o)=>(v(),_(Ie,{"model-value":ce.modelValue,"onUpdate:modelValue":o[17]||(o[17]=n=>s.$emit("update:modelValue",n)),"max-width":"1000px",persistent:"",transition:"dialog-bottom-transition",class:"modern-dialog"},{default:l(()=>[e(T,{elevation:"24",class:"dialog-card"},{default:l(()=>[r("div",ol,[r("div",sl,[r("div",il,[e(c,{icon:V.value?"mdi-pencil":"mdi-plus",size:"28",class:"dialog-icon"},null,8,["icon"])]),r("div",rl,[r("h2",nl,p(V.value?"Editar Template de Regra":"Novo Template de Regra"),1),r("p",dl,p(V.value?"Modifique o template de regra existente":"Crie um novo template de regra para análise de código"),1)])]),e(y,{icon:"mdi-close",variant:"text",size:"40",class:"dialog-close-btn",onClick:ne})]),r("div",ul,[V.value&&F.value?(v(),b("div",ml,[e(he,{indeterminate:"",color:"primary",size:"64"}),o[18]||(o[18]=r("div",{class:"mt-4 text-body-1"},"Carregando template...",-1))])):$.value?(v(),b("div",cl,[e(c,{size:"64",color:"error",class:"mb-4"},{default:l(()=>[...o[19]||(o[19]=[i("mdi-alert-circle",-1)])]),_:1}),o[21]||(o[21]=r("div",{class:"text-h6 mb-2"},"Erro ao carregar template",-1)),r("div",vl,p($.value),1),V.value?(v(),_(y,{key:0,color:"primary",onClick:re},{default:l(()=>[...o[20]||(o[20]=[i("Tentar Novamente",-1)])]),_:1})):D("",!0)])):(v(),_(Qe,{key:2,ref_key:"formRef",ref:U,modelValue:L.value,"onUpdate:modelValue":o[16]||(o[16]=n=>L.value=n),onSubmit:Ve(H,["prevent"])},{default:l(()=>[e(se,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(J,{modelValue:a.title,"onUpdate:modelValue":o[0]||(o[0]=n=>a.title=n),label:"Título da Regra *",variant:"outlined",rules:P,required:"","prepend-inner-icon":"mdi-format-title",counter:"255",class:"mb-2"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:l(()=>[e(B,{modelValue:a.language,"onUpdate:modelValue":o[1]||(o[1]=n=>a.language=n),label:"Linguagem *",items:G,variant:"outlined",rules:W,required:"","prepend-inner-icon":"mdi-code-braces","item-title":"title","item-value":"value"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:l(()=>[e(J,{modelValue:a.category,"onUpdate:modelValue":o[2]||(o[2]=n=>a.category=n),label:"Categoria *",variant:"outlined",rules:X,required:"","prepend-inner-icon":"mdi-tag",counter:"100"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:l(()=>[e(B,{modelValue:a.severity,"onUpdate:modelValue":o[3]||(o[3]=n=>a.severity=n),label:"Severidade *",items:Z,variant:"outlined",rules:u,required:"","prepend-inner-icon":"mdi-alert-box","item-title":"title","item-value":"value"},{selection:l(({item:n})=>[e(k,{color:K(n.value),size:"small",class:"mr-2"},{default:l(()=>[i(p(n.title),1)]),_:2},1032,["color"])]),item:l(({props:n,item:z})=>[e(Y,Ne(Ge(n)),{prepend:l(()=>[e(k,{color:K(z.value),size:"small",class:"mr-2"},{default:l(()=>[i(p(z.title),1)]),_:2},1032,["color"])]),_:2},1040)]),_:1},8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:l(()=>[e(B,{modelValue:a.scope,"onUpdate:modelValue":o[4]||(o[4]=n=>a.scope=n),label:"Escopo *",items:M,variant:"outlined",rules:ve,required:"","prepend-inner-icon":"mdi-target","item-title":"title","item-value":"value"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(ae,{modelValue:a.rule,"onUpdate:modelValue":o[5]||(o[5]=n=>a.rule=n),label:"Regra *",variant:"outlined",rules:pe,required:"","prepend-inner-icon":"mdi-clipboard-check-outline",rows:"4",counter:"",hint:"Descreva a regra que será aplicada","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(ae,{modelValue:a.whyIsThisImportant,"onUpdate:modelValue":o[6]||(o[6]=n=>a.whyIsThisImportant=n),label:"Por que é importante *",variant:"outlined",rules:ge,required:"","prepend-inner-icon":"mdi-lightbulb",rows:"3",counter:"",hint:"Explique a importância desta regra","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(ae,{modelValue:a.description,"onUpdate:modelValue":o[7]||(o[7]=n=>a.description=n),label:"Descrição",variant:"outlined","prepend-inner-icon":"mdi-text",rows:"2",counter:"",hint:"Descrição adicional (opcional)","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(T,{variant:"outlined",class:"mb-4"},{default:l(()=>[e(oe,null,{default:l(()=>[e(c,{class:"mr-2"},{default:l(()=>[...o[22]||(o[22]=[i("mdi-code-tags",-1)])]),_:1}),o[23]||(o[23]=i(" Exemplos de Código ",-1))]),_:1}),e(R,null,{default:l(()=>[e(se,null,{default:l(()=>[e(g,{cols:"12",md:"6"},{default:l(()=>[e(ae,{modelValue:a.badExample,"onUpdate:modelValue":o[8]||(o[8]=n=>a.badExample=n),label:"Exemplo Ruim",variant:"outlined",rows:"6",counter:"",hint:"Código que viola a regra","persistent-hint":""},{"prepend-inner":l(()=>[e(k,{color:"error",size:"small",class:"mb-2"},{default:l(()=>[e(c,{start:""},{default:l(()=>[...o[24]||(o[24]=[i("mdi-close",-1)])]),_:1}),o[25]||(o[25]=i(" Ruim ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"6"},{default:l(()=>[e(ae,{modelValue:a.goodExample,"onUpdate:modelValue":o[9]||(o[9]=n=>a.goodExample=n),label:"Exemplo Bom",variant:"outlined",rows:"6",counter:"",hint:"Código que segue a regra","persistent-hint":""},{"prepend-inner":l(()=>[e(k,{color:"success",size:"small",class:"mb-2"},{default:l(()=>[e(c,{start:""},{default:l(()=>[...o[26]||(o[26]=[i("mdi-check",-1)])]),_:1}),o[27]||(o[27]=i(" Bom ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(T,{variant:"outlined",class:"mb-4"},{default:l(()=>[e(oe,null,{default:l(()=>[e(c,{class:"mr-2"},{default:l(()=>[...o[28]||(o[28]=[i("mdi-bucket",-1)])]),_:1}),o[29]||(o[29]=i(" Buckets ",-1))]),_:1}),e(R,null,{default:l(()=>[r("div",pl,[e(J,{modelValue:x.value,"onUpdate:modelValue":o[10]||(o[10]=n=>x.value=n),label:"Adicionar buckets",variant:"outlined",density:"compact",hint:"Digite um bucket e pressione Enter ou clique em Adicionar","persistent-hint":"",onKeyup:Ae(ee,["enter"]),"onUpdate:focused":ee},null,8,["modelValue"]),e(y,{color:"primary",onClick:ee,class:"ml-3",disabled:!x.value.trim()},{default:l(()=>[...o[30]||(o[30]=[i(" Adicionar ",-1)])]),_:1},8,["disabled"])]),a.buckets.length?(v(),b("div",gl,[(v(!0),b(xe,null,ke(a.buckets,(n,z)=>(v(),_(k,{key:`bucket-${n}-${z}`,closable:"","onClick:close":be=>le(z),color:"info",variant:"tonal",class:_e({"ml-3":z>0})},{default:l(()=>[i(p(n),1)]),_:2},1032,["onClick:close","class"]))),128))])):(v(),b("div",fl," Nenhum bucket adicionado "))]),_:1})]),_:1})]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(T,{variant:"outlined",class:"mb-4"},{default:l(()=>[e(oe,null,{default:l(()=>[e(c,{class:"mr-2"},{default:l(()=>[...o[31]||(o[31]=[i("mdi-tag-multiple",-1)])]),_:1}),o[32]||(o[32]=i(" Tags ",-1))]),_:1}),e(R,null,{default:l(()=>[r("div",yl,[e(J,{modelValue:h.value,"onUpdate:modelValue":o[11]||(o[11]=n=>h.value=n),label:"Adicionar tags",variant:"outlined",density:"compact",hint:"Digite uma tag e pressione Enter ou clique em Adicionar","persistent-hint":"",onKeyup:Ae(C,["enter"]),"onUpdate:focused":C},null,8,["modelValue"]),e(y,{color:"primary",class:"ml-3",onClick:C,disabled:!h.value.trim()},{default:l(()=>[...o[33]||(o[33]=[i(" Adicionar ",-1)])]),_:1},8,["disabled"])]),a.tags&&a.tags.length?(v(),b("div",bl,[(v(!0),b(xe,null,ke(a.tags,(n,z)=>(v(),_(k,{key:`tag-${n}-${z}`,closable:"","onClick:close":be=>A(z),color:"secondary",variant:"tonal",class:_e({"ml-3":z>0})},{default:l(()=>[i(p(n),1)]),_:2},1032,["onClick:close","class"]))),128))])):(v(),b("div",Vl," Nenhuma tag adicionada "))]),_:1})]),_:1})]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(T,{variant:"outlined"},{default:l(()=>[e(oe,null,{default:l(()=>[e(c,{class:"mr-2"},{default:l(()=>[...o[34]||(o[34]=[i("mdi-cog",-1)])]),_:1}),o[35]||(o[35]=i(" Configurações Gerais ",-1))]),_:1}),e(R,null,{default:l(()=>[e(se,null,{default:l(()=>[e(g,{cols:"12",md:"4"},{default:l(()=>[e(J,{modelValue:a.version,"onUpdate:modelValue":o[12]||(o[12]=n=>a.version=n),label:"Versão *",variant:"outlined",rules:fe,required:"","prepend-inner-icon":"mdi-numeric",hint:"Formato: x.x.x (ex: 1.0.0)","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"4"},{default:l(()=>[e(J,{modelValue:a.author,"onUpdate:modelValue":o[13]||(o[13]=n=>a.author=n),label:"Autor",variant:"outlined","prepend-inner-icon":"mdi-account",counter:"255"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"4"},{default:l(()=>[r("div",xl,[e(me,{modelValue:a.isActive,"onUpdate:modelValue":o[14]||(o[14]=n=>a.isActive=n),label:"Ativo",color:"success",density:"compact","hide-details":""},null,8,["modelValue"]),e(me,{modelValue:a.isGlobal,"onUpdate:modelValue":o[15]||(o[15]=n=>a.isGlobal=n),class:"ml-4",label:"Global",color:"purple",density:"compact","hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))]),r("div",kl,[r("div",_l,[e(y,{variant:"outlined",size:"large",class:"action-btn cancel-btn",onClick:ne},{default:l(()=>[...o[36]||(o[36]=[i(" Cancelar ",-1)])]),_:1}),e(y,{color:"success",size:"large",class:"action-btn primary-btn",loading:O.value,disabled:!L.value||O.value,onClick:H},{default:l(()=>[i(p(V.value?"Salvar Alterações":"Criar Template"),1)]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1},8,["model-value"]))}}),Tl=Re(Cl,[["__scopeId","data-v-266597c3"]]),wl={class:"rule-templates-page pa-6"},Al={class:"d-flex align-center justify-space-between mb-6"},zl={class:"d-flex align-center gap-3"},El={class:"d-flex align-center"},$l={class:"text-h5 font-weight-bold"},hl={class:"d-flex align-center"},Rl={class:"text-h5 font-weight-bold"},Il={class:"d-flex align-center"},Ul={class:"text-h5 font-weight-bold"},Sl={class:"d-flex align-center"},Dl={class:"text-h5 font-weight-bold"},ql={class:"px-4 py-3 d-flex align-center justify-space-between border-b"},Bl={class:"d-flex align-center gap-3"},Fl={class:"d-flex align-center"},Nl={class:"px-4 py-4 advanced-filters-section"},Gl={class:"d-flex align-center gap-2"},Pl={class:"d-flex align-center gap-2"},jl={class:"d-flex align-center justify-end gap-2"},Ll={key:0,class:"text-center py-8"},Ol={key:1,class:"text-center py-8"},Ml={class:"text-body-2 text-grey-darken-1 mb-4"},Kl={key:2},Jl={class:"templates-grid"},Hl={class:"template-header"},Ql={class:"template-icon-wrapper"},Yl={class:"template-title-section"},Zl={class:"template-title"},Wl={class:"template-badges"},Xl={class:"template-actions"},et={class:"template-content"},lt={class:"language-info-section"},tt={class:"language-badge"},at={class:"language-text"},ot={class:"version-badge"},st={class:"rule-description"},it={class:"rule-text"},rt={class:"template-footer"},nt={class:"author-info"},dt={class:"author-text"},ut={key:0,class:"text-center py-8 col-span-full"},mt={class:"text-body-2 text-grey-darken-1"},ct={key:0},vt={key:1},pt={key:3,class:"d-flex justify-center mt-6"},gt={class:"mb-4"},ft={class:"text-h6 mb-2"},yt={class:"text-body-2 text-grey-darken-1"},bt="b1e58ac3-6a88-4fc3-846d-352c8ca4a1db",Vt=ze({__name:"RuleTemplatesView",setup(ce){const ie=Me(),{isDemoUser:w}=Je(),I=f({data:[],total:0,page:1,limit:10,totalPages:0}),U=f(null),L=f([]),O=f([]),F=f(!1),$=f(null),S=f(1),N=f(!1),x=f(null),h=f(!1),V=f(!1),a=f(null),G=f(!1),Z=f(null),M=f(""),P=f(void 0),W=f("updatedAt"),X=f("desc"),u=$e({search:"",severity:void 0,category:void 0,language:void 0,isActive:void 0,page:1,limit:10}),ve=[{title:"Baixa",value:"low"},{title:"Média",value:"medium"},{title:"Alta",value:"high"},{title:"Crítica",value:"critical"}],pe=["Sistema","Administrador","Comunidade","Especialista"],ge=[{title:"Data de atualização",value:"updatedAt"},{title:"Data de criação",value:"createdAt"},{title:"Título",value:"title"},{title:"Severidade",value:"severity"},{title:"Linguagem",value:"language"}],fe=[{title:"Mais recente",value:"desc"},{title:"Mais antigo",value:"asc"}],K=Ee(()=>{let m=0;return u.search&&m++,u.severity&&m++,u.category&&m++,u.language&&m++,u.isActive!==void 0&&m++,M.value&&m++,P.value!==void 0&&m++,m}),re=m=>{u.severity=void 0,u.category=void 0,u.language=void 0,u.isActive=void 0,M.value="",P.value=void 0,m==="critical"?u.severity="critical":m==="high"?u.severity="high":m==="active"?u.isActive=!0:m==="global"&&(P.value=!0),C()},ye=()=>{u.search="",u.severity=void 0,u.category=void 0,u.language=void 0,u.isActive=void 0,Z.value=null,M.value="",P.value=void 0,W.value="updatedAt",X.value="desc",ne()};let j=null;const ee=()=>{j&&clearTimeout(j),j=setTimeout(()=>{A()},300)};let le=null;const C=()=>{le&&clearTimeout(le),le=setTimeout(()=>{A()},300)},A=async()=>{F.value=!0,$.value=null;try{const[m,t]=await Promise.all([q.getRuleTemplates(u),q.getStatistics()]),d=[...new Set(m.data.map(Q=>Q.category))],E=[...new Set(m.data.map(Q=>Q.language))];if(L.value=d.filter(Boolean).sort(),O.value=E.filter(Boolean).sort(),U.value=t,u.search||u.severity||u.category||u.language||u.isActive!==void 0||u.page!==1){const Q=await q.getRuleTemplates(u);I.value=Q}else I.value=m}catch(m){$.value=m instanceof Error?m.message:"Erro ao carregar dados"}finally{F.value=!1}},H=()=>{A()},ne=()=>{u.search="",u.severity=void 0,u.category=void 0,u.language=void 0,u.isActive=void 0,S.value=1,u.page=1,A()},s=m=>{S.value=m,u.page=m,A()},o=()=>{a.value=null,V.value=!0},n=m=>{ie.push(`/rule-templates/${m}`)},z=m=>{a.value=m,V.value=!0},be=async m=>{try{const t=await q.getRuleTemplate(m),{id:d,createdAt:E,updatedAt:Q,createdBy:xt,updatedBy:kt,...Be}=t,Fe={...Be,title:`${t.title} (Cópia)`,isGlobal:!1};await q.createRuleTemplate(Fe),A()}catch(t){console.error("Erro ao duplicar template:",t)}},Ue=async m=>{if(confirm("Tem certeza que deseja deletar este template?"))try{await q.deleteRuleTemplate(m),A()}catch(t){console.error("Erro ao deletar template:",t)}},Ce=m=>{x.value=m,N.value=!0},Se=async()=>{if(x.value){h.value=!0;try{await Ke.createRuleConfig(bt,{ruleTemplateId:x.value.id,isEnabled:!0,status:"enabled",customSeverity:x.value.severity}),N.value=!1,x.value=null,ie.push("/rules")}catch(m){console.error("Erro ao configurar template:",m)}finally{h.value=!1}}},Te=m=>{switch(m){case"low":return"success";case"medium":return"warning";case"high":return"orange";case"critical":return"error";default:return"grey"}},De=m=>{switch(m){case"low":return"Baixa";case"medium":return"Média";case"high":return"Alta";case"critical":return"Crítica";default:return"N/A"}},qe=()=>{V.value=!1,a.value=null,A()};ue(V,m=>{m||(a.value=null)});let we;return ue(u,()=>{clearTimeout(we),we=setTimeout(()=>{u.page=1,S.value=1,A()},500)},{deep:!0}),Pe(()=>{A()}),(m,t)=>(v(),b("div",wl,[r("div",Al,[t[18]||(t[18]=r("div",null,[r("h1",{class:"text-h4 font-weight-bold text-high-emphasis mb-2"}," Templates de Regras "),r("p",{class:"text-body-1 text-grey-darken-1"}," Biblioteca de templates de regras disponíveis para análise de código ")],-1)),r("div",zl,[e(y,{color:"primary","prepend-icon":"mdi-refresh",onClick:H,loading:F.value},{default:l(()=>[...t[16]||(t[16]=[i(" Atualizar ",-1)])]),_:1},8,["loading"]),de(w)?D("",!0):(v(),_(y,{key:0,color:"success","prepend-icon":"mdi-plus",variant:"elevated",onClick:o,class:"ml-2"},{default:l(()=>[...t[17]||(t[17]=[i(" Novo Template ",-1)])]),_:1}))])]),e(se,{class:"mb-6"},{default:l(()=>[e(g,{cols:"12",sm:"6",md:"3"},{default:l(()=>[e(T,{color:"primary",variant:"tonal"},{default:l(()=>[e(R,null,{default:l(()=>[r("div",El,[e(c,{size:"32",class:"mr-3"},{default:l(()=>[...t[19]||(t[19]=[i("mdi-file-document-multiple",-1)])]),_:1}),r("div",null,[r("div",$l,p(U.value?.total||0),1),t[20]||(t[20]=r("div",{class:"text-caption"},"Total de Templates",-1))])])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",sm:"6",md:"3"},{default:l(()=>[e(T,{color:"success",variant:"tonal"},{default:l(()=>[e(R,null,{default:l(()=>[r("div",hl,[e(c,{size:"32",class:"mr-3"},{default:l(()=>[...t[21]||(t[21]=[i("mdi-check-circle",-1)])]),_:1}),r("div",null,[r("div",Rl,p(U.value?.active||0),1),t[22]||(t[22]=r("div",{class:"text-caption"},"Ativos",-1))])])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",sm:"6",md:"3"},{default:l(()=>[e(T,{color:"warning",variant:"tonal"},{default:l(()=>[e(R,null,{default:l(()=>[r("div",Il,[e(c,{size:"32",class:"mr-3"},{default:l(()=>[...t[23]||(t[23]=[i("mdi-alert-circle",-1)])]),_:1}),r("div",null,[r("div",Ul,p(U.value?.bySeverity?.high||0),1),t[24]||(t[24]=r("div",{class:"text-caption"},"Alta Severidade",-1))])])]),_:1})]),_:1})]),_:1}),e(g,{cols:"12",sm:"6",md:"3"},{default:l(()=>[e(T,{color:"info",variant:"tonal"},{default:l(()=>[e(R,null,{default:l(()=>[r("div",Sl,[e(c,{size:"32",class:"mr-3"},{default:l(()=>[...t[25]||(t[25]=[i("mdi-earth",-1)])]),_:1}),r("div",null,[r("div",Dl,p(Object.keys(U.value?.byLanguage||{}).length),1),t[26]||(t[26]=r("div",{class:"text-caption"},"Linguagens",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{class:"mb-6 filter-card"},{default:l(()=>[r("div",ql,[r("div",Bl,[e(J,{modelValue:u.search,"onUpdate:modelValue":t[0]||(t[0]=d=>u.search=d),label:"Buscar templates...","prepend-inner-icon":"mdi-magnify",variant:"solo",density:"compact","hide-details":"",clearable:"",style:{"min-width":"280px"},onInput:ee},null,8,["modelValue"]),K.value>0?(v(),_(k,{key:0,size:"small",color:"primary",variant:"tonal",class:"ml-2"},{default:l(()=>[i(p(K.value)+" filtro"+p(K.value>1?"s":""),1)]),_:1})):D("",!0)]),r("div",Fl,[e(We,{modelValue:Z.value,"onUpdate:modelValue":[t[1]||(t[1]=d=>Z.value=d),re],variant:"outlined",color:"primary"},{default:l(()=>[e(k,{value:"critical",size:"small"},{default:l(()=>[e(c,{start:""},{default:l(()=>[...t[27]||(t[27]=[i("mdi-alert-octagon",-1)])]),_:1}),t[28]||(t[28]=i(" Críticos ",-1))]),_:1}),e(k,{value:"high",size:"small"},{default:l(()=>[e(c,{start:""},{default:l(()=>[...t[29]||(t[29]=[i("mdi-alert-circle",-1)])]),_:1}),t[30]||(t[30]=i(" Alta Sev. ",-1))]),_:1}),e(k,{value:"active",size:"small"},{default:l(()=>[e(c,{start:""},{default:l(()=>[...t[31]||(t[31]=[i("mdi-check-circle",-1)])]),_:1}),t[32]||(t[32]=i(" Ativos ",-1))]),_:1}),e(k,{value:"global",size:"small"},{default:l(()=>[e(c,{start:""},{default:l(()=>[...t[33]||(t[33]=[i("mdi-earth",-1)])]),_:1}),t[34]||(t[34]=i(" Globais ",-1))]),_:1})]),_:1},8,["modelValue"]),e(y,{color:G.value?"primary":"default",variant:G.value?"flat":"outlined",size:"small",onClick:t[2]||(t[2]=d=>G.value=!G.value),class:"ml-1"},{default:l(()=>[e(c,null,{default:l(()=>[i("mdi-filter"+p(G.value?"-check":""),1)]),_:1}),t[35]||(t[35]=i(" Filtros ",-1))]),_:1},8,["color","variant"]),K.value>0?(v(),_(y,{key:0,variant:"outlined",size:"small",color:"error",onClick:ye,class:"ml-2"},{default:l(()=>[e(c,{start:""},{default:l(()=>[...t[36]||(t[36]=[i("mdi-filter-remove",-1)])]),_:1}),t[37]||(t[37]=i(" Limpar ",-1))]),_:1})):D("",!0)])]),e(Xe,null,{default:l(()=>[je(r("div",Nl,[e(se,null,{default:l(()=>[e(g,{cols:"12",sm:"6",md:"3"},{default:l(()=>[e(B,{modelValue:u.severity,"onUpdate:modelValue":[t[3]||(t[3]=d=>u.severity=d),C],label:"Severidade",items:ve,variant:"outlined",density:"compact",clearable:"","item-title":"title","item-value":"value","prepend-inner-icon":"mdi-alert-box","no-data-text":"Nenhuma severidade disponível"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",sm:"6",md:"3"},{default:l(()=>[e(B,{modelValue:u.category,"onUpdate:modelValue":[t[4]||(t[4]=d=>u.category=d),C],label:"Categoria",items:L.value,variant:"outlined",density:"compact",clearable:"","prepend-inner-icon":"mdi-tag","no-data-text":"Nenhuma categoria disponível"},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12",sm:"6",md:"3"},{default:l(()=>[e(B,{modelValue:u.language,"onUpdate:modelValue":[t[5]||(t[5]=d=>u.language=d),C],label:"Linguagem",items:O.value,variant:"outlined",density:"compact",clearable:"","prepend-inner-icon":"mdi-code-braces","no-data-text":"Nenhuma linguagem disponível"},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"12",sm:"6",md:"3"},{default:l(()=>[e(B,{modelValue:M.value,"onUpdate:modelValue":[t[6]||(t[6]=d=>M.value=d),C],label:"Autor",items:pe,variant:"outlined",density:"compact",clearable:"","prepend-inner-icon":"mdi-account","no-data-text":"Nenhum autor disponível"},null,8,["modelValue"])]),_:1}),e(g,{cols:"12",md:"4"},{default:l(()=>[r("div",Gl,[e(B,{modelValue:W.value,"onUpdate:modelValue":[t[7]||(t[7]=d=>W.value=d),C],label:"Ordenar por",items:ge,variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","no-data-text":"Nenhuma opção disponível"},null,8,["modelValue"]),e(B,{modelValue:X.value,"onUpdate:modelValue":[t[8]||(t[8]=d=>X.value=d),C],label:"Ordem",items:fe,variant:"outlined",density:"compact","no-data-text":"Nenhuma opção disponível"},null,8,["modelValue"])])]),_:1}),e(g,{cols:"12",md:"4"},{default:l(()=>[r("div",Pl,[e(me,{modelValue:u.isActive,"onUpdate:modelValue":[t[9]||(t[9]=d=>u.isActive=d),C],class:"ml-4",label:"Apenas ativos",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"]),e(me,{modelValue:P.value,"onUpdate:modelValue":[t[10]||(t[10]=d=>P.value=d),C],class:"ml-4",label:"Apenas globais",color:"purple",density:"compact","hide-details":""},null,8,["modelValue"])])]),_:1}),e(g,{cols:"12",md:"4"},{default:l(()=>[r("div",jl,[e(y,{color:"primary","prepend-icon":"mdi-refresh",onClick:H},{default:l(()=>[...t[38]||(t[38]=[i(" Atualizar ",-1)])]),_:1})])]),_:1})]),_:1})],512),[[Le,G.value]])]),_:1})]),_:1}),F.value?(v(),b("div",Ll,[e(he,{indeterminate:"",color:"primary",size:"64"}),t[39]||(t[39]=r("div",{class:"mt-4 text-body-1"},"Carregando templates...",-1))])):$.value?(v(),b("div",Ol,[e(c,{size:"64",color:"error",class:"mb-4"},{default:l(()=>[...t[40]||(t[40]=[i("mdi-alert-circle",-1)])]),_:1}),t[42]||(t[42]=r("div",{class:"text-h6 mb-2"},"Erro ao carregar dados",-1)),r("div",Ml,p($.value),1),e(y,{color:"primary",onClick:H},{default:l(()=>[...t[41]||(t[41]=[i("Tentar Novamente",-1)])]),_:1})])):(v(),b("div",Kl,[r("div",Jl,[(v(!0),b(xe,null,ke(I.value.data,d=>(v(),_(T,{key:d.id,class:"mb-4 modern-template-card",elevation:"0",onClick:E=>n(d.id)},{default:l(()=>[r("div",{class:_e(["severity-indicator",`severity-${d.severity}`])},null,2),e(R,{class:"template-card-content"},{default:l(()=>[r("div",Hl,[r("div",Ql,[e(c,{color:Te(d.severity),size:"32"},{default:l(()=>[...t[43]||(t[43]=[i(" mdi-file-document ",-1)])]),_:1},8,["color"])]),r("div",Yl,[r("h3",Zl,p(d.title),1),r("div",Wl,[e(k,{color:Te(d.severity),size:"small",variant:"flat",class:"severity-chip"},{default:l(()=>[e(c,{start:"",size:"10"},{default:l(()=>[i(p(d.severity==="critical"?"mdi-alert-octagon":d.severity==="high"?"mdi-alert":d.severity==="medium"?"mdi-alert-circle":"mdi-information"),1)]),_:2},1024),i(" "+p(De(d.severity)),1)]),_:2},1032,["color"]),e(k,{color:d.isActive?"success":"error",size:"small",variant:"tonal",class:"status-chip"},{default:l(()=>[e(c,{start:"",size:"10"},{default:l(()=>[i(p(d.isActive?"mdi-check-circle":"mdi-pause-circle"),1)]),_:2},1024),i(" "+p(d.isActive?"Ativo":"Inativo"),1)]),_:2},1032,["color"]),d.isGlobal?(v(),_(k,{key:0,color:"deep-purple",size:"small",variant:"tonal",class:"global-chip"},{default:l(()=>[e(c,{start:"",size:"10"},{default:l(()=>[...t[44]||(t[44]=[i("mdi-earth",-1)])]),_:1}),t[45]||(t[45]=i(" Global ",-1))]),_:1})):D("",!0),e(k,{color:"info",size:"small",variant:"outlined",class:"category-chip"},{default:l(()=>[e(c,{start:"",size:"10"},{default:l(()=>[...t[46]||(t[46]=[i("mdi-tag",-1)])]),_:1}),i(" "+p(d.category),1)]),_:2},1024)])]),r("div",Xl,[de(w)?(v(),_(y,{key:1,icon:"mdi-eye",variant:"text",size:"small",class:"view-only-btn",onClick:E=>n(d.id),title:"Ver Detalhes"},null,8,["onClick"])):(v(),_(tl,{key:0,location:"bottom end"},{activator:l(({props:E})=>[e(y,Oe({icon:"mdi-dots-vertical",variant:"text",size:"small",class:"menu-btn"},{ref_for:!0},E,{onClick:t[11]||(t[11]=Ve(()=>{},["stop"]))}),null,16)]),default:l(()=>[e(Ye,{class:"modern-menu"},{default:l(()=>[e(Y,{onClick:E=>n(d.id),class:"menu-item"},{prepend:l(()=>[e(c,{color:"primary"},{default:l(()=>[...t[47]||(t[47]=[i("mdi-eye",-1)])]),_:1})]),default:l(()=>[e(te,null,{default:l(()=>[...t[48]||(t[48]=[i("Ver Detalhes",-1)])]),_:1})]),_:1},8,["onClick"]),e(Y,{onClick:E=>z(d.id),class:"menu-item"},{prepend:l(()=>[e(c,{color:"success"},{default:l(()=>[...t[49]||(t[49]=[i("mdi-pencil",-1)])]),_:1})]),default:l(()=>[e(te,null,{default:l(()=>[...t[50]||(t[50]=[i("Editar",-1)])]),_:1})]),_:1},8,["onClick"]),e(Y,{onClick:E=>be(d.id),class:"menu-item"},{prepend:l(()=>[e(c,{color:"info"},{default:l(()=>[...t[51]||(t[51]=[i("mdi-content-copy",-1)])]),_:1})]),default:l(()=>[e(te,null,{default:l(()=>[...t[52]||(t[52]=[i("Duplicar",-1)])]),_:1})]),_:1},8,["onClick"]),e(Y,{onClick:E=>Ce(d),class:"menu-item"},{prepend:l(()=>[e(c,{color:"purple"},{default:l(()=>[...t[53]||(t[53]=[i("mdi-cog",-1)])]),_:1})]),default:l(()=>[e(te,null,{default:l(()=>[...t[54]||(t[54]=[i("Configurar para Organização",-1)])]),_:1})]),_:1},8,["onClick"]),e(Ze,{class:"my-1"}),e(Y,{onClick:E=>Ue(d.id),class:"menu-item danger-item"},{prepend:l(()=>[e(c,{color:"error"},{default:l(()=>[...t[55]||(t[55]=[i("mdi-delete",-1)])]),_:1})]),default:l(()=>[e(te,null,{default:l(()=>[...t[56]||(t[56]=[i("Deletar",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))])]),r("div",et,[r("div",lt,[r("div",tt,[e(c,{size:"16",class:"language-icon"},{default:l(()=>[...t[57]||(t[57]=[i("mdi-code-tags",-1)])]),_:1}),r("span",at,p(d.language),1)]),r("div",ot,[e(c,{size:"12"},{default:l(()=>[...t[58]||(t[58]=[i("mdi-tag",-1)])]),_:1}),r("span",null,"v"+p(d.version),1)])]),r("div",st,[r("p",it,p(d.rule.length>120?d.rule.substring(0,120)+"...":d.rule),1)])]),r("div",rt,[r("div",nt,[e(c,{size:"12",class:"mr-1"},{default:l(()=>[...t[59]||(t[59]=[i("mdi-account",-1)])]),_:1}),r("span",dt,p(d.author||"Sistema"),1)]),de(w)?D("",!0):(v(),_(y,{key:0,color:"primary",variant:"tonal",size:"x-small",onClick:Ve(E=>Ce(d),["stop"]),class:"configure-btn"},{default:l(()=>[...t[60]||(t[60]=[i(" Configurar ",-1)])]),_:1},8,["onClick"]))])]),_:2},1024)]),_:2},1032,["onClick"]))),128)),I.value.data?.length?D("",!0):(v(),b("div",ut,[e(T,{class:"pa-8"},{default:l(()=>[e(c,{size:"64",color:"grey",class:"mb-4"},{default:l(()=>[...t[61]||(t[61]=[i("mdi-file-document-outline",-1)])]),_:1}),t[62]||(t[62]=r("div",{class:"text-h6 mb-2"},"Nenhum template encontrado",-1)),r("div",mt,[de(w)?(v(),b("span",vt,"Tente ajustar os filtros para encontrar templates")):(v(),b("span",ct,"Tente ajustar os filtros ou criar um novo template"))])]),_:1})]))])])),I.value.totalPages>1?(v(),b("div",pt,[e(ll,{modelValue:S.value,"onUpdate:modelValue":[t[12]||(t[12]=d=>S.value=d),s],length:I.value.totalPages},null,8,["modelValue","length"])])):D("",!0),e(Ie,{modelValue:N.value,"onUpdate:modelValue":t[14]||(t[14]=d=>N.value=d),"max-width":"600px",persistent:""},{default:l(()=>[e(T,null,{default:l(()=>[e(oe,null,{default:l(()=>[e(c,{class:"mr-2"},{default:l(()=>[...t[63]||(t[63]=[i("mdi-cog",-1)])]),_:1}),t[64]||(t[64]=i(" Configurar Template para Organização ",-1))]),_:1}),x.value?(v(),_(R,{key:0},{default:l(()=>[r("div",gt,[r("h4",ft,p(x.value.title),1),r("p",yt,p(x.value.rule),1)]),t[65]||(t[65]=r("p",{class:"text-body-2 mb-4"}," Este template será adicionado às regras configuradas da sua organização. Você poderá personalizar severidade, mensagens e outros parâmetros após a criação. ",-1))]),_:1})):D("",!0),e(el,null,{default:l(()=>[e(al),e(y,{onClick:t[13]||(t[13]=d=>N.value=!1)},{default:l(()=>[...t[66]||(t[66]=[i("Cancelar",-1)])]),_:1}),e(y,{color:"primary",onClick:Se,loading:h.value},{default:l(()=>[...t[67]||(t[67]=[i(" Configurar ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Tl,{modelValue:V.value,"onUpdate:modelValue":t[15]||(t[15]=d=>V.value=d),"template-id":a.value,onSaved:qe},null,8,["modelValue","template-id"])]))}}),Ht=Re(Vt,[["__scopeId","data-v-83c2caaa"]]);export{Ht as default};
