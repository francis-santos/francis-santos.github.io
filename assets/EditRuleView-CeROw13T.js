import{k as Y,W as h,a9 as $,f as p,r as ee,E as le,X as c,z as r,Q as U,q as o,T as a,a1 as d,Z as oe,S as f,a4 as n,_ as S,F as I,a8 as q}from"./vendor-vue-BvKyvIVR.js";import{r as F}from"./rules-BedYAZrK.js";import{_ as ae}from"./index-CQBjCOQw.js";import{f as v,o as te,j as V,l as T,k as b}from"./VGrid-CuJrScxf.js";import{V as x}from"./VIcon-CM-KW5Qw.js";import{V as re}from"./VForm-BjI_k9Xt.js";import{V as C,a as m}from"./VRow-C_rLTo1r.js";import{a as _}from"./VChip-BzUv3cXC.js";import{V as y}from"./VSwitch-K3EdCM7X.js";import{a as N,V as O}from"./VSelect-JVxEisdn.js";import{V as R}from"./VTextarea-DdR9LUYO.js";import{V as ie}from"./VCombobox-tNYiDAes.js";import{V as ne}from"./VList-CaAoEaF2.js";import"./auth-PiWOMLtm.js";import"./vendor-utils-Cfk84l6i.js";import"./token-storage.service-BqAv9k07.js";import"./vendor-ui-Dz8XL-co.js";import"./tag-Bnbpnddf.js";import"./dimensions-DVh0fwa7.js";import"./autofocus-Bh6bNAdk.js";import"./forwardRefs-D_qxKlPu.js";import"./VMenu-B2XC7rkF.js";import"./lazy-DADzjSlN.js";import"./filter-3ET2mAtK.js";import"./ssrBoot-COakMcr6.js";const D="b1e58ac3-6a88-4fc3-846d-352c8ca4a1db",se=Y({__name:"EditRuleView",setup(L,{expose:e}){e();const k=h(),l=$(),w=p(),E=l.params.id,t=p(!1),g=p(!1),u=p(!1),z=p(null),M=p(null),s=ee({isEnabled:!0,status:"enabled",customSeverity:void 0,customMessage:"",customConfiguration:{},organizationSpecificExamples:[],tags:[],notes:"",category:"",priority:50,enforcementRules:{autoFix:!1,skipOnDraft:!1,warningOnly:!1,blockOnViolation:!0}}),P=[{title:"Ativada",value:"enabled"},{title:"Desativada",value:"disabled"}],j=[{title:"Baixa",value:"low"},{title:"Média",value:"medium"},{title:"Alta",value:"high"},{title:"Crítica",value:"critical"}],A=async()=>{u.value=!0,z.value=null;try{const i=await F.getRuleConfig(D,E);M.value=i,s.isEnabled=i.isEnabled,s.status=i.status,s.customSeverity=i.customSeverity,s.customMessage=i.customMessage||"",s.customConfiguration=i.customConfiguration||{},s.organizationSpecificExamples=i.organizationSpecificExamples||[],s.tags=i.tags||[],s.notes=i.notes||"",s.category=i.category||"",s.priority=i.priority||50,s.enforcementRules=i.enforcementRules||{autoFix:!1,skipOnDraft:!1,warningOnly:!1,blockOnViolation:!0}}catch(i){z.value=i instanceof Error?i.message:"Erro ao carregar configuração"}finally{u.value=!1}},Q=()=>{s.organizationSpecificExamples.push({context:"",snippet:"",isCorrect:!0,description:""})},W=i=>{s.organizationSpecificExamples.splice(i,1)},X=async()=>{if(w.value?.validate()){g.value=!0;try{const i={...s,organizationSpecificExamples:s.organizationSpecificExamples.filter(K=>K.snippet.trim())};await F.updateRuleConfig(D,E,i),k.push("/rules")}catch(i){console.error("Erro ao atualizar configuração:",i)}finally{g.value=!1}}},Z=()=>{k.push("/rules")},G=i=>{switch(i){case"low":return"success";case"medium":return"warning";case"high":return"orange";case"critical":return"error";default:return"grey"}},H=i=>{switch(i){case"low":return"Baixa";case"medium":return"Média";case"high":return"Alta";case"critical":return"Crítica";default:return"N/A"}},J=i=>new Date(i).toLocaleDateString("pt-BR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});le(()=>{A()});const B={router:k,route:l,formRef:w,organizationId:D,ruleId:E,valid:t,loading:g,loadingRule:u,error:z,ruleConfig:M,form:s,statusOptions:P,severityOptions:j,loadRule:A,addExample:Q,removeExample:W,submit:X,goBack:Z,getSeverityColor:G,getSeverityLabel:H,formatDate:J};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),de={class:"edit-rule-page"},me={class:"d-flex align-center mb-6"},ue={key:0,class:"text-center py-8"},fe={key:1,class:"text-center py-8"},ce={class:"text-body-2 text-grey-darken-1 mb-4"},ge={class:"text-h6 mb-2"},pe={class:"text-body-2 mb-3"},ve={class:"d-flex align-center mb-2"},ye={key:0},Ve={class:"text-body-2"},be={key:0},xe={class:"mb-3"},Ce={class:"text-body-2"},_e={class:"mb-3"},ke={class:"mb-3"},Ee={class:"text-body-2"},Se={class:"mb-3"},Te={class:"text-body-2"},Re={class:"mb-3"},we={class:"text-body-2"},ze={class:"mb-3"},Ue={class:"text-body-2"},Oe={key:0,class:"mb-3"},De={class:"mt-1"},Me={class:"d-flex justify-end mt-6 gap-3"};function Ae(L,e,k,l,w,E){return f(),c("div",de,[r("div",me,[o(v,{icon:"mdi-arrow-left",variant:"text",onClick:l.goBack,class:"mr-3"}),e[13]||(e[13]=r("div",null,[r("h1",{class:"text-h4 font-weight-bold text-grey-darken-3"}," Editar Configuração de Regra "),r("p",{class:"text-body-1 text-grey-darken-1"}," Ajuste a configuração da regra para análise de código ")],-1))]),l.loadingRule?(f(),c("div",ue,[o(te,{indeterminate:"",color:"primary",size:"64"}),e[14]||(e[14]=r("div",{class:"mt-4 text-body-1"},"Carregando configuração...",-1))])):l.error?(f(),c("div",fe,[o(x,{size:"64",color:"error",class:"mb-4"},{default:a(()=>[...e[15]||(e[15]=[n("mdi-alert-circle",-1)])]),_:1}),e[17]||(e[17]=r("div",{class:"text-h6 mb-2"},"Erro ao carregar configuração",-1)),r("div",ce,d(l.error),1),o(v,{color:"primary",onClick:l.loadRule},{default:a(()=>[...e[16]||(e[16]=[n("Tentar Novamente",-1)])]),_:1})])):(f(),U(re,{key:2,ref:"formRef",modelValue:l.valid,"onUpdate:modelValue":e[12]||(e[12]=t=>l.valid=t),onSubmit:oe(l.submit,["prevent"])},{default:a(()=>[o(C,null,{default:a(()=>[o(m,{cols:"12",md:"8"},{default:a(()=>[o(V,null,{default:a(()=>[o(T,null,{default:a(()=>[o(x,{class:"mr-2"},{default:a(()=>[...e[18]||(e[18]=[n("mdi-cog",-1)])]),_:1}),e[19]||(e[19]=n(" Configuração da Regra ",-1))]),_:1}),o(b,null,{default:a(()=>[l.ruleConfig?.ruleTemplate?(f(),U(V,{key:0,variant:"outlined",class:"mb-4"},{default:a(()=>[o(b,null,{default:a(()=>[r("h4",ge,d(l.ruleConfig.ruleTemplate.title),1),r("p",pe,d(l.ruleConfig.ruleTemplate.rule),1),r("div",ve,[o(_,{color:l.getSeverityColor(l.ruleConfig.ruleTemplate.severity),size:"small",class:"mr-2"},{default:a(()=>[n(d(l.getSeverityLabel(l.ruleConfig.ruleTemplate.severity)),1)]),_:1},8,["color"]),o(_,{size:"small",variant:"outlined",class:"mr-2"},{default:a(()=>[n(d(l.ruleConfig.ruleTemplate.language),1)]),_:1}),o(_,{size:"small",variant:"outlined"},{default:a(()=>[n(d(l.ruleConfig.ruleTemplate.category),1)]),_:1})]),l.ruleConfig.ruleTemplate.whyIsThisImportant?(f(),c("div",ye,[e[20]||(e[20]=r("strong",null,"Por que é importante:",-1)),r("p",Ve,d(l.ruleConfig.ruleTemplate.whyIsThisImportant),1)])):S("",!0)]),_:1})]),_:1})):S("",!0),o(C,null,{default:a(()=>[o(m,{cols:"12",md:"6"},{default:a(()=>[o(y,{modelValue:l.form.isEnabled,"onUpdate:modelValue":e[0]||(e[0]=t=>l.form.isEnabled=t),label:"Regra ativada",color:"primary","hide-details":""},null,8,["modelValue"])]),_:1}),o(m,{cols:"12",md:"6"},{default:a(()=>[o(N,{modelValue:l.form.status,"onUpdate:modelValue":e[1]||(e[1]=t=>l.form.status=t),items:l.statusOptions,label:"Status",variant:"outlined","item-title":"title","item-value":"value"},null,8,["modelValue"])]),_:1})]),_:1}),o(C,null,{default:a(()=>[o(m,{cols:"12",md:"6"},{default:a(()=>[o(N,{modelValue:l.form.customSeverity,"onUpdate:modelValue":e[2]||(e[2]=t=>l.form.customSeverity=t),items:l.severityOptions,label:"Severidade personalizada",variant:"outlined","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),o(m,{cols:"12",md:"6"},{default:a(()=>[o(O,{modelValue:l.form.priority,"onUpdate:modelValue":e[3]||(e[3]=t=>l.form.priority=t),label:"Prioridade",type:"number",variant:"outlined",min:"1",max:"100"},null,8,["modelValue"])]),_:1})]),_:1}),o(R,{modelValue:l.form.customMessage,"onUpdate:modelValue":e[4]||(e[4]=t=>l.form.customMessage=t),label:"Mensagem personalizada",variant:"outlined",rows:"3",placeholder:"Mensagem que será exibida quando a regra for violada"},null,8,["modelValue"]),o(O,{modelValue:l.form.category,"onUpdate:modelValue":e[5]||(e[5]=t=>l.form.category=t),label:"Categoria personalizada",variant:"outlined",placeholder:"Ex: security-custom, performance-critical"},null,8,["modelValue"]),o(ie,{modelValue:l.form.tags,"onUpdate:modelValue":e[6]||(e[6]=t=>l.form.tags=t),label:"Tags",variant:"outlined",multiple:"",chips:"","closable-chips":"",placeholder:"Adicione tags para organizar a regra"},null,8,["modelValue"]),o(R,{modelValue:l.form.notes,"onUpdate:modelValue":e[7]||(e[7]=t=>l.form.notes=t),label:"Observações",variant:"outlined",rows:"3",placeholder:"Notas internas sobre esta configuração"},null,8,["modelValue"])]),_:1})]),_:1}),o(V,{class:"mt-4"},{default:a(()=>[o(T,null,{default:a(()=>[o(x,{class:"mr-2"},{default:a(()=>[...e[21]||(e[21]=[n("mdi-gavel",-1)])]),_:1}),e[22]||(e[22]=n(" Regras de Aplicação ",-1))]),_:1}),o(b,null,{default:a(()=>[o(C,null,{default:a(()=>[o(m,{cols:"12",md:"6"},{default:a(()=>[o(y,{modelValue:l.form.enforcementRules.autoFix,"onUpdate:modelValue":e[8]||(e[8]=t=>l.form.enforcementRules.autoFix=t),label:"Correção automática",color:"primary","hide-details":""},null,8,["modelValue"]),e[23]||(e[23]=r("div",{class:"text-caption text-grey mt-1"}," Tentar corrigir automaticamente quando possível ",-1))]),_:1}),o(m,{cols:"12",md:"6"},{default:a(()=>[o(y,{modelValue:l.form.enforcementRules.skipOnDraft,"onUpdate:modelValue":e[9]||(e[9]=t=>l.form.enforcementRules.skipOnDraft=t),label:"Pular em rascunhos",color:"primary","hide-details":""},null,8,["modelValue"]),e[24]||(e[24]=r("div",{class:"text-caption text-grey mt-1"}," Não aplicar em pull requests em rascunho ",-1))]),_:1}),o(m,{cols:"12",md:"6"},{default:a(()=>[o(y,{modelValue:l.form.enforcementRules.warningOnly,"onUpdate:modelValue":e[10]||(e[10]=t=>l.form.enforcementRules.warningOnly=t),label:"Apenas aviso",color:"primary","hide-details":""},null,8,["modelValue"]),e[25]||(e[25]=r("div",{class:"text-caption text-grey mt-1"}," Mostrar como aviso, não como erro ",-1))]),_:1}),o(m,{cols:"12",md:"6"},{default:a(()=>[o(y,{modelValue:l.form.enforcementRules.blockOnViolation,"onUpdate:modelValue":e[11]||(e[11]=t=>l.form.enforcementRules.blockOnViolation=t),label:"Bloquear em violação",color:"primary","hide-details":""},null,8,["modelValue"]),e[26]||(e[26]=r("div",{class:"text-caption text-grey mt-1"}," Impedir merge quando a regra for violada ",-1))]),_:1})]),_:1})]),_:1})]),_:1}),o(V,{class:"mt-4"},{default:a(()=>[o(T,null,{default:a(()=>[o(x,{class:"mr-2"},{default:a(()=>[...e[27]||(e[27]=[n("mdi-code-braces",-1)])]),_:1}),e[28]||(e[28]=n(" Exemplos Específicos da Organização ",-1))]),_:1}),o(b,null,{default:a(()=>[(f(!0),c(I,null,q(l.form.organizationSpecificExamples,(t,g)=>(f(),c("div",{key:g,class:"mb-4"},[o(C,null,{default:a(()=>[o(m,{cols:"12",md:"4"},{default:a(()=>[o(O,{modelValue:t.context,"onUpdate:modelValue":u=>t.context=u,label:"Contexto",variant:"outlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(m,{cols:"12",md:"6"},{default:a(()=>[o(R,{modelValue:t.snippet,"onUpdate:modelValue":u=>t.snippet=u,label:"Código de exemplo",variant:"outlined",rows:"2",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(m,{cols:"12",md:"2"},{default:a(()=>[o(y,{modelValue:t.isCorrect,"onUpdate:modelValue":u=>t.isCorrect=u,label:"Correto",color:"success","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),o(v,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:u=>l.removeExample(g),class:"mt-2"},null,8,["onClick"])]),_:2},1024)]),_:2},1024),o(R,{modelValue:t.description,"onUpdate:modelValue":u=>t.description=u,label:"Descrição do exemplo",variant:"outlined",rows:"2",density:"compact"},null,8,["modelValue","onUpdate:modelValue"]),o(ne,{class:"mt-3"})]))),128)),o(v,{"prepend-icon":"mdi-plus",variant:"outlined",onClick:l.addExample},{default:a(()=>[...e[29]||(e[29]=[n(" Adicionar Exemplo ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(m,{cols:"12",md:"4"},{default:a(()=>[o(V,{class:"sticky-card"},{default:a(()=>[o(T,null,{default:a(()=>[o(x,{class:"mr-2"},{default:a(()=>[...e[30]||(e[30]=[n("mdi-information",-1)])]),_:1}),e[31]||(e[31]=n(" Informações ",-1))]),_:1}),o(b,null,{default:a(()=>[l.ruleConfig?.ruleTemplate?(f(),c("div",be,[r("div",xe,[e[32]||(e[32]=r("strong",null,"Template:",-1)),r("div",Ce,d(l.ruleConfig.ruleTemplate.title),1)]),r("div",_e,[e[33]||(e[33]=r("strong",null,"Severidade padrão:",-1)),o(_,{color:l.getSeverityColor(l.ruleConfig.ruleTemplate.severity),size:"small"},{default:a(()=>[n(d(l.getSeverityLabel(l.ruleConfig.ruleTemplate.severity)),1)]),_:1},8,["color"])]),r("div",ke,[e[34]||(e[34]=r("strong",null,"Linguagem:",-1)),r("div",Ee,d(l.ruleConfig.ruleTemplate.language),1)]),r("div",Se,[e[35]||(e[35]=r("strong",null,"Escopo:",-1)),r("div",Te,d(l.ruleConfig.ruleTemplate.scope),1)]),r("div",Re,[e[36]||(e[36]=r("strong",null,"Criada em:",-1)),r("div",we,d(l.formatDate(l.ruleConfig.createdAt)),1)]),r("div",ze,[e[37]||(e[37]=r("strong",null,"Última atualização:",-1)),r("div",Ue,d(l.formatDate(l.ruleConfig.updatedAt)),1)]),l.ruleConfig.ruleTemplate.tags&&l.ruleConfig.ruleTemplate.tags.length?(f(),c("div",Oe,[e[38]||(e[38]=r("strong",null,"Tags do template:",-1)),r("div",De,[(f(!0),c(I,null,q(l.ruleConfig.ruleTemplate.tags,t=>(f(),U(_,{key:t,size:"small",variant:"outlined",class:"mr-1 mb-1"},{default:a(()=>[n(d(t),1)]),_:2},1024))),128))])])):S("",!0)])):S("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),r("div",Me,[o(v,{variant:"outlined",onClick:l.goBack,disabled:l.loading},{default:a(()=>[...e[39]||(e[39]=[n(" Cancelar ",-1)])]),_:1},8,["disabled"]),o(v,{color:"primary",type:"submit",loading:l.loading,disabled:!l.valid},{default:a(()=>[...e[40]||(e[40]=[n(" Salvar Alterações ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["modelValue"]))])}const il=ae(se,[["render",Ae],["__scopeId","data-v-a18019cd"],["__file","D:/Development/Projetos/Mira/mira-client/src/views/rules/EditRuleView.vue"]]);export{il as default};
