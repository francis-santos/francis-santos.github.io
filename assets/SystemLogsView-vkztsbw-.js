import{k as Z,f as g,j as $,E as ee,_ as v,z as a,q as o,a0 as b,a1 as l,a8 as n,W as r,$ as x,a2 as m}from"./vendor-vue-BOgiBTV5.js";import{s as h}from"./system-logs-CGyEAe46.js";import{u as te,V as _}from"./VChip-CnfVI7ta.js";import{_ as oe,b as p,a as y,c as le}from"./index-Fi5SlckD.js";import{V as ae}from"./VAlert-CGm6uEMH.js";import{a as d,V as U}from"./VRow-i_tVuNAF.js";import{V as u,a as F,b as k,c as se}from"./VGrid-BenhMHcZ.js";import{V as A}from"./VSelect-0fCGXKgg.js";import{V as E}from"./VTextField-B2IaUgQ6.js";import{V as I}from"./VSpacer-CoP99NGt.js";import{V as N}from"./VList-DIl281p1.js";import{V as ie}from"./VDataTable-BLzqgo4z.js";import{V as re}from"./VDialog-CwamhhG7.js";import"./auth-Dt5LZyuD.js";import"./vendor-utils-C9OYYH06.js";import"./token-storage.service-BqAv9k07.js";import"./index-DzEvJ-T3.js";import"./vendor-ui-BR0KSDoQ.js";import"./autofocus-BDwW2Sox.js";import"./VMenu-DelZx27A.js";import"./dialog-transition-BRPqoOP4.js";import"./ssrBoot-Cswv876e.js";import"./VPagination-BthfBpUL.js";import"./VTable-CEZlMFDz.js";import"./filter-BU9fsv7R.js";const ne=Z({__name:"SystemLogsView",setup(R,{expose:e}){e();const{isDemoUser:O}=te(),t=g(!1),C=g(null),L=g([]),s=g({totalLogs:0,errorCount:0,warningCount:0,infoCount:0,functionalities:[]}),T=g(!1),j=g(null),c=g({functionality:"",level:"",dateFrom:"",dateTo:"",search:""}),P=$(()=>["webhook","analysis","git-integration"].map(f=>({title:f.charAt(0).toUpperCase()+f.slice(1),value:f}))),W=[{title:"Info",value:"info"},{title:"Warning",value:"warning"},{title:"Error",value:"error"}],q=[{title:"Timestamp",key:"timestamp",sortable:!0},{title:"Nível",key:"level",sortable:!0},{title:"Funcionalidade",key:"functionality",sortable:!0},{title:"Mensagem",key:"message",sortable:!1},{title:"Contexto",key:"context",sortable:!0},{title:"Ações",key:"actions",sortable:!1,align:"center"}];async function D(){if(c.value.functionality){t.value=!0,C.value=null;try{const i=await h.getSystemLogs(c.value.functionality,void 0,{level:c.value.level||void 0,dateFrom:c.value.dateFrom||void 0,dateTo:c.value.dateTo||void 0,search:c.value.search||void 0});L.value=i.map(f=>({...f,timestamp:new Date(f.timestamp)}))}catch(i){console.error("Error loading logs:",i),C.value="Erro ao carregar logs. Tente novamente."}finally{t.value=!1}}}async function S(){try{const i=await h.getSystemLogStats(void 0,{dateFrom:c.value.dateFrom||void 0,dateTo:c.value.dateTo||void 0});s.value=i}catch(i){console.error("Error loading stats:",i)}}function J(){D(),S()}function G(){if(!L.value.length)return;const i=["Timestamp,Level,Functionality,Context,Message",...L.value.map(w=>[w.timestamp.toISOString(),w.level,w.functionality,w.context||"",`"${w.message.replace(/"/g,'""')}"`].join(","))].join(`
`),f=new Blob([i],{type:"text/csv"}),M=window.URL.createObjectURL(f),z=document.createElement("a");z.href=M,z.download=`system-logs-${new Date().toISOString().split("T")[0]}.csv`,z.click(),window.URL.revokeObjectURL(M)}function H(i){j.value=i,T.value=!0}function K(i){return new Date(i).toLocaleString("pt-BR")}function Q(i){switch(i){case"error":return"error";case"warning":return"warning";case"info":return"info";default:return"primary"}}function X(i){switch(i){case"error":return"mdi-alert-circle";case"warning":return"mdi-alert";case"info":return"mdi-information";default:return"mdi-circle"}}let V=null;function Y(){V&&clearTimeout(V),V=window.setTimeout(()=>{D()},500)}ee(()=>{c.value.functionality="webhook",S(),D()});const B={isDemoUser:O,loading:t,error:C,logs:L,stats:s,showDetailsDialog:T,selectedLog:j,filters:c,functionalityOptions:P,levelOptions:W,headers:q,loadLogs:D,loadStats:S,refreshLogs:J,exportLogs:G,viewLogDetails:H,formatDate:K,getLevelColor:Q,getLevelIcon:X,get searchTimeout(){return V},set searchTimeout(i){V=i},debouncedSearch:Y};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),de={class:"logs-view"},me={class:"d-flex justify-space-between align-center mb-6"},ce={key:0,class:"d-flex gap-2"},ue={class:"text-h4 font-weight-bold text-primary"},fe={class:"text-h4 font-weight-bold text-error"},ge={class:"text-h4 font-weight-bold text-warning"},ve={class:"text-h4 font-weight-bold text-info"},ye={class:"text-caption"},be={key:0,class:"text-center py-8"},xe={key:1,class:"text-center py-8"},pe={class:"text-body-2 text-grey-darken-1 mb-4"},Le={key:2,class:"text-center py-8"},Ve={class:"text-no-wrap"},we={class:"text-truncate",style:{"max-width":"300px"}},_e={key:1,class:"text-grey"},ke={class:"text-body-2 mb-3"},Ce={class:"text-body-2 mb-3"},De={class:"text-body-2"},Te={class:"text-body-2 mb-2 font-weight-medium"},Se={key:1,class:"text-caption"};function ze(R,e,O,t,C,L){return m(),v("div",de,[a("div",me,[e[10]||(e[10]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold mb-2"},"Logs do Sistema"),a("p",{class:"text-body-1 text-grey-darken-1 mb-0"}," Visualize e monitore os logs de sistema da sua organização ")],-1)),t.isDemoUser?b("",!0):(m(),v("div",ce,[o(p,{color:"primary",onClick:t.refreshLogs,loading:t.loading,"prepend-icon":"mdi-refresh"},{default:l(()=>[...e[8]||(e[8]=[n(" Atualizar ",-1)])]),_:1},8,["loading"]),o(p,{color:"success",onClick:t.exportLogs,disabled:!t.logs.length,"prepend-icon":"mdi-download",class:"ml-2"},{default:l(()=>[...e[9]||(e[9]=[n(" Exportar ",-1)])]),_:1},8,["disabled"])]))]),o(ae,{type:"info",variant:"tonal",class:"mb-6",icon:"mdi-information-outline"},{default:l(()=>[...e[11]||(e[11]=[a("div",{class:"d-flex justify-space-between align-center"},[a("div",null,[a("strong",null,"Visualização de Logs:"),n(" Esta página exibe os logs de sistema organizados por funcionalidade. Use os filtros para refinar a visualização. ")])],-1)])]),_:1}),o(U,{class:"mb-6"},{default:l(()=>[o(d,{cols:"12",sm:"6",md:"3"},{default:l(()=>[o(u,{class:"text-center pa-4",color:"primary",variant:"tonal"},{default:l(()=>[a("div",ue,r(t.stats.totalLogs),1),e[12]||(e[12]=a("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Total de Logs",-1))]),_:1})]),_:1}),o(d,{cols:"12",sm:"6",md:"3"},{default:l(()=>[o(u,{class:"text-center pa-4",color:"error",variant:"tonal"},{default:l(()=>[a("div",fe,r(t.stats.errorCount),1),e[13]||(e[13]=a("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Erros",-1))]),_:1})]),_:1}),o(d,{cols:"12",sm:"6",md:"3"},{default:l(()=>[o(u,{class:"text-center pa-4",color:"warning",variant:"tonal"},{default:l(()=>[a("div",ge,r(t.stats.warningCount),1),e[14]||(e[14]=a("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Avisos",-1))]),_:1})]),_:1}),o(d,{cols:"12",sm:"6",md:"3"},{default:l(()=>[o(u,{class:"text-center pa-4",color:"info",variant:"tonal"},{default:l(()=>[a("div",ve,r(t.stats.infoCount),1),e[15]||(e[15]=a("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Informativos",-1))]),_:1})]),_:1})]),_:1}),o(u,{class:"mb-6"},{default:l(()=>[o(F,null,{default:l(()=>[o(y,{class:"me-2"},{default:l(()=>[...e[16]||(e[16]=[n("mdi-filter-variant",-1)])]),_:1}),e[17]||(e[17]=n(" Filtros ",-1))]),_:1}),o(k,null,{default:l(()=>[o(U,null,{default:l(()=>[o(d,{cols:"12",md:"3"},{default:l(()=>[o(A,{modelValue:t.filters.functionality,"onUpdate:modelValue":[e[0]||(e[0]=s=>t.filters.functionality=s),t.loadLogs],items:t.functionalityOptions,label:"Funcionalidade",clearable:""},null,8,["modelValue","items"])]),_:1}),o(d,{cols:"12",md:"2"},{default:l(()=>[o(A,{modelValue:t.filters.level,"onUpdate:modelValue":[e[1]||(e[1]=s=>t.filters.level=s),t.loadLogs],items:t.levelOptions,label:"Nível",clearable:""},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",md:"2"},{default:l(()=>[o(E,{modelValue:t.filters.dateFrom,"onUpdate:modelValue":[e[2]||(e[2]=s=>t.filters.dateFrom=s),t.loadLogs],type:"date",label:"Data Início",clearable:""},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",md:"2"},{default:l(()=>[o(E,{modelValue:t.filters.dateTo,"onUpdate:modelValue":[e[3]||(e[3]=s=>t.filters.dateTo=s),t.loadLogs],type:"date",label:"Data Fim",clearable:""},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",md:"3"},{default:l(()=>[o(E,{modelValue:t.filters.search,"onUpdate:modelValue":[e[4]||(e[4]=s=>t.filters.search=s),t.debouncedSearch],label:"Buscar","prepend-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(u,null,{default:l(()=>[o(F,null,{default:l(()=>[o(y,{class:"me-2"},{default:l(()=>[...e[18]||(e[18]=[n("mdi-file-document-multiple-outline",-1)])]),_:1}),e[19]||(e[19]=n(" Logs do Sistema ",-1)),o(I),a("span",ye,r(t.logs.length)+" registros",1)]),_:1}),o(N),t.loading?(m(),v("div",be,[o(le,{indeterminate:"",color:"primary"}),e[20]||(e[20]=a("div",{class:"mt-4 text-body-1"},"Carregando logs...",-1))])):t.error?(m(),v("div",xe,[o(y,{size:"64",color:"error",class:"mb-4"},{default:l(()=>[...e[21]||(e[21]=[n("mdi-alert-circle-outline",-1)])]),_:1}),e[23]||(e[23]=a("div",{class:"text-h6 mb-2"},"Erro ao carregar logs",-1)),a("div",pe,r(t.error),1),o(p,{color:"primary",onClick:t.loadLogs},{default:l(()=>[...e[22]||(e[22]=[n("Tentar Novamente",-1)])]),_:1})])):t.logs.length?(m(),x(ie,{key:3,headers:t.headers,items:t.logs,loading:t.loading,"item-key":"timestamp",class:"elevation-0","items-per-page":50,"items-per-page-options":[25,50,100]},{"item.timestamp":l(({item:s})=>[a("div",Ve,r(t.formatDate(s.timestamp)),1)]),"item.level":l(({item:s})=>[o(_,{color:t.getLevelColor(s.level),size:"small",variant:"tonal"},{default:l(()=>[o(y,{icon:t.getLevelIcon(s.level),size:"16",class:"me-1"},null,8,["icon"]),n(" "+r(s.level.toUpperCase()),1)]),_:2},1032,["color"])]),"item.functionality":l(({item:s})=>[o(_,{size:"small",variant:"outlined"},{default:l(()=>[n(r(s.functionality),1)]),_:2},1024)]),"item.message":l(({item:s})=>[a("div",we,r(s.message),1)]),"item.context":l(({item:s})=>[s.context?(m(),x(_,{key:0,size:"small",variant:"outlined",color:"primary"},{default:l(()=>[n(r(s.context),1)]),_:2},1024)):(m(),v("span",_e,"-"))]),"item.actions":l(({item:s})=>[o(p,{icon:"mdi-eye",variant:"text",size:"small",onClick:T=>t.viewLogDetails(s)},null,8,["onClick"])]),_:2},1032,["items","loading"])):(m(),v("div",Le,[o(y,{size:"64",color:"grey",class:"mb-4"},{default:l(()=>[...e[24]||(e[24]=[n("mdi-file-search-outline",-1)])]),_:1}),e[25]||(e[25]=a("div",{class:"text-h6 mb-2"},"Nenhum log encontrado",-1)),e[26]||(e[26]=a("div",{class:"text-body-2 text-grey-darken-1"}," Não há logs com os filtros aplicados ",-1))]))]),_:1}),o(re,{modelValue:t.showDetailsDialog,"onUpdate:modelValue":e[7]||(e[7]=s=>t.showDetailsDialog=s),"max-width":"800px"},{default:l(()=>[t.selectedLog?(m(),x(u,{key:0},{default:l(()=>[o(F,{class:"d-flex align-center"},{default:l(()=>[o(y,{icon:t.getLevelIcon(t.selectedLog.level),color:t.getLevelColor(t.selectedLog.level),class:"me-2"},null,8,["icon","color"]),e[27]||(e[27]=n(" Detalhes do Log ",-1)),o(I),o(p,{icon:"mdi-close",variant:"text",onClick:e[5]||(e[5]=s=>t.showDetailsDialog=!1)})]),_:1}),o(N),o(k,null,{default:l(()=>[o(U,null,{default:l(()=>[o(d,{cols:"12",sm:"6"},{default:l(()=>[e[28]||(e[28]=a("div",{class:"text-subtitle-2 mb-1"},"Timestamp",-1)),a("div",ke,r(t.formatDate(t.selectedLog.timestamp)),1)]),_:1}),o(d,{cols:"12",sm:"6"},{default:l(()=>[e[29]||(e[29]=a("div",{class:"text-subtitle-2 mb-1"},"Nível",-1)),o(_,{color:t.getLevelColor(t.selectedLog.level),size:"small",variant:"tonal",class:"mb-3"},{default:l(()=>[o(y,{icon:t.getLevelIcon(t.selectedLog.level),size:"16",class:"me-1"},null,8,["icon"]),n(" "+r(t.selectedLog.level.toUpperCase()),1)]),_:1},8,["color"])]),_:1}),o(d,{cols:"12",sm:"6"},{default:l(()=>[e[30]||(e[30]=a("div",{class:"text-subtitle-2 mb-1"},"Funcionalidade",-1)),o(_,{size:"small",variant:"outlined",class:"mb-3"},{default:l(()=>[n(r(t.selectedLog.functionality),1)]),_:1})]),_:1}),o(d,{cols:"12",sm:"6"},{default:l(()=>[e[31]||(e[31]=a("div",{class:"text-subtitle-2 mb-1"},"Contexto",-1)),a("div",Ce,r(t.selectedLog.context||"-"),1)]),_:1}),o(d,{cols:"12"},{default:l(()=>[e[32]||(e[32]=a("div",{class:"text-subtitle-2 mb-1"},"Mensagem",-1)),o(u,{variant:"outlined",class:"mb-3"},{default:l(()=>[o(k,{class:"text-body-2",style:{"white-space":"pre-wrap"}},{default:l(()=>[n(r(t.selectedLog.message),1)]),_:1})]),_:1})]),_:1}),t.selectedLog.metadata?(m(),x(d,{key:0,cols:"12"},{default:l(()=>[e[33]||(e[33]=a("div",{class:"text-subtitle-2 mb-1"},"Metadados",-1)),o(u,{variant:"outlined",class:"mb-3"},{default:l(()=>[o(k,null,{default:l(()=>[a("pre",De,r(JSON.stringify(t.selectedLog.metadata,null,2)),1)]),_:1})]),_:1})]),_:1})):b("",!0),t.selectedLog.error?(m(),x(d,{key:1,cols:"12"},{default:l(()=>[e[34]||(e[34]=a("div",{class:"text-subtitle-2 mb-1"},"Erro",-1)),o(u,{variant:"outlined",color:"error"},{default:l(()=>[o(k,null,{default:l(()=>[a("div",Te,r(t.selectedLog.error.message),1),t.selectedLog.error.stack?(m(),x(N,{key:0,class:"my-2"})):b("",!0),t.selectedLog.error.stack?(m(),v("pre",Se,r(t.selectedLog.error.stack),1)):b("",!0)]),_:1})]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1}),o(se,null,{default:l(()=>[o(I),o(p,{onClick:e[6]||(e[6]=s=>t.showDetailsDialog=!1)},{default:l(()=>[...e[35]||(e[35]=[n("Fechar",-1)])]),_:1})]),_:1})]),_:1})):b("",!0)]),_:1},8,["modelValue"])])}const tt=oe(ne,[["render",ze],["__scopeId","data-v-16f6a6af"],["__file","D:/Development/Projetos/Mira/mira-client/src/views/logs/SystemLogsView.vue"]]);export{tt as default};
