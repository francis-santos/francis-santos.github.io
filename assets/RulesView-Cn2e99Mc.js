import{k as $,W as ee,f as p,r as te,w as ae,E as le,X as c,z as i,q as t,_,Q as C,T as a,a1 as n,F as j,a8 as L,S as d,a4 as r,x as se}from"./vendor-vue-BvKyvIVR.js";import{r as k}from"./rules-BedYAZrK.js";import{u as ie,a as w}from"./VChip-BzUv3cXC.js";import{_ as oe}from"./index-CQBjCOQw.js";import{f as h,j as y,o as re,k as b}from"./VGrid-CuJrScxf.js";import{V as N,a as f}from"./VRow-C_rLTo1r.js";import{V as g}from"./VIcon-CM-KW5Qw.js";import{V as de}from"./VPagination-C7VPvwfo.js";import{V as ne,a as A}from"./VSelect-JVxEisdn.js";import{V as ce}from"./VSwitch-K3EdCM7X.js";import{V as me}from"./VMenu-B2XC7rkF.js";import{a as ue,b as U,c as B,V as fe}from"./VList-CaAoEaF2.js";import"./auth-PiWOMLtm.js";import"./vendor-utils-Cfk84l6i.js";import"./token-storage.service-BqAv9k07.js";import"./vendor-ui-Dz8XL-co.js";import"./tag-Bnbpnddf.js";import"./dimensions-DVh0fwa7.js";import"./autofocus-Bh6bNAdk.js";import"./forwardRefs-D_qxKlPu.js";import"./lazy-DADzjSlN.js";import"./ssrBoot-COakMcr6.js";const x="b1e58ac3-6a88-4fc3-846d-352c8ca4a1db",ge=$({__name:"RulesView",setup(F,{expose:e}){e();const D=ee(),{isDemoUser:l}=ie(),S=p({data:[],total:0,page:1,limit:10,totalPages:0}),T=p(null),s=p([]),m=p(!1),E=p(null),z=p(1),u=te({search:"",status:void 0,severity:void 0,category:void 0,isEnabled:void 0,page:1,limit:10}),I=[{title:"Ativada",value:"enabled"},{title:"Desativada",value:"disabled"}],O=[{title:"Baixa",value:"low"},{title:"Média",value:"medium"},{title:"Alta",value:"high"},{title:"Crítica",value:"critical"}],v=async()=>{m.value=!0,E.value=null;try{const[o,V,P]=await Promise.all([k.getRuleConfigs(x,u),k.getStatistics(x),k.getCategories(x)]);S.value=o,T.value=V,s.value=P}catch(o){E.value=o instanceof Error?o.message:"Erro ao carregar dados"}finally{m.value=!1}},q=()=>{v()},Q=()=>{u.search="",u.status=void 0,u.severity=void 0,u.category=void 0,u.isEnabled=void 0,z.value=1,u.page=1,v()},W=o=>{z.value=o,u.page=o,v()},X=()=>{D.push("/rules/add")},G=o=>{D.push(`/rules/${o}/edit`)},H=async(o,V)=>{try{await k.updateRuleConfig(x,o,{isEnabled:V}),v()}catch(P){console.error("Erro ao alterar status da regra:",P)}},J=async o=>{if(confirm("Tem certeza que deseja deletar esta configuração de regra?"))try{await k.deleteRuleConfig(x,o),v()}catch(V){console.error("Erro ao deletar regra:",V)}},K=o=>{switch(o){case"low":return"success";case"medium":return"warning";case"high":return"orange";case"critical":return"error";default:return"grey"}},Y=o=>{switch(o){case"low":return"Baixa";case"medium":return"Média";case"high":return"Alta";case"critical":return"Crítica";default:return"N/A"}},Z=o=>new Date(o).toLocaleDateString("pt-BR");let R;ae(u,()=>{clearTimeout(R),R=setTimeout(()=>{u.page=1,z.value=1,v()},500)},{deep:!0}),le(()=>{v()});const M={router:D,isDemoUser:l,organizationId:x,ruleConfigs:S,stats:T,availableCategories:s,loading:m,error:E,currentPage:z,filters:u,statusOptions:I,severityOptions:O,loadData:v,refreshData:q,clearFilters:Q,onPageChange:W,createRule:X,editRule:G,toggleRule:H,deleteRule:J,getSeverityColor:K,getSeverityLabel:Y,formatDate:Z,get debounceTimeout(){return R},set debounceTimeout(o){R=o}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}}),ve={class:"rules-page"},_e={class:"d-flex align-center justify-space-between mb-6"},ye={class:"d-flex align-center gap-3"},pe={class:"d-flex align-center"},be={class:"text-h5 font-weight-bold"},xe={class:"d-flex align-center"},Ve={class:"text-h5 font-weight-bold"},Ce={class:"d-flex align-center"},ke={class:"text-h5 font-weight-bold"},we={class:"d-flex align-center"},he={class:"text-h5 font-weight-bold"},De={key:0,class:"text-center py-8"},ze={key:1,class:"text-center py-8"},Re={class:"text-body-2 text-grey-darken-1 mb-4"},Se={key:2},Te={class:"d-flex justify-space-between align-start"},Ee={class:"flex-grow-1"},Pe={class:"d-flex align-center mb-2"},Ae={class:"text-h6 mr-3"},Ue={class:"text-body-2 text-grey-darken-1 mb-2"},Be={key:0,class:"mb-2"},Me={class:"text-body-2 mt-1"},je={key:1,class:"mb-2"},Le={class:"text-caption text-grey"},Ne={class:"d-flex flex-column align-end"},Fe={key:0,class:"text-center py-8"},Ie={class:"text-body-2 text-grey-darken-1"},Oe={key:0},qe={key:1},Qe={key:3,class:"d-flex justify-center mt-6"};function We(F,e,D,l,S,T){return d(),c("div",ve,[i("div",_e,[e[8]||(e[8]=i("div",null,[i("h1",{class:"text-h4 font-weight-bold text-grey-darken-3 mb-2"}," Regras de Análise "),i("p",{class:"text-body-1 text-grey-darken-1"}," Configure as regras para análise de código da organização ")],-1)),i("div",ye,[t(h,{color:"primary","prepend-icon":"mdi-refresh",onClick:l.refreshData,loading:l.loading},{default:a(()=>[...e[6]||(e[6]=[r(" Atualizar ",-1)])]),_:1},8,["loading"]),l.isDemoUser?_("",!0):(d(),C(h,{key:0,color:"success","prepend-icon":"mdi-plus",variant:"elevated",onClick:l.createRule},{default:a(()=>[...e[7]||(e[7]=[r(" Adicionar Regra ",-1)])]),_:1}))])]),t(N,{class:"mb-6"},{default:a(()=>[t(f,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(y,{color:"primary",variant:"tonal"},{default:a(()=>[t(b,null,{default:a(()=>[i("div",pe,[t(g,{size:"32",class:"mr-3"},{default:a(()=>[...e[9]||(e[9]=[r("mdi-shield-check",-1)])]),_:1}),i("div",null,[i("div",be,n(l.stats?.total||0),1),e[10]||(e[10]=i("div",{class:"text-caption"},"Total de Regras",-1))])])]),_:1})]),_:1})]),_:1}),t(f,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(y,{color:"success",variant:"tonal"},{default:a(()=>[t(b,null,{default:a(()=>[i("div",xe,[t(g,{size:"32",class:"mr-3"},{default:a(()=>[...e[11]||(e[11]=[r("mdi-check-circle",-1)])]),_:1}),i("div",null,[i("div",Ve,n(l.stats?.enabled||0),1),e[12]||(e[12]=i("div",{class:"text-caption"},"Ativadas",-1))])])]),_:1})]),_:1})]),_:1}),t(f,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(y,{color:"warning",variant:"tonal"},{default:a(()=>[t(b,null,{default:a(()=>[i("div",Ce,[t(g,{size:"32",class:"mr-3"},{default:a(()=>[...e[13]||(e[13]=[r("mdi-pause-circle",-1)])]),_:1}),i("div",null,[i("div",ke,n(l.stats?.disabled||0),1),e[14]||(e[14]=i("div",{class:"text-caption"},"Desativadas",-1))])])]),_:1})]),_:1})]),_:1}),t(f,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(y,{color:"error",variant:"tonal"},{default:a(()=>[t(b,null,{default:a(()=>[i("div",we,[t(g,{size:"32",class:"mr-3"},{default:a(()=>[...e[15]||(e[15]=[r("mdi-alert-circle",-1)])]),_:1}),i("div",null,[i("div",he,n(l.stats?.bySeverity?.critical||0),1),e[16]||(e[16]=i("div",{class:"text-caption"},"Críticas",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),t(y,{class:"mb-6"},{default:a(()=>[t(b,null,{default:a(()=>[t(N,null,{default:a(()=>[t(f,{cols:"12",md:"3"},{default:a(()=>[t(ne,{modelValue:l.filters.search,"onUpdate:modelValue":e[0]||(e[0]=s=>l.filters.search=s),label:"Buscar regras","prepend-inner-icon":"mdi-magnify",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"2"},{default:a(()=>[t(A,{modelValue:l.filters.status,"onUpdate:modelValue":e[1]||(e[1]=s=>l.filters.status=s),items:l.statusOptions,label:"Status",variant:"outlined",density:"compact",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"2"},{default:a(()=>[t(A,{modelValue:l.filters.severity,"onUpdate:modelValue":e[2]||(e[2]=s=>l.filters.severity=s),items:l.severityOptions,label:"Severidade",variant:"outlined",density:"compact",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"2"},{default:a(()=>[t(A,{modelValue:l.filters.category,"onUpdate:modelValue":e[3]||(e[3]=s=>l.filters.category=s),items:l.availableCategories,label:"Categoria",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),t(f,{cols:"12",md:"2"},{default:a(()=>[t(ce,{modelValue:l.filters.isEnabled,"onUpdate:modelValue":e[4]||(e[4]=s=>l.filters.isEnabled=s),label:"Apenas ativas",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"1"},{default:a(()=>[t(h,{icon:"mdi-filter-off",variant:"outlined",onClick:l.clearFilters,title:"Limpar filtros"})]),_:1})]),_:1})]),_:1})]),_:1}),l.loading?(d(),c("div",De,[t(re,{indeterminate:"",color:"primary",size:"64"}),e[17]||(e[17]=i("div",{class:"mt-4 text-body-1"},"Carregando regras...",-1))])):l.error?(d(),c("div",ze,[t(g,{size:"64",color:"error",class:"mb-4"},{default:a(()=>[...e[18]||(e[18]=[r("mdi-alert-circle",-1)])]),_:1}),e[20]||(e[20]=i("div",{class:"text-h6 mb-2"},"Erro ao carregar dados",-1)),i("div",Re,n(l.error),1),t(h,{color:"primary",onClick:l.refreshData},{default:a(()=>[...e[19]||(e[19]=[r("Tentar Novamente",-1)])]),_:1})])):(d(),c("div",Se,[(d(!0),c(j,null,L(l.ruleConfigs.data,s=>(d(),C(y,{key:s.id,class:"mb-4"},{default:a(()=>[t(b,null,{default:a(()=>[i("div",Te,[i("div",Ee,[i("div",Pe,[i("h3",Ae,n(s.ruleTemplate?.title||"Regra sem título"),1),t(w,{color:l.getSeverityColor(s.customSeverity||s.ruleTemplate?.severity),size:"small",class:"mr-2"},{default:a(()=>[r(n(l.getSeverityLabel(s.customSeverity||s.ruleTemplate?.severity)),1)]),_:2},1032,["color"]),t(w,{color:s.isEnabled?"success":"error",size:"small",class:"mr-2"},{default:a(()=>[r(n(s.isEnabled?"Ativada":"Desativada"),1)]),_:2},1032,["color"]),s.category?(d(),C(w,{key:0,color:"info",size:"small",variant:"outlined"},{default:a(()=>[r(n(s.category),1)]),_:2},1024)):_("",!0)]),i("p",Ue,n(s.ruleTemplate?.rule||"Descrição não disponível"),1),s.customMessage?(d(),c("div",Be,[t(w,{color:"orange",size:"small","prepend-icon":"mdi-pencil"},{default:a(()=>[...e[21]||(e[21]=[r(" Mensagem personalizada ",-1)])]),_:1}),i("p",Me,n(s.customMessage),1)])):_("",!0),s.tags&&s.tags.length?(d(),c("div",je,[(d(!0),c(j,null,L(s.tags,m=>(d(),C(w,{key:m,size:"small",variant:"outlined",class:"mr-1"},{default:a(()=>[r(n(m),1)]),_:2},1024))),128))])):_("",!0),i("div",Le," Prioridade: "+n(s.priority||"N/A")+" | Atualizada: "+n(l.formatDate(s.updatedAt)),1)]),i("div",Ne,[l.isDemoUser?_("",!0):(d(),C(me,{key:0},{activator:a(({props:m})=>[t(h,se({icon:"mdi-dots-vertical",variant:"text",size:"small"},{ref_for:!0},m),null,16)]),default:a(()=>[t(ue,null,{default:a(()=>[t(U,{onClick:m=>l.editRule(s.id)},{default:a(()=>[t(B,null,{default:a(()=>[t(g,{class:"mr-2"},{default:a(()=>[...e[22]||(e[22]=[r("mdi-pencil",-1)])]),_:1}),e[23]||(e[23]=r(" Editar ",-1))]),_:1})]),_:1},8,["onClick"]),t(U,{onClick:m=>l.toggleRule(s.id,!s.isEnabled)},{default:a(()=>[t(B,null,{default:a(()=>[t(g,{class:"mr-2"},{default:a(()=>[r(n(s.isEnabled?"mdi-pause":"mdi-play"),1)]),_:2},1024),r(" "+n(s.isEnabled?"Desativar":"Ativar"),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(fe),t(U,{onClick:m=>l.deleteRule(s.id),class:"text-error"},{default:a(()=>[t(B,null,{default:a(()=>[t(g,{class:"mr-2"},{default:a(()=>[...e[24]||(e[24]=[r("mdi-delete",-1)])]),_:1}),e[25]||(e[25]=r(" Deletar ",-1))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))])])]),_:2},1024)]),_:2},1024))),128)),l.ruleConfigs.data?.length?_("",!0):(d(),c("div",Fe,[t(y,{class:"pa-8"},{default:a(()=>[t(g,{size:"64",color:"grey",class:"mb-4"},{default:a(()=>[...e[26]||(e[26]=[r("mdi-shield-off",-1)])]),_:1}),e[27]||(e[27]=i("div",{class:"text-h6 mb-2"},"Nenhuma regra encontrada",-1)),i("div",Ie,[l.isDemoUser?(d(),c("span",qe,"Tente ajustar os filtros para encontrar regras")):(d(),c("span",Oe,"Configure regras personalizadas para análise de código"))])]),_:1})]))])),l.ruleConfigs.totalPages>1?(d(),c("div",Qe,[t(de,{modelValue:l.currentPage,"onUpdate:modelValue":[e[5]||(e[5]=s=>l.currentPage=s),l.onPageChange],length:l.ruleConfigs.totalPages},null,8,["modelValue","length"])])):_("",!0)])}const gt=oe(ge,[["render",We],["__scopeId","data-v-42ced0b2"],["__file","D:/Development/Projetos/Mira/mira-client/src/views/rules/RulesView.vue"]]);export{gt as default};
