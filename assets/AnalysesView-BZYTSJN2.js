import{j as ee,d as m,r as te,h as B,D as se,Z as u,y as o,n as a,$ as y,a0 as S,a1 as s,V as d,_ as n,aa as r,U as le,Y as ae,a6 as oe,v as re,ab as ie}from"./vendor-vue-BKuzT1x2.js";import{d as ne}from"./dashboard.service-CfLUye5J.js";import{a as p,b as de,V as ue}from"./VChip-BfcyEr4e.js";import{b,c as D,a as c,_ as ce}from"./index-gFSB3kms.js";import{V as E}from"./VGrid-CBGRWS1y.js";import{V as me}from"./VAlert-BZmB2o6G.js";import{V as pe}from"./VPagination-B83tja3x.js";import{V as fe,a as z}from"./VSelect-BorMXFwi.js";import{V as ve,a as _}from"./VRow-C_u8820H.js";import{V as ye}from"./VTooltip-BVPiCKg9.js";import{V as ge}from"./VDataTable-CaN6duAr.js";import"./auth.service-BozCwdnf.js";import"./vendor-utils-6xD0fNU8.js";import"./token-storage.service-BqAv9k07.js";import"./useDemoMode-DpDjlFnd.js";import"./auth--EmZq-C7.js";import"./vendor-ui-Ca7vMALJ.js";import"./autofocus-Cv2p5X6o.js";import"./form-PEXhLZdP.js";import"./VList-Dg4abNUz.js";import"./ssrBoot-DJyMk-ri.js";import"./dialog-transition-B8nu4acL.js";import"./VMenu-BCjbZdow.js";import"./VTable-SZOAnLd3.js";import"./filter-BaTOFc6H.js";const xe={class:"analyses-page pa-6"},ke={class:"d-flex align-center justify-space-between mb-6"},Ve={class:"px-4 py-3 d-flex align-center justify-space-between border-b"},be={class:"d-flex align-center gap-3"},_e={class:"d-flex align-center"},we={class:"px-4 py-4 advanced-filters-section"},Ce={class:"d-flex align-center gap-2"},Ae={class:"d-flex align-center justify-end gap-2"},Se={class:"d-flex align-center justify-space-between mb-4"},ze={class:"text-body-2 text-grey-darken-1"},he={key:1,class:"text-center py-12"},Fe={class:"d-flex align-center"},Ne={class:"font-weight-medium"},Te={class:"font-mono text-caption"},Pe={key:0,class:"d-flex align-center"},qe={key:1,class:"d-flex align-center"},Be={key:2,class:"d-flex align-center"},De={key:0,class:"d-flex align-center"},Re={key:1,class:"d-flex align-center"},$e={key:2,class:"d-flex align-center"},Ue={class:"ms-2 text-caption"},Me={key:3,class:"text-caption text-grey"},je={key:0,class:"d-flex align-center"},Le={key:1,class:"d-flex align-center"},Ee={key:2,class:"d-flex align-center"},Ie={class:"text-caption"},Oe={key:3,class:"text-caption text-grey"},Ge={class:"text-caption"},He={key:3,class:"text-center py-12"},Qe={key:4,class:"d-flex justify-center mt-6"},Ye=ee({__name:"AnalysesView",setup(Ze){const I=ie(),h=m([]),g=m(!1),x=m(null),k=m(1),F=m(1),R=m(0),O=m(20),f=m(!1),N=m(null),w=m("createdAt"),C=m("desc"),i=te({search:"",status:"all",repository:"all"}),A=B(()=>{let l=0;return i.search&&l++,i.status!=="all"&&l++,i.repository!=="all"&&l++,l}),T=B(()=>{let l=h.value;if(i.status!=="all"&&(l=l.filter(e=>e.status===i.status)),i.repository!=="all"&&(l=l.filter(e=>e.repositoryName===i.repository)),i.search.trim()){const e=i.search.toLowerCase().trim();l=l.filter(t=>t.repositoryName.toLowerCase().includes(e)||t.branchName.toLowerCase().includes(e)||t.commitSha.toLowerCase().includes(e))}return l}),G=B(()=>{const l=new Set(h.value.map(e=>e.repositoryName));return Array.from(l).sort()}),H=[{value:"all",title:"Todos os Status"},{value:"pending",title:"Pendente"},{value:"processing",title:"Processando"},{value:"completed",title:"Completa"},{value:"failed",title:"Falhou"}],Q=l=>{i.status="all",i.repository="all",l==="completed"?i.status="completed":l==="failed"?i.status="failed":l==="processing"?i.status="processing":l==="recent"&&(w.value="createdAt",C.value="desc"),V()},Y=()=>{i.search="",i.status="all",i.repository="all",N.value=null,w.value="createdAt",C.value="desc",v()};let P=null;const Z=()=>{P&&clearTimeout(P),P=setTimeout(()=>{v()},300)};let q=null;const V=()=>{q&&clearTimeout(q),q=setTimeout(()=>{v()},300)};async function v(){g.value=!0,x.value=null;try{const l=await ne.getAnalyses(k.value,O.value);h.value=l.data,F.value=l.totalPages,R.value=l.total}catch(l){x.value="Erro ao carregar análises",console.error("Error loading analyses:",l)}finally{g.value=!1}}function $(l){switch(l){case"completed":return"success";case"processing":return"warning";case"pending":return"info";case"failed":return"error";default:return"grey"}}function U(l){switch(l){case"completed":return"Completa";case"processing":return"Processando";case"pending":return"Pendente";case"failed":return"Falhou";default:return l}}function J(l){return new Date(l).toLocaleString("pt-BR")}function K(l){if(!l)return"N/A";if(l<1e3)return`${l}ms`;if(l<6e4)return`${(l/1e3).toFixed(1)}s`;{const e=Math.floor(l/6e4),t=Math.floor(l%6e4/1e3);return`${e}m ${t}s`}}function M(l){I.push(`/analyses/${l.id}`)}function W(l){k.value=l,v()}function j(){k.value=1,v()}const X=[{title:"Repositório",key:"repositoryName",sortable:!1},{title:"Branch",key:"branchName",sortable:!1},{title:"Commit",key:"commitSha",sortable:!1},{title:"Status",key:"status",sortable:!1},{title:"Issues",key:"issuesFound",sortable:!1},{title:"Score",key:"qualityScore",sortable:!1},{title:"Tempo",key:"processingTimeMs",sortable:!1},{title:"Criado em",key:"createdAt",sortable:!1},{title:"Ações",key:"actions",sortable:!1,width:80}];return se(()=>{v()}),(l,e)=>(n(),u("div",xe,[o("div",ke,[e[10]||(e[10]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold text-high-emphasis mb-2"}," Análises "),o("p",{class:"text-body-1 text-grey-darken-1"}," Gerencie e monitore todas as análises de código ")],-1)),a(b,{color:"primary","prepend-icon":"mdi-refresh",onClick:j,loading:g.value},{default:s(()=>[...e[9]||(e[9]=[r(" Atualizar ",-1)])]),_:1},8,["loading"])]),a(E,{class:"mb-6 filter-card"},{default:s(()=>[o("div",Ve,[o("div",be,[a(fe,{modelValue:i.search,"onUpdate:modelValue":e[0]||(e[0]=t=>i.search=t),label:"Buscar análises...","prepend-inner-icon":"mdi-magnify",variant:"solo",density:"compact","hide-details":"",clearable:"",style:{"min-width":"280px"},onInput:Z},null,8,["modelValue"]),A.value>0?(n(),y(p,{key:0,size:"small",color:"primary",variant:"tonal",class:"ml-2"},{default:s(()=>[r(d(A.value)+" filtro"+d(A.value>1?"s":""),1)]),_:1})):S("",!0)]),o("div",_e,[a(de,{modelValue:N.value,"onUpdate:modelValue":[e[1]||(e[1]=t=>N.value=t),Q],variant:"outlined",color:"primary"},{default:s(()=>[a(p,{value:"completed",size:"small"},{default:s(()=>[a(c,{start:""},{default:s(()=>[...e[11]||(e[11]=[r("mdi-check-circle",-1)])]),_:1}),e[12]||(e[12]=r(" Completas ",-1))]),_:1}),a(p,{value:"processing",size:"small"},{default:s(()=>[a(c,{start:""},{default:s(()=>[...e[13]||(e[13]=[r("mdi-cog",-1)])]),_:1}),e[14]||(e[14]=r(" Processando ",-1))]),_:1}),a(p,{value:"failed",size:"small"},{default:s(()=>[a(c,{start:""},{default:s(()=>[...e[15]||(e[15]=[r("mdi-alert-circle",-1)])]),_:1}),e[16]||(e[16]=r(" Falhas ",-1))]),_:1}),a(p,{value:"recent",size:"small"},{default:s(()=>[a(c,{start:""},{default:s(()=>[...e[17]||(e[17]=[r("mdi-clock-outline",-1)])]),_:1}),e[18]||(e[18]=r(" Recentes ",-1))]),_:1})]),_:1},8,["modelValue"]),a(b,{color:f.value?"primary":"default",variant:f.value?"flat":"outlined",size:"small",onClick:e[2]||(e[2]=t=>f.value=!f.value),class:"ml-1"},{default:s(()=>[a(c,null,{default:s(()=>[r("mdi-filter"+d(f.value?"-check":""),1)]),_:1}),e[19]||(e[19]=r(" Filtros ",-1))]),_:1},8,["color","variant"]),A.value>0?(n(),y(b,{key:0,variant:"outlined",size:"small",color:"error",onClick:Y,class:"ml-2"},{default:s(()=>[a(c,{start:""},{default:s(()=>[...e[20]||(e[20]=[r("mdi-filter-remove",-1)])]),_:1}),e[21]||(e[21]=r(" Limpar ",-1))]),_:1})):S("",!0)])]),a(ue,null,{default:s(()=>[le(o("div",we,[a(ve,null,{default:s(()=>[a(_,{cols:"12",sm:"6",md:"4"},{default:s(()=>[a(z,{modelValue:i.status,"onUpdate:modelValue":[e[3]||(e[3]=t=>i.status=t),V],label:"Status da Análise",items:H,variant:"outlined",density:"compact","prepend-inner-icon":"mdi-clipboard-check"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12",sm:"6",md:"4"},{default:s(()=>[a(z,{modelValue:i.repository,"onUpdate:modelValue":[e[4]||(e[4]=t=>i.repository=t),V],label:"Repositório",items:[{value:"all",title:"Todos os Repositórios"},...G.value.map(t=>({value:t,title:t}))],variant:"outlined",density:"compact","prepend-inner-icon":"mdi-source-repository"},null,8,["modelValue","items"])]),_:1}),a(_,{cols:"12",sm:"6",md:"4"},{default:s(()=>[a(z,{modelValue:w.value,"onUpdate:modelValue":[e[5]||(e[5]=t=>w.value=t),V],label:"Ordenar por",items:[{value:"createdAt",title:"Data de Criação"},{value:"completedAt",title:"Data de Conclusão"},{value:"repositoryName",title:"Repositório"},{value:"status",title:"Status"},{value:"qualityScore",title:"Score"}],variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12",md:"8"},{default:s(()=>[o("div",Ce,[a(z,{modelValue:C.value,"onUpdate:modelValue":[e[6]||(e[6]=t=>C.value=t),V],label:"Ordem",items:[{title:"Mais recente",value:"desc"},{title:"Mais antigo",value:"asc"}],variant:"outlined",density:"compact"},null,8,["modelValue"])])]),_:1}),a(_,{cols:"12",md:"4"},{default:s(()=>[o("div",Ae,[a(b,{color:"primary","prepend-icon":"mdi-refresh",onClick:j},{default:s(()=>[...e[22]||(e[22]=[r(" Atualizar ",-1)])]),_:1})])]),_:1})]),_:1})],512),[[ae,f.value]])]),_:1})]),_:1}),o("div",Se,[o("div",ze," Mostrando "+d(T.value.length)+" de "+d(R.value)+" análises ",1)]),x.value?(n(),y(me,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":e[7]||(e[7]=t=>x.value=null)},{default:s(()=>[r(d(x.value),1)]),_:1})):S("",!0),g.value?(n(),u("div",he,[a(D,{indeterminate:"",color:"primary",size:"64"}),e[23]||(e[23]=o("p",{class:"text-body-1 text-grey-darken-1 mt-4"}," Carregando análises... ",-1))])):T.value.length>0?(n(),y(E,{key:2,elevation:"2"},{default:s(()=>[a(ge,{headers:X,items:T.value,loading:g.value,"item-value":"id",class:"elevation-0","onClick:row":M},{"item.repositoryName":s(({item:t})=>[o("div",Fe,[a(c,{class:"me-2",size:"20"},{default:s(()=>[...e[24]||(e[24]=[r("mdi-source-repository",-1)])]),_:1}),o("div",null,[o("div",Ne,d(t.repositoryName),1)])])]),"item.branchName":s(({item:t})=>[a(p,{size:"small",variant:"tonal",color:"primary"},{default:s(()=>[r(d(t.branchName),1)]),_:2},1024)]),"item.commitSha":s(({item:t})=>[o("span",Te,d(t.commitSha.substring(0,8)),1)]),"item.status":s(({item:t})=>[t.status==="failed"&&t.errorMessage?(n(),y(ye,{key:0,bottom:""},{activator:s(({props:L})=>[a(p,re(L,{color:$(t.status),size:"small",variant:"tonal","prepend-icon":"mdi-alert-circle"}),{default:s(()=>[r(d(U(t.status)),1)]),_:2},1040,["color"])]),default:s(()=>[o("span",null,d(t.errorMessage),1)]),_:2},1024)):(n(),y(p,{key:1,color:$(t.status),size:"small",variant:"tonal"},{default:s(()=>[r(d(U(t.status)),1)]),_:2},1032,["color"]))]),"item.issuesFound":s(({item:t})=>[t.status==="failed"?(n(),u("div",Pe,[a(c,{class:"me-1",size:"16",color:"error"},{default:s(()=>[...e[25]||(e[25]=[r(" mdi-alert-circle ",-1)])]),_:1}),e[26]||(e[26]=o("span",{class:"text-error"},"Falha",-1))])):t.status==="pending"||t.status==="processing"?(n(),u("div",qe,[a(c,{class:"me-1",size:"16",color:"grey"},{default:s(()=>[...e[27]||(e[27]=[r(" mdi-clock-outline ",-1)])]),_:1}),e[28]||(e[28]=o("span",{class:"text-grey"},"-",-1))])):(n(),u("div",Be,[a(c,{class:"me-1",size:"16",color:t.issuesFound>0?"warning":"success"},{default:s(()=>[r(d(t.issuesFound>0?"mdi-alert":"mdi-check-circle"),1)]),_:2},1032,["color"]),o("span",null,d(t.issuesFound),1)]))]),"item.qualityScore":s(({item:t})=>[t.status==="failed"?(n(),u("div",De,[a(c,{class:"me-1",size:"16",color:"error"},{default:s(()=>[...e[29]||(e[29]=[r(" mdi-close-circle ",-1)])]),_:1}),e[30]||(e[30]=o("span",{class:"text-error text-caption"},"Falha",-1))])):t.status==="pending"||t.status==="processing"?(n(),u("div",Re,[a(D,{indeterminate:"",size:"20",width:"2",color:"primary"}),e[31]||(e[31]=o("span",{class:"ms-2 text-caption text-grey"},"Processando...",-1))])):t.qualityScore?(n(),u("div",$e,[a(D,{"model-value":t.qualityScore*10,color:t.qualityScore>=8?"success":t.qualityScore>=6?"warning":"error",size:"24",width:"3"},null,8,["model-value","color"]),o("span",Ue,d(t.qualityScore?.toFixed(1)),1)])):(n(),u("span",Me,"N/A"))]),"item.processingTimeMs":s(({item:t})=>[t.status==="failed"?(n(),u("div",je,[a(c,{class:"me-1",size:"16",color:"error"},{default:s(()=>[...e[32]||(e[32]=[r(" mdi-close-circle ",-1)])]),_:1}),e[33]||(e[33]=o("span",{class:"text-error text-caption"},"-",-1))])):t.status==="pending"||t.status==="processing"?(n(),u("div",Le,[a(c,{class:"me-1",size:"16",color:"grey"},{default:s(()=>[...e[34]||(e[34]=[r(" mdi-clock-outline ",-1)])]),_:1}),e[35]||(e[35]=o("span",{class:"text-grey text-caption"},"-",-1))])):t.processingTimeMs?(n(),u("div",Ee,[a(c,{class:"me-1",size:"16",color:"info"},{default:s(()=>[...e[36]||(e[36]=[r(" mdi-timer-outline ",-1)])]),_:1}),o("span",Ie,d(K(t.processingTimeMs)),1)])):(n(),u("span",Oe,"N/A"))]),"item.createdAt":s(({item:t})=>[o("span",Ge,d(J(t.createdAt)),1)]),"item.actions":s(({item:t})=>[a(b,{icon:"mdi-eye",size:"small",variant:"text",color:"primary",onClick:oe(L=>M(t),["stop"])},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1})):(n(),u("div",He,[a(c,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:s(()=>[...e[37]||(e[37]=[r(" mdi-clipboard-search-outline ",-1)])]),_:1}),e[38]||(e[38]=o("h3",{class:"text-h6 text-grey-darken-1 mb-2"}," Nenhuma análise encontrada ",-1)),e[39]||(e[39]=o("p",{class:"text-body-2 text-grey-darken-1"}," Não há análises que correspondam aos filtros selecionados. ",-1))])),F.value>1?(n(),u("div",Qe,[a(pe,{modelValue:k.value,"onUpdate:modelValue":[e[8]||(e[8]=t=>k.value=t),W],length:F.value,"total-visible":7},null,8,["modelValue","length"])])):S("",!0)]))}}),bt=ce(Ye,[["__scopeId","data-v-15af5127"]]);export{bt as default};
