import{a as p}from"./vendor-utils-6xD0fNU8.js";import{tokenStorage as r}from"./token-storage.service-BqAv9k07.js";function h(n){n.interceptors.request.use(e=>{if(!(e.url?.includes("/auth/login")||e.url?.includes("/auth/refresh"))){const s=r.getAccessToken();s&&!r.isTokenExpired()&&(e.headers.Authorization=`Bearer ${s}`)}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response?.status===401&&!t._retry){if(t._retry=!0,t.url?.includes("/auth/login")||t.url?.includes("/auth/refresh"))return Promise.reject(e);const i=r.getRefreshToken();if(i)try{const c=(await n.post("/auth/refresh",{refreshToken:i})).data.accessToken;return r.setAccessToken(c),t.headers.Authorization=`Bearer ${c}`,n(t)}catch(a){return console.warn("Token refresh failed:",a),r.clearTokens(),typeof window<"u"&&window.location.pathname!=="/login"&&(window.location.href="/login"),Promise.reject(a)}else r.clearTokens(),typeof window<"u"&&window.location.pathname!=="/login"&&(window.location.href="/login")}return Promise.reject(e)})}const u="https://api.mira.com/api";class l{client;constructor(){this.client=p.create({baseURL:u,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),h(this.client)}async get(e,t){return(await this.client.get(e,{params:t})).data}async post(e,t){return(await this.client.post(e,t)).data}async put(e,t){return(await this.client.put(e,t)).data}async patch(e,t){return(await this.client.patch(e,t)).data}async delete(e){return(await this.client.delete(e)).data}getBaseURL(){return u}}const o=new l;class d{baseURL="/auth";async login(e){return await o.post(`${this.baseURL}/login`,e)}async refreshToken(e){const t={refreshToken:e};return await o.post(`${this.baseURL}/refresh`,t)}async logout(){await o.post(`${this.baseURL}/logout`)}async getMe(){return await o.get(`${this.baseURL}/me`)}async validateToken(){try{return await this.getMe(),!0}catch{return!1}}async forgotPassword(e){return await o.post("/password-reset/request",e)}async resetPassword(e){return await o.post("/password-reset/reset",e)}}const y=new d;export{l as A,y as a,o as b};
