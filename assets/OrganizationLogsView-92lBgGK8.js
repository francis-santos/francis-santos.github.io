import{k as st,f as x,j as D,E as rt,_ as y,z as n,q as o,a0 as z,a1 as a,a8 as d,W as r,F as dt,ae as mt,$ as b,a2 as c}from"./vendor-vue-BOgiBTV5.js";import{s as P}from"./system-logs-CGyEAe46.js";import{u as ct,V as C}from"./VChip-CnfVI7ta.js";import{u as ut}from"./auth-Dt5LZyuD.js";import{_ as ft,b as V,a as g,c as gt}from"./index-Fi5SlckD.js";import{V as vt}from"./VAlert-CGm6uEMH.js";import{a as m,V as S}from"./VRow-i_tVuNAF.js";import{V as u,a as h,b as p,c as yt}from"./VGrid-BenhMHcZ.js";import{V as N}from"./VSelect-0fCGXKgg.js";import{V as q}from"./VTextField-B2IaUgQ6.js";import{V as W}from"./VSpacer-CoP99NGt.js";import{V as G}from"./VList-DIl281p1.js";import{V as xt}from"./VDataTable-BLzqgo4z.js";import{V as bt}from"./VDialog-CwamhhG7.js";import"./index-DzEvJ-T3.js";import"./vendor-ui-BR0KSDoQ.js";import"./vendor-utils-C9OYYH06.js";import"./token-storage.service-BqAv9k07.js";import"./autofocus-BDwW2Sox.js";import"./VMenu-DelZx27A.js";import"./dialog-transition-BRPqoOP4.js";import"./ssrBoot-Cswv876e.js";import"./VPagination-BthfBpUL.js";import"./VTable-CEZlMFDz.js";import"./filter-BU9fsv7R.js";const pt=st({__name:"OrganizationLogsView",setup(J,{expose:t}){t();const{isDemoUser:F}=ct(),e=ut(),O=x(!1),T=x(null),l=x([]),I=x({totalLogs:0,errorCount:0,warningCount:0,infoCount:0,functionalities:[]}),E=x(!1),M=x(null),w=D(()=>{if(F.value)return{id:"demo-org",name:"PRODEB Demo",slug:"prodeb-demo"};const i=e.user;return i?.organizationId&&i?.organizationName?{id:i.organizationId,name:i.organizationName,slug:i.organizationName.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}:{id:"default-org",name:"Sua Organização",slug:"default"}}),f=x({functionality:"",level:"",date:"",context:"",search:""}),U=D(()=>{let i=[...l.value];if(f.value.functionality&&(i=i.filter(s=>s.functionality===f.value.functionality)),f.value.level&&(i=i.filter(s=>s.level===f.value.level)),f.value.date){const s=f.value.date;i=i.filter(v=>new Date(v.timestamp).toISOString().split("T")[0]===s)}if(f.value.context&&(i=i.filter(s=>s.context&&s.context.toLowerCase().includes(f.value.context.toLowerCase()))),f.value.search){const s=f.value.search.toLowerCase();i=i.filter(v=>v.message.toLowerCase().includes(s))}return i.sort((s,v)=>{const _=new Date(s.timestamp).getTime();return new Date(v.timestamp).getTime()-_})}),H=D(()=>[...new Set(l.value.map(s=>s.functionality))].map(s=>({title:s.charAt(0).toUpperCase()+s.slice(1),value:s}))),K=D(()=>[...new Set(l.value.map(s=>new Date(s.timestamp).toISOString().split("T")[0]))].sort().reverse().map(s=>({title:new Date(s+"T00:00:00").toLocaleDateString("pt-BR"),value:s}))),Q=D(()=>[...new Set(l.value.map(i=>new Date(i.timestamp).toISOString().split("T")[0]))]),X=[{title:"Info",value:"info"},{title:"Warning",value:"warning"},{title:"Error",value:"error"}],Y=[{title:"Timestamp",key:"timestamp",sortable:!0},{title:"Nível",key:"level",sortable:!0},{title:"Módulo",key:"functionality",sortable:!0},{title:"Mensagem",key:"message",sortable:!1},{title:"Contexto",key:"context",sortable:!0},{title:"Ações",key:"actions",sortable:!1,align:"center"}];async function B(){if(!w.value?.id){l.value=[];return}O.value=!0,T.value=null;try{const i=await P.getOrganizationLogsRange(w.value.id,7);l.value=i.map((s,v)=>({...s,timestamp:s.timestamp instanceof Date?s.timestamp:new Date(s.timestamp),id:`${new Date(s.timestamp).getTime()}-${v}`}))}catch(i){console.error("Error loading organization logs:",i),T.value="Erro ao carregar logs da organização. Tente novamente."}finally{O.value=!1}}async function A(){if(w.value?.id)try{const i=await P.getSystemLogStats(w.value.id);I.value=i}catch(i){console.error("Error loading organization stats:",i)}}function j(){B(),A()}function Z(){}function $(){if(!U.value.length)return;const i=["Timestamp,Level,Functionality,Context,Message",...U.value.map(L=>[new Date(L.timestamp).toISOString(),L.level,L.functionality,L.context||"",`"${L.message.replace(/"/g,'""')}"`].join(","))].join(`
`),s=new Blob([i],{type:"text/csv"}),v=window.URL.createObjectURL(s),_=document.createElement("a");_.href=v,_.download=`organization-logs-${w.value?.slug||"system"}-${new Date().toISOString().split("T")[0]}.csv`,_.click(),window.URL.revokeObjectURL(v)}function tt(i){M.value=i,E.value=!0}function et(i){return new Date(i).toLocaleString("pt-BR")}function ot(i){switch(i){case"error":return"error";case"warning":return"warning";case"info":return"info";default:return"primary"}}function at(i){switch(i){case"error":return"mdi-alert-circle";case"warning":return"mdi-alert";case"info":return"mdi-information";default:return"mdi-circle"}}function lt(i){switch(i){case"webhook":return"pink";case"analysis":return"purple";case"git-integration":return"cyan";default:return"primary"}}function it(i){switch(i){case"webhook":return"mdi-webhook";case"analysis":return"mdi-chart-line";case"git-integration":return"mdi-git";default:return"mdi-cog"}}let k=null;function nt(){k&&clearTimeout(k),k=window.setTimeout(()=>{},500)}rt(async()=>{await j()});const R={isDemoUser:F,authStore:e,loading:O,error:T,allLogs:l,organizationStats:I,showDetailsDialog:E,selectedLog:M,currentOrganization:w,filters:f,filteredLogs:U,functionalityOptions:H,dateOptions:K,uniqueDates:Q,levelOptions:X,headers:Y,loadOrganizationLogs:B,loadOrganizationStats:A,refreshLogs:j,applyFilters:Z,exportLogs:$,viewLogDetails:tt,formatDate:et,getLevelColor:ot,getLevelIcon:at,getFunctionalityColor:lt,getFunctionalityIcon:it,get searchTimeout(){return k},set searchTimeout(i){k=i},debouncedSearch:nt};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),wt={class:"organization-logs-view"},_t={class:"d-flex justify-space-between align-center mb-6"},Lt={key:0,class:"d-flex gap-2"},zt={class:"text-h4 font-weight-bold text-primary"},Vt={class:"text-h4 font-weight-bold text-error"},kt={class:"text-h4 font-weight-bold text-warning"},Dt={class:"text-h4 font-weight-bold text-info"},Ct={class:"text-h4 font-weight-bold text-deep-purple"},St={class:"text-h4 font-weight-bold text-teal"},Ot={class:"text-h6 font-weight-bold"},Tt={class:"text-body-2 text-grey-darken-1 mb-2"},ht={class:"text-caption"},Ft={class:"text-caption"},It={key:0,class:"text-center py-8"},Ut={key:1,class:"text-center py-8"},Nt={class:"text-body-2 text-grey-darken-1 mb-4"},Et={key:2,class:"text-center py-8"},Mt={class:"text-body-2 text-grey-darken-1"},Bt={class:"text-no-wrap"},At=["title"],jt={key:1,class:"text-grey"},Rt={class:"d-flex align-center"},Pt={class:"text-body-2 mb-3"},qt={class:"text-body-2 mb-3"},Wt={class:"text-body-2"},Gt={class:"text-body-2 mb-2 font-weight-medium"},Jt={key:1,class:"text-caption"};function Ht(J,t,F,e,O,T){return c(),y("div",wt,[n("div",_t,[t[10]||(t[10]=n("div",null,[n("h1",{class:"text-h4 font-weight-bold mb-2"},"Logs da Organização"),n("p",{class:"text-body-1 text-grey-darken-1 mb-0"}," Monitore as atividades e logs específicos da sua organização ")],-1)),e.isDemoUser?z("",!0):(c(),y("div",Lt,[o(V,{color:"primary",onClick:e.refreshLogs,loading:e.loading,"prepend-icon":"mdi-refresh"},{default:a(()=>[...t[8]||(t[8]=[d(" Atualizar ",-1)])]),_:1},8,["loading"]),o(V,{color:"success",onClick:e.exportLogs,disabled:!e.filteredLogs.length,"prepend-icon":"mdi-download",class:"ml-2"},{default:a(()=>[...t[9]||(t[9]=[d(" Exportar ",-1)])]),_:1},8,["disabled"])]))]),o(vt,{type:"info",variant:"tonal",class:"mb-6",icon:"mdi-domain"},{default:a(()=>[n("div",null,[t[11]||(t[11]=n("strong",null,"Organização:",-1)),d(" "+r(e.currentOrganization?.name||"Sistema Geral")+" ",1),t[12]||(t[12]=n("br",null,null,-1)),t[13]||(t[13]=n("span",{class:"text-caption"}," Visualizando logs específicos da sua organização ",-1))])]),_:1}),o(S,{class:"mb-6"},{default:a(()=>[o(m,{cols:"12",sm:"6",md:"2"},{default:a(()=>[o(u,{class:"text-center pa-4",color:"primary",variant:"tonal"},{default:a(()=>[n("div",zt,r(e.organizationStats.totalLogs),1),t[14]||(t[14]=n("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Total",-1))]),_:1})]),_:1}),o(m,{cols:"12",sm:"6",md:"2"},{default:a(()=>[o(u,{class:"text-center pa-4",color:"error",variant:"tonal"},{default:a(()=>[n("div",Vt,r(e.organizationStats.errorCount),1),t[15]||(t[15]=n("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Erros",-1))]),_:1})]),_:1}),o(m,{cols:"12",sm:"6",md:"2"},{default:a(()=>[o(u,{class:"text-center pa-4",color:"warning",variant:"tonal"},{default:a(()=>[n("div",kt,r(e.organizationStats.warningCount),1),t[16]||(t[16]=n("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Avisos",-1))]),_:1})]),_:1}),o(m,{cols:"12",sm:"6",md:"2"},{default:a(()=>[o(u,{class:"text-center pa-4",color:"info",variant:"tonal"},{default:a(()=>[n("div",Dt,r(e.organizationStats.infoCount),1),t[17]||(t[17]=n("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Info",-1))]),_:1})]),_:1}),o(m,{cols:"12",sm:"6",md:"2"},{default:a(()=>[o(u,{class:"text-center pa-4",color:"deep-purple",variant:"tonal"},{default:a(()=>[n("div",Ct,r(e.organizationStats.functionalities.length),1),t[18]||(t[18]=n("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Módulos",-1))]),_:1})]),_:1}),o(m,{cols:"12",sm:"6",md:"2"},{default:a(()=>[o(u,{class:"text-center pa-4",color:"teal",variant:"tonal"},{default:a(()=>[n("div",St,r(e.uniqueDates.length),1),t[19]||(t[19]=n("div",{class:"text-body-2 text-grey-darken-1 mb-1"},"Dias",-1))]),_:1})]),_:1})]),_:1}),o(S,{class:"mb-6"},{default:a(()=>[o(m,{cols:"12"},{default:a(()=>[o(u,null,{default:a(()=>[o(h,null,{default:a(()=>[o(g,{class:"me-2"},{default:a(()=>[...t[20]||(t[20]=[d("mdi-view-module",-1)])]),_:1}),t[21]||(t[21]=d(" Atividade por Módulo ",-1))]),_:1}),o(p,null,{default:a(()=>[o(S,null,{default:a(()=>[(c(!0),y(dt,null,mt(e.organizationStats.functionalities,l=>(c(),b(m,{key:l.name,cols:"12",sm:"6",md:"4"},{default:a(()=>[o(u,{variant:"outlined"},{default:a(()=>[o(p,{class:"text-center"},{default:a(()=>[o(g,{icon:e.getFunctionalityIcon(l.name),size:"32",color:e.getFunctionalityColor(l.name),class:"mb-2"},null,8,["icon","color"]),n("div",Ot,r(l.count),1),n("div",Tt,r(l.name),1),n("div",ht," Última atividade: "+r(e.formatDate(l.lastActivity)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(u,{class:"mb-6"},{default:a(()=>[o(h,null,{default:a(()=>[o(g,{class:"me-2"},{default:a(()=>[...t[22]||(t[22]=[d("mdi-filter-variant",-1)])]),_:1}),t[23]||(t[23]=d(" Filtros ",-1))]),_:1}),o(p,null,{default:a(()=>[o(S,null,{default:a(()=>[o(m,{cols:"12",md:"2"},{default:a(()=>[o(N,{modelValue:e.filters.functionality,"onUpdate:modelValue":[t[0]||(t[0]=l=>e.filters.functionality=l),e.applyFilters],items:e.functionalityOptions,label:"Módulo",clearable:""},null,8,["modelValue","items"])]),_:1}),o(m,{cols:"12",md:"2"},{default:a(()=>[o(N,{modelValue:e.filters.level,"onUpdate:modelValue":[t[1]||(t[1]=l=>e.filters.level=l),e.applyFilters],items:e.levelOptions,label:"Nível",clearable:""},null,8,["modelValue"])]),_:1}),o(m,{cols:"12",md:"2"},{default:a(()=>[o(N,{modelValue:e.filters.date,"onUpdate:modelValue":[t[2]||(t[2]=l=>e.filters.date=l),e.applyFilters],items:e.dateOptions,label:"Data",clearable:""},null,8,["modelValue","items"])]),_:1}),o(m,{cols:"12",md:"2"},{default:a(()=>[o(q,{modelValue:e.filters.context,"onUpdate:modelValue":[t[3]||(t[3]=l=>e.filters.context=l),e.applyFilters],label:"Contexto",clearable:""},null,8,["modelValue"])]),_:1}),o(m,{cols:"12",md:"4"},{default:a(()=>[o(q,{modelValue:e.filters.search,"onUpdate:modelValue":[t[4]||(t[4]=l=>e.filters.search=l),e.debouncedSearch],label:"Buscar nas mensagens","prepend-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(u,null,{default:a(()=>[o(h,null,{default:a(()=>[o(g,{class:"me-2"},{default:a(()=>[...t[24]||(t[24]=[d("mdi-file-document-multiple-outline",-1)])]),_:1}),t[25]||(t[25]=d(" Logs da Organização ",-1)),o(W),n("span",Ft,r(e.filteredLogs.length)+" registros",1)]),_:1}),o(G),e.loading?(c(),y("div",It,[o(gt,{indeterminate:"",color:"primary"}),t[26]||(t[26]=n("div",{class:"mt-4 text-body-1"},"Carregando logs da organização...",-1))])):e.error?(c(),y("div",Ut,[o(g,{size:"64",color:"error",class:"mb-4"},{default:a(()=>[...t[27]||(t[27]=[d("mdi-alert-circle-outline",-1)])]),_:1}),t[29]||(t[29]=n("div",{class:"text-h6 mb-2"},"Erro ao carregar logs",-1)),n("div",Nt,r(e.error),1),o(V,{color:"primary",onClick:e.loadOrganizationLogs},{default:a(()=>[...t[28]||(t[28]=[d("Tentar Novamente",-1)])]),_:1})])):e.filteredLogs.length?(c(),b(xt,{key:3,headers:e.headers,items:e.filteredLogs,loading:e.loading,"item-key":"id",class:"elevation-0","items-per-page":50,"items-per-page-options":[25,50,100]},{"item.timestamp":a(({item:l})=>[n("div",Bt,r(e.formatDate(l.timestamp)),1)]),"item.level":a(({item:l})=>[o(C,{color:e.getLevelColor(l.level),size:"small",variant:"tonal"},{default:a(()=>[o(g,{icon:e.getLevelIcon(l.level),size:"16",class:"me-1"},null,8,["icon"]),d(" "+r(l.level.toUpperCase()),1)]),_:2},1032,["color"])]),"item.functionality":a(({item:l})=>[o(C,{size:"small",variant:"outlined",color:e.getFunctionalityColor(l.functionality)},{default:a(()=>[o(g,{icon:e.getFunctionalityIcon(l.functionality),size:"16",class:"me-1"},null,8,["icon"]),d(" "+r(l.functionality),1)]),_:2},1032,["color"])]),"item.message":a(({item:l})=>[n("div",{class:"text-truncate",style:{"max-width":"350px"},title:l.message},r(l.message),9,At)]),"item.context":a(({item:l})=>[l.context?(c(),b(C,{key:0,size:"small",variant:"outlined",color:"primary"},{default:a(()=>[d(r(l.context),1)]),_:2},1024)):(c(),y("span",jt,"-"))]),"item.actions":a(({item:l})=>[o(V,{icon:"mdi-eye",variant:"text",size:"small",onClick:I=>e.viewLogDetails(l)},null,8,["onClick"])]),_:2},1032,["items","loading"])):(c(),y("div",Et,[o(g,{size:"64",color:"grey",class:"mb-4"},{default:a(()=>[...t[30]||(t[30]=[d("mdi-file-search-outline",-1)])]),_:1}),t[31]||(t[31]=n("div",{class:"text-h6 mb-2"},"Nenhum log encontrado",-1)),n("div",Mt,r(e.currentOrganization?"Esta organização não possui logs com os filtros aplicados":"Nenhum log encontrado para sua organização"),1)]))]),_:1}),o(bt,{modelValue:e.showDetailsDialog,"onUpdate:modelValue":t[7]||(t[7]=l=>e.showDetailsDialog=l),"max-width":"900px",scrollable:""},{default:a(()=>[e.selectedLog?(c(),b(u,{key:0},{default:a(()=>[o(h,{class:"text-h6 d-flex align-center justify-space-between bg-primary text-white sticky-header"},{default:a(()=>[n("div",Rt,[o(g,{class:"me-2"},{default:a(()=>[...t[32]||(t[32]=[d("mdi-file-document-outline",-1)])]),_:1}),t[33]||(t[33]=d(" Detalhes do Log ",-1))]),o(V,{icon:"mdi-close",variant:"text",size:"small",color:"white",onClick:t[5]||(t[5]=l=>e.showDetailsDialog=!1)})]),_:1}),o(p,null,{default:a(()=>[o(S,null,{default:a(()=>[o(m,{cols:"12",sm:"6"},{default:a(()=>[t[34]||(t[34]=n("div",{class:"text-subtitle-2 mb-1"},"Timestamp",-1)),n("div",Pt,r(e.formatDate(e.selectedLog.timestamp)),1)]),_:1}),o(m,{cols:"12",sm:"6"},{default:a(()=>[t[35]||(t[35]=n("div",{class:"text-subtitle-2 mb-1"},"Nível",-1)),o(C,{color:e.getLevelColor(e.selectedLog.level),size:"small",variant:"tonal",class:"mb-3"},{default:a(()=>[o(g,{icon:e.getLevelIcon(e.selectedLog.level),size:"16",class:"me-1"},null,8,["icon"]),d(" "+r(e.selectedLog.level.toUpperCase()),1)]),_:1},8,["color"])]),_:1}),o(m,{cols:"12",sm:"6"},{default:a(()=>[t[36]||(t[36]=n("div",{class:"text-subtitle-2 mb-1"},"Módulo",-1)),o(C,{size:"small",variant:"outlined",class:"mb-3",color:e.getFunctionalityColor(e.selectedLog.functionality)},{default:a(()=>[o(g,{icon:e.getFunctionalityIcon(e.selectedLog.functionality),size:"16",class:"me-1"},null,8,["icon"]),d(" "+r(e.selectedLog.functionality),1)]),_:1},8,["color"])]),_:1}),o(m,{cols:"12",sm:"6"},{default:a(()=>[t[37]||(t[37]=n("div",{class:"text-subtitle-2 mb-1"},"Contexto",-1)),n("div",qt,r(e.selectedLog.context||"-"),1)]),_:1}),o(m,{cols:"12"},{default:a(()=>[t[38]||(t[38]=n("div",{class:"text-subtitle-2 mb-1"},"Mensagem",-1)),o(u,{variant:"outlined",class:"mb-3"},{default:a(()=>[o(p,{class:"text-body-2",style:{"white-space":"pre-wrap"}},{default:a(()=>[d(r(e.selectedLog.message),1)]),_:1})]),_:1})]),_:1}),e.selectedLog.metadata?(c(),b(m,{key:0,cols:"12"},{default:a(()=>[t[39]||(t[39]=n("div",{class:"text-subtitle-2 mb-1"},"Metadados",-1)),o(u,{variant:"outlined",class:"mb-3"},{default:a(()=>[o(p,null,{default:a(()=>[n("pre",Wt,r(JSON.stringify(e.selectedLog.metadata,null,2)),1)]),_:1})]),_:1})]),_:1})):z("",!0),e.selectedLog.error?(c(),b(m,{key:1,cols:"12"},{default:a(()=>[t[40]||(t[40]=n("div",{class:"text-subtitle-2 mb-1"},"Erro",-1)),o(u,{variant:"outlined",color:"error"},{default:a(()=>[o(p,null,{default:a(()=>[n("div",Gt,r(e.selectedLog.error.message),1),e.selectedLog.error.stack?(c(),b(G,{key:0,class:"my-2"})):z("",!0),e.selectedLog.error.stack?(c(),y("pre",Jt,r(e.selectedLog.error.stack),1)):z("",!0)]),_:1})]),_:1})]),_:1})):z("",!0)]),_:1})]),_:1}),o(yt,{class:"px-6 py-4 bg-surface border-t"},{default:a(()=>[o(W),o(V,{variant:"text",color:"primary",onClick:t[6]||(t[6]=l=>e.showDetailsDialog=!1)},{default:a(()=>[...t[41]||(t[41]=[d(" Fechar ",-1)])]),_:1})]),_:1})]),_:1})):z("",!0)]),_:1},8,["modelValue"])])}const pe=ft(pt,[["render",Ht],["__scopeId","data-v-b92312ee"],["__file","D:/Development/Projetos/Mira/mira-client/src/views/logs/OrganizationLogsView.vue"]]);export{pe as default};
