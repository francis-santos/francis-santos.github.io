import{n as _e,j as W,t as B,p as Se,q as a,z as s,F as ge,x as Z,k as re,f as h,r as ye,w as ie,$ as O,a1 as i,a8 as u,W as g,a9 as he,a0 as U,ag as Oe,ah as ke,a2 as x,_ as we,E as Ae}from"./vendor-vue-BOgiBTV5.js";import{b as I}from"./auth-Dt5LZyuD.js";import{u as q,V as N}from"./VChip-rM5LjFon.js";import{_ as ne,a as _,b as D}from"./index-CPKBv9AR.js";import{a as de,b as F,c as ue,V as P,e as ze}from"./VGrid-BsndwDIl.js";import{V as Ce}from"./VForm-pUagEOzw.js";import{V as J,a as p}from"./VRow-xKwg0MSP.js";import{V as H}from"./VTextField-DiiVGj7F.js";import{V as se}from"./VSelect-BBg-Hfm2.js";import{V as Te,b as Ue}from"./VList-BKPY6TWC.js";import{V as Pe}from"./VTextarea-ndrXJOcn.js";import{V as le}from"./VSwitch-BvA2_gQQ.js";import{V as me}from"./VSpacer-CBt-5M7F.js";import{V as ce}from"./VDialog-CkQu3sn-.js";import{d as Ee}from"./vendor-utils-C9OYYH06.js";import{c as Re,a as Be,b as Ie,d as Fe,u as Le,p as je,e as qe,f as Ne,g as Me,h as Ge,i as He,j as We,k as fe,l as ve,m as pe,n as Ze,o as Je,q as Ke}from"./VDataTable-CI-izd_C.js";import{h as Qe,p as Xe,k as Ye,u as $e}from"./vendor-ui-BR0KSDoQ.js";import{V as be}from"./VTable-C8WajvOs.js";import{V as et}from"./VSkeletonLoader-BZ60SsjR.js";import{V as oe}from"./VTooltip-CO6cvPu2.js";import{V as tt}from"./VAlert-qYEn-PTR.js";import"./token-storage.service-BqAv9k07.js";import"./index-DzEvJ-T3.js";import"./autofocus-DZuUxpyU.js";import"./VMenu-vHpHdbAo.js";import"./dialog-transition-BRPqoOP4.js";import"./ssrBoot-Cswv876e.js";import"./VPagination-BAn_hqPp.js";import"./filter-BU9fsv7R.js";const at=Xe({itemsLength:{type:[Number,String],required:!0},...Ke(),...Je(),...Ze()},"VDataTableServer"),it=Qe()({name:"VDataTableServer",props:at(),emits:{"update:modelValue":r=>!0,"update:page":r=>!0,"update:itemsPerPage":r=>!0,"update:sortBy":r=>!0,"update:options":r=>!0,"update:expanded":r=>!0,"update:groupBy":r=>!0},setup(r,e){let{attrs:n,slots:t}=e;const{groupBy:c}=Re(r),{sortBy:f,multiSort:o,mustSort:v}=Be(r),{page:w,itemsPerPage:d}=Ie(r),{disableSort:V}=_e(r),y=W(()=>parseInt(r.itemsLength,10)),{columns:k,headers:C}=Fe(r,{groupBy:c,showSelect:B(()=>r.showSelect),showExpand:B(()=>r.showExpand)}),{items:T}=Le(r,k),{toggleSort:E}=je({sortBy:f,multiSort:o,mustSort:v,page:w}),{opened:A,isGroupOpen:R,toggleGroup:L,extractRows:M}=qe({groupBy:c,sortBy:f,disableSort:V}),{pageCount:G,setItemsPerPage:j}=Ne({page:w,itemsPerPage:d,itemsLength:y}),{flatItems:l}=Me(T,c,A,()=>!!t["group-summary"]),{isSelected:Q,select:X,selectAll:Y,toggleSelect:$,someSelected:ee,allSelected:te}=Ge(r,{allItems:T,currentPage:T}),{isExpanded:K,toggleExpand:m}=He(r),b=W(()=>M(T.value));We({page:w,itemsPerPage:d,sortBy:f,groupBy:c,search:B(()=>r.search)}),Se("v-data-table",{toggleSort:E,sortBy:f}),Ye({VDataTableRows:{hideNoData:B(()=>r.hideNoData),noDataText:B(()=>r.noDataText),loading:B(()=>r.loading),loadingText:B(()=>r.loadingText)}});const z=W(()=>({page:w.value,itemsPerPage:d.value,sortBy:f.value,pageCount:G.value,toggleSort:E,setItemsPerPage:j,someSelected:ee.value,allSelected:te.value,isSelected:Q,select:X,selectAll:Y,toggleSelect:$,isExpanded:K,toggleExpand:m,isGroupOpen:R,toggleGroup:L,items:b.value.map(ae=>ae.raw),internalItems:b.value,groupedItems:l.value,columns:k.value,headers:C.value}));$e(()=>{const ae=fe.filterProps(r),Ve=ve.filterProps(r),De=pe.filterProps(r),xe=be.filterProps(r);return a(be,Z({class:["v-data-table",{"v-data-table--loading":r.loading},r.class],style:r.style},xe,{fixedHeader:r.fixedHeader||r.sticky}),{top:()=>t.top?.(z.value),default:()=>t.default?t.default(z.value):s(ge,null,[t.colgroup?.(z.value),!r.hideDefaultHeader&&s("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[a(ve,Ve,t)]),t.thead?.(z.value),!r.hideDefaultBody&&s("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[t["body.prepend"]?.(z.value),t.body?t.body(z.value):a(pe,Z(n,De,{items:l.value}),t),t["body.append"]?.(z.value)]),t.tbody?.(z.value),t.tfoot?.(z.value)]),bottom:()=>t.bottom?t.bottom(z.value):!r.hideDefaultFooter&&s(ge,null,[a(Te,null,null),a(fe,ae,{prepend:t["footer.prepend"]})])})})}});class ot{baseUrl="/organizations";async getOrganizations(e={}){const{isDemoUser:n,getMockData:t}=q();if(n.value){const f=await t("organizations",e.page||1,e.limit||20,e);return{data:f.data,total:f.total,page:f.page,limit:f.limit,totalPages:Math.ceil(f.total/f.limit)}}const c=new URLSearchParams;return e.search&&c.append("search",e.search),e.status&&c.append("status",e.status),e.tier&&c.append("tier",e.tier),e.isActive!==void 0&&c.append("isActive",e.isActive.toString()),e.page&&c.append("page",e.page.toString()),e.limit&&c.append("limit",e.limit.toString()),e.sortBy&&c.append("sortBy",e.sortBy),e.sortOrder&&c.append("sortOrder",e.sortOrder),e.includeStats!==void 0&&c.append("includeStats",e.includeStats.toString()),await I.get(`${this.baseUrl}?${c}`)}async getOrganization(e){const{isDemoUser:n,getMockItem:t}=q();if(n.value){const c=await t("organizations",e);if(!c)throw new Error("Organização não encontrada");return c}return await I.get(`${this.baseUrl}/${e}`)}async createOrganization(e){return await I.post(this.baseUrl,e)}async updateOrganization(e,n){return await I.patch(`${this.baseUrl}/${e}`,n)}async deleteOrganization(e){return await I.delete(`${this.baseUrl}/${e}`)}async activateOrganization(e){const{isDemoUser:n}=q();if(n.value)throw new Error("Operação não permitida no modo demo");return await I.put(`${this.baseUrl}/${e}/activate`,{})}async suspendOrganization(e){const{isDemoUser:n}=q();if(n.value)throw new Error("Operação não permitida no modo demo");return await I.put(`${this.baseUrl}/${e}/suspend`,{})}getAvailableTiers(){return[{value:"free",title:"Gratuito",color:"success"},{value:"professional",title:"Profissional",color:"warning"},{value:"enterprise",title:"Empresarial",color:"purple"}]}getAvailableStatuses(){return[{value:"active",title:"Ativa",color:"success"},{value:"inactive",title:"Inativa",color:"error"},{value:"suspended",title:"Suspensa",color:"warning"}]}formatDate(e){return new Date(e).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}getTierColor(e){switch(e){case"free":return"success";case"professional":return"warning";case"enterprise":return"purple";default:return"grey"}}getStatusColor(e){switch(e){case"active":return"success";case"inactive":return"error";case"suspended":return"warning";default:return"grey"}}}const S=new ot,st=re({__name:"OrganizationFormDialog",props:{modelValue:{type:Boolean,required:!0},organization:{type:[Object,null],required:!1,default:null}},emits:["update:modelValue","saved"],setup(r,{expose:e,emit:n}){e();const t=r,c=n,f=h(),o=h(!1),v=h(!1),w=W(()=>!!t.organization),d=ye({name:"",slug:"",email:"",website:"",tier:"free",description:"",isActive:!0}),V=S.getAvailableTiers(),y=[l=>!!l||"Nome é obrigatório",l=>l&&l.length>=2||"Nome deve ter pelo menos 2 caracteres",l=>l&&l.length<=100||"Nome deve ter no máximo 100 caracteres"],k=[l=>!!l||"Slug é obrigatório",l=>l&&l.length>=2||"Slug deve ter pelo menos 2 caracteres",l=>l&&l.length<=50||"Slug deve ter no máximo 50 caracteres",l=>/^[a-z0-9-]+$/.test(l)||"Slug deve conter apenas letras minúsculas, números e hífens"],C=[l=>!!l||"Email é obrigatório",l=>/.+@.+\..+/.test(l)||"Email deve ser válido"],T=[l=>!l||/^https?:\/\/.+/.test(l)||"Website deve ser uma URL válida (http:// ou https://)"],E=[l=>!!l||"Plano é obrigatório"],A=[l=>!l||l.length<=500||"Descrição deve ter no máximo 500 caracteres"];function R(){d.name="",d.slug="",d.email="",d.website="",d.tier="free",d.description="",d.isActive=!0,f.value?.resetValidation()}function L(l){d.name=l.name,d.slug=l.slug,d.email=l.email,d.website=l.website||"",d.tier=l.tier,d.description=l.description||"",d.isActive=l.isActive}async function M(){if(o.value){v.value=!0;try{if(w.value&&t.organization){const l={name:d.name,email:d.email,website:d.website||void 0,tier:d.tier,description:d.description||void 0,isActive:d.isActive};await S.updateOrganization(t.organization.id,l)}else{const l={name:d.name,slug:d.slug,email:d.email,website:d.website||void 0,tier:d.tier,description:d.description||void 0};await S.createOrganization(l)}c("saved")}catch(l){console.error("Erro ao salvar organização:",l)}finally{v.value=!1}}}function G(){c("update:modelValue",!1)}ie(()=>d.name,l=>{!w.value&&l&&(d.slug=l.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim())}),ie(()=>t.organization,l=>{l?L(l):R()},{immediate:!0}),ie(()=>t.modelValue,l=>{!l&&!t.organization&&setTimeout(R,300)});const j={props:t,emit:c,formRef:f,valid:o,loading:v,isEditing:w,formData:d,tierOptions:V,nameRules:y,slugRules:k,emailRules:C,websiteRules:T,tierRules:E,descriptionRules:A,resetForm:R,populateForm:L,handleSubmit:M,handleCancel:G};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}}),lt={class:"d-flex align-center"};function rt(r,e,n,t,c,f){return x(),O(ce,{"model-value":n.modelValue,"onUpdate:modelValue":e[8]||(e[8]=o=>r.$emit("update:modelValue",o)),"max-width":"600",persistent:"",scrollable:""},{default:i(()=>[a(P,null,{default:i(()=>[a(de,{class:"text-h6 d-flex align-center justify-space-between bg-primary text-white sticky-header"},{default:i(()=>[s("div",lt,[a(_,{class:"me-2"},{default:i(()=>[...e[9]||(e[9]=[u("mdi-domain",-1)])]),_:1}),u(" "+g(t.isEditing?"Editar Organização":"Nova Organização"),1)]),a(D,{icon:"mdi-close",variant:"text",size:"small",color:"white",onClick:t.handleCancel})]),_:1}),a(F,{class:"pa-6"},{default:i(()=>[a(Ce,{ref:"formRef",modelValue:t.valid,"onUpdate:modelValue":e[7]||(e[7]=o=>t.valid=o),onSubmit:he(t.handleSubmit,["prevent"])},{default:i(()=>[a(J,null,{default:i(()=>[a(p,{cols:"12"},{default:i(()=>[a(H,{modelValue:t.formData.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.formData.name=o),label:"Nome da Organização *",rules:t.nameRules,variant:"outlined","prepend-inner-icon":"mdi-domain",required:""},null,8,["modelValue"])]),_:1}),t.isEditing?U("",!0):(x(),O(p,{key:0,cols:"12"},{default:i(()=>[a(H,{modelValue:t.formData.slug,"onUpdate:modelValue":e[1]||(e[1]=o=>t.formData.slug=o),label:"Slug *",rules:t.slugRules,variant:"outlined","prepend-inner-icon":"mdi-link",hint:"Identificador único usado nas URLs (ex: minha-empresa)","persistent-hint":"",required:""},null,8,["modelValue"])]),_:1})),a(p,{cols:"12"},{default:i(()=>[a(H,{modelValue:t.formData.email,"onUpdate:modelValue":e[2]||(e[2]=o=>t.formData.email=o),label:"Email de Contato *",rules:t.emailRules,variant:"outlined","prepend-inner-icon":"mdi-email",type:"email",required:""},null,8,["modelValue"])]),_:1}),a(p,{cols:"12"},{default:i(()=>[a(H,{modelValue:t.formData.website,"onUpdate:modelValue":e[3]||(e[3]=o=>t.formData.website=o),label:"Website",rules:t.websiteRules,variant:"outlined","prepend-inner-icon":"mdi-web",type:"url",placeholder:"https://exemplo.com"},null,8,["modelValue"])]),_:1}),a(p,{cols:"12"},{default:i(()=>[a(se,{modelValue:t.formData.tier,"onUpdate:modelValue":e[4]||(e[4]=o=>t.formData.tier=o),items:t.tierOptions,label:"Plano *",rules:t.tierRules,variant:"outlined","prepend-inner-icon":"mdi-crown",required:""},{item:i(({props:o,item:v})=>[a(Ue,Oe(ke(o)),{prepend:i(()=>[a(_,{color:v.raw.color,class:"mr-2"},{default:i(()=>[...e[10]||(e[10]=[u(" mdi-crown ",-1)])]),_:1},8,["color"])]),_:2},1040)]),_:1},8,["modelValue","items"])]),_:1}),a(p,{cols:"12"},{default:i(()=>[a(Pe,{modelValue:t.formData.description,"onUpdate:modelValue":e[5]||(e[5]=o=>t.formData.description=o),label:"Descrição",variant:"outlined","prepend-inner-icon":"mdi-text",rows:"3",counter:"500",rules:t.descriptionRules},null,8,["modelValue"])]),_:1}),t.isEditing?(x(),O(p,{key:1,cols:"12"},{default:i(()=>[a(le,{modelValue:t.formData.isActive,"onUpdate:modelValue":e[6]||(e[6]=o=>t.formData.isActive=o),label:"Organização ativa",color:"success","hide-details":""},null,8,["modelValue"])]),_:1})):U("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(ue,{class:"px-6 py-4 bg-surface border-t"},{default:i(()=>[a(me),a(D,{variant:"text",onClick:t.handleCancel,disabled:t.loading},{default:i(()=>[...e[11]||(e[11]=[u(" Cancelar ",-1)])]),_:1},8,["disabled"]),a(D,{color:"primary",variant:"flat",loading:t.loading,disabled:!t.valid,onClick:t.handleSubmit},{default:i(()=>[u(g(t.isEditing?"Salvar Alterações":"Criar Organização"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const nt=ne(st,[["render",rt],["__scopeId","data-v-5c943b78"],["__file","D:/Development/Projetos/Mira/mira-client/src/components/organizations/OrganizationFormDialog.vue"]]),dt=re({__name:"OrganizationDetailsDialog",props:{modelValue:{type:Boolean,required:!0},organization:{type:[Object,null],required:!1,default:null}},emits:["update:modelValue","edit"],setup(r,{expose:e}){e();const n=r,{isDemoUser:t}=q(),c=W(()=>{if(!n.organization)return{users:0,repositories:0,analyses:0};if(n.organization.stats)return n.organization.stats;if(t.value)switch(n.organization.slug){case"prodeb":return{users:42,repositories:18,analyses:156};case"demo":return{users:8,repositories:5,analyses:23};case"test-settings":return{users:3,repositories:2,analyses:12};default:return{users:1,repositories:1,analyses:3}}return{users:0,repositories:0,analyses:0}}),f=S.getAvailableTiers(),o=S.getAvailableStatuses();function v(y){return f.find(C=>C.value===y)?.title||y}function w(y){return o.find(C=>C.value===y)?.title||y}function d(y){switch(y){case"active":return"mdi-check-circle";case"inactive":return"mdi-pause-circle";case"suspended":return"mdi-alert-circle";default:return"mdi-help-circle"}}const V={props:n,isDemoUser:t,stats:c,tierOptions:f,statusOptions:o,getTierLabel:v,getStatusLabel:w,getStatusIcon:d,get organizationsService(){return S}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),ut={class:"d-flex align-center"},mt={class:"mb-6"},ct={class:"d-flex align-center mb-4"},gt={class:"flex-grow-1"},ft={class:"text-h5 font-weight-bold mb-2"},vt={class:"d-flex align-center ga-2 mb-2"},pt={class:"text-body-2 text-medium-emphasis mb-0"},bt={class:"mb-6"},yt={class:"mb-4"},wt={class:"font-weight-medium"},zt={class:"mb-4"},Vt={class:"font-weight-medium"},Dt={class:"mb-4"},xt={class:"font-weight-medium"},_t=["href"],St={class:"mb-4"},ht={class:"font-weight-medium"},Ot=["href"],kt={class:"mb-6"},At={class:"mb-4"},Ct={class:"font-weight-medium"},Tt={class:"mb-4"},Ut={class:"font-weight-medium"},Pt={class:"mb-6"},Et={class:"text-h4 font-weight-bold"},Rt={class:"text-h4 font-weight-bold"},Bt={class:"text-h4 font-weight-bold"},It={key:0},Ft={class:"d-flex gap-2 flex-wrap"};function Lt(r,e,n,t,c,f){return x(),O(ce,{"model-value":n.modelValue,"onUpdate:modelValue":e[3]||(e[3]=o=>r.$emit("update:modelValue",o)),"max-width":"800",scrollable:""},{default:i(()=>[n.organization?(x(),O(P,{key:0},{default:i(()=>[a(de,{class:"text-h6 d-flex align-center justify-space-between bg-primary text-white sticky-header"},{default:i(()=>[s("div",ut,[a(_,{class:"me-2"},{default:i(()=>[...e[4]||(e[4]=[u("mdi-domain",-1)])]),_:1}),e[5]||(e[5]=u(" Detalhes da Organização ",-1))]),a(D,{icon:"mdi-close",variant:"text",size:"small",color:"white",onClick:e[0]||(e[0]=o=>r.$emit("update:modelValue",!1))})]),_:1}),n.organization?(x(),O(F,{key:0},{default:i(()=>[s("div",mt,[s("div",ct,[a(ze,{size:"64",color:"primary",class:"me-4"},{default:i(()=>[a(_,{size:"32"},{default:i(()=>[...e[6]||(e[6]=[u("mdi-domain",-1)])]),_:1})]),_:1}),s("div",gt,[s("h2",ft,g(n.organization.name),1),s("div",vt,[a(N,{color:t.organizationsService.getTierColor(n.organization.tier),size:"small",variant:"flat"},{default:i(()=>[a(_,{start:"",size:"12"},{default:i(()=>[...e[7]||(e[7]=[u("mdi-crown",-1)])]),_:1}),u(" "+g(t.getTierLabel(n.organization.tier)),1)]),_:1},8,["color"]),a(N,{color:t.organizationsService.getStatusColor(n.organization.status),size:"small",variant:"flat"},{default:i(()=>[a(_,{start:"",size:"12"},{default:i(()=>[u(g(t.getStatusIcon(n.organization.status)),1)]),_:1}),u(" "+g(t.getStatusLabel(n.organization.status)),1)]),_:1},8,["color"]),a(N,{color:n.organization.isActive?"success":"error",size:"small",variant:"flat"},{default:i(()=>[a(_,{start:"",size:"12"},{default:i(()=>[u(g(n.organization.isActive?"mdi-check":"mdi-close"),1)]),_:1}),u(" "+g(n.organization.isActive?"Ativa":"Inativa"),1)]),_:1},8,["color"])]),s("p",pt,g(n.organization.description||"Sem descrição"),1)])])]),s("div",bt,[e[13]||(e[13]=s("h3",{class:"text-subtitle-1 font-weight-medium mb-3"},"Informações Básicas",-1)),a(J,null,{default:i(()=>[a(p,{cols:"12",md:"6"},{default:i(()=>[s("div",yt,[e[8]||(e[8]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"ID",-1)),s("div",wt,g(n.organization.id),1)])]),_:1}),a(p,{cols:"12",md:"6"},{default:i(()=>[s("div",zt,[e[9]||(e[9]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Slug",-1)),s("div",Vt,g(n.organization.slug),1)])]),_:1}),a(p,{cols:"12",md:"6"},{default:i(()=>[s("div",Dt,[e[10]||(e[10]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Email",-1)),s("div",xt,[s("a",{href:`mailto:${n.organization.email}`,class:"text-decoration-none"},g(n.organization.email),9,_t)])])]),_:1}),n.organization.website?(x(),O(p,{key:0,cols:"12",md:"6"},{default:i(()=>[s("div",St,[e[12]||(e[12]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Website",-1)),s("div",ht,[s("a",{href:n.organization.website,target:"_blank",class:"text-decoration-none"},[u(g(n.organization.website)+" ",1),a(_,{size:"12",class:"ml-1"},{default:i(()=>[...e[11]||(e[11]=[u("mdi-open-in-new",-1)])]),_:1})],8,Ot)])])]),_:1})):U("",!0)]),_:1})]),s("div",kt,[e[16]||(e[16]=s("h3",{class:"text-subtitle-1 font-weight-medium mb-3"},"Datas",-1)),a(J,null,{default:i(()=>[a(p,{cols:"12",md:"6"},{default:i(()=>[s("div",At,[e[14]||(e[14]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Criada em",-1)),s("div",Ct,g(t.organizationsService.formatDate(n.organization.createdAt)),1)])]),_:1}),a(p,{cols:"12",md:"6"},{default:i(()=>[s("div",Tt,[e[15]||(e[15]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Última atualização",-1)),s("div",Ut,g(t.organizationsService.formatDate(n.organization.updatedAt)),1)])]),_:1})]),_:1})]),s("div",Pt,[e[23]||(e[23]=s("h3",{class:"text-subtitle-1 font-weight-medium mb-3"},"Estatísticas",-1)),a(J,null,{default:i(()=>[a(p,{cols:"12",md:"4"},{default:i(()=>[a(P,{variant:"tonal",color:"primary"},{default:i(()=>[a(F,{class:"text-center"},{default:i(()=>[a(_,{size:"32",class:"mb-2"},{default:i(()=>[...e[17]||(e[17]=[u("mdi-account-group",-1)])]),_:1}),s("div",Et,g(t.stats.users),1),e[18]||(e[18]=s("div",{class:"text-caption"},"Usuários",-1))]),_:1})]),_:1})]),_:1}),a(p,{cols:"12",md:"4"},{default:i(()=>[a(P,{variant:"tonal",color:"success"},{default:i(()=>[a(F,{class:"text-center"},{default:i(()=>[a(_,{size:"32",class:"mb-2"},{default:i(()=>[...e[19]||(e[19]=[u("mdi-source-repository",-1)])]),_:1}),s("div",Rt,g(t.stats.repositories),1),e[20]||(e[20]=s("div",{class:"text-caption"},"Repositórios",-1))]),_:1})]),_:1})]),_:1}),a(p,{cols:"12",md:"4"},{default:i(()=>[a(P,{variant:"tonal",color:"warning"},{default:i(()=>[a(F,{class:"text-center"},{default:i(()=>[a(_,{size:"32",class:"mb-2"},{default:i(()=>[...e[21]||(e[21]=[u("mdi-file-document-multiple",-1)])]),_:1}),s("div",Bt,g(t.stats.analyses),1),e[22]||(e[22]=s("div",{class:"text-caption"},"Análises",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),t.isDemoUser?U("",!0):(x(),we("div",It,[e[28]||(e[28]=s("h3",{class:"text-subtitle-1 font-weight-medium mb-3"},"Ações Rápidas",-1)),s("div",Ft,[a(D,{color:"primary",variant:"outlined","prepend-icon":"mdi-pencil",onClick:e[1]||(e[1]=o=>r.$emit("edit"))},{default:i(()=>[...e[24]||(e[24]=[u(" Editar ",-1)])]),_:1}),a(D,{color:"info",variant:"outlined","prepend-icon":"mdi-cog",to:"/settings",class:"ml-2"},{default:i(()=>[...e[25]||(e[25]=[u(" Configurações ",-1)])]),_:1}),a(D,{color:"success",variant:"outlined","prepend-icon":"mdi-account-group",disabled:"",class:"ml-2"},{default:i(()=>[...e[26]||(e[26]=[u(" Usuários ",-1)])]),_:1}),a(D,{color:"warning",variant:"outlined","prepend-icon":"mdi-source-repository",disabled:"",class:"ml-2"},{default:i(()=>[...e[27]||(e[27]=[u(" Repositórios ",-1)])]),_:1})])]))]),_:1})):U("",!0),a(ue,{class:"px-6 py-4 bg-surface border-t"},{default:i(()=>[a(me),a(D,{variant:"text",color:"primary",onClick:e[2]||(e[2]=o=>r.$emit("update:modelValue",!1))},{default:i(()=>[...e[29]||(e[29]=[u(" Fechar ",-1)])]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1},8,["model-value"])}const jt=ne(dt,[["render",Lt],["__scopeId","data-v-6c911aee"],["__file","D:/Development/Projetos/Mira/mira-client/src/components/organizations/OrganizationDetailsDialog.vue"]]),qt=re({__name:"OrganizationsView",setup(r,{expose:e}){e();const{isDemoUser:n}=q(),t=h([]),c=h(!1),f=h(!1),o=h(0),v=h(!1),w=h(!1),d=h(!1),V=h(null),y=ye({search:"",tier:void 0,status:void 0,isActive:void 0,page:1,limit:20,sortBy:"createdAt",sortOrder:"desc"}),k=h([{key:"createdAt",order:"desc"}]),C=[{title:"Organização",key:"name",sortable:!0},{title:"Email",key:"email",sortable:!0},{title:"Plano",key:"tier",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Ativa",key:"isActive",sortable:!0},{title:"Criada em",key:"createdAt",sortable:!0},{title:"Ações",key:"actions",sortable:!1,align:"center"}],T=S.getAvailableTiers(),E=S.getAvailableStatuses();async function A(){try{if(c.value=!0,k.value.length>0&&(y.sortBy=k.value[0].key,y.sortOrder=k.value[0].order),n.value){await new Promise(b=>setTimeout(b,1e3));const m=[{id:"b1e58ac3-6a88-4fc3-846d-352c8ca4a1db",name:"PRODEB",slug:"prodeb",description:"Companhia de Processamento de Dados do Estado da Bahia",email:"contato@prodeb.ba.gov.br",website:"https://www.prodeb.ba.gov.br",status:"active",tier:"enterprise",isActive:!0,createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-11-13T08:30:00Z"},{id:"7f3e8b2c-4a1d-4e9f-8c2b-5d6e7a8b9c0d",name:"Demo Organization",slug:"demo",description:"Organização de demonstração para testes",email:"demo@test.mira-api.com",website:"https://demo.mira-api.com",status:"trial",tier:"professional",isActive:!0,createdAt:"2024-02-20T14:15:00Z",updatedAt:"2024-11-12T16:45:00Z"},{id:"4d2f8e1c-9b7a-4e6f-8c3d-5a1b2c3d4e5f",name:"Test Settings Organization",slug:"test-settings",description:"Organização para testar diferentes configurações",email:"test-settings@mira-api.com",website:"https://test-settings.mira-api.com",status:"active",tier:"professional",isActive:!0,createdAt:"2024-03-10T09:30:00Z",updatedAt:"2024-11-10T11:20:00Z"}];t.value=m,o.value=m.length}else{const m={...y,includeStats:!0},b=await S.getOrganizations(m);t.value=b.data||[],o.value=b.total||0}}catch(m){console.error("Erro ao carregar organizações:",m),t.value=[],o.value=0}finally{c.value=!1}}const R=Ee(()=>{y.page=1,A()},500);function L(){y.page=1,A()}function M(m){V.value=m,w.value=!0}function G(m){V.value=m,v.value=!0}async function j(m){if(n.value){m.isActive=!m.isActive,m.status=m.isActive?"active":"inactive";return}try{let b;m.isActive?b=await S.suspendOrganization(m.id):b=await S.activateOrganization(m.id),Object.assign(m,b)}catch(b){if(console.error("Erro ao alterar status:",b),b&&typeof b=="object"&&"response"in b){const z=b;console.error("Status:",z.response?.status),console.error("Data:",z.response?.data)}console.error("Token exists:",!!localStorage.getItem("mira_access_token"))}}function l(m){V.value=m,d.value=!0}async function Q(){if(V.value)try{f.value=!0,await S.deleteOrganization(V.value.id),await A(),d.value=!1,V.value=null}catch(m){console.error("Erro ao excluir organização:",m)}finally{f.value=!1}}function X(){A(),v.value=!1,V.value=null}function Y(){w.value=!1,v.value=!0}function $(m){return T.find(z=>z.value===m)?.title||m}function ee(m){return E.find(z=>z.value===m)?.title||m}function te(m){switch(m){case"active":return"mdi-check-circle";case"inactive":return"mdi-pause-circle";case"suspended":return"mdi-alert-circle";default:return"mdi-help-circle"}}Ae(()=>{A()});const K={isDemoUser:n,organizations:t,loading:c,deleting:f,totalItems:o,showCreateDialog:v,showDetailsDialog:w,showDeleteDialog:d,selectedOrganization:V,filters:y,sortBy:k,headers:C,tierOptions:T,statusOptions:E,loadOrganizations:A,debouncedSearch:R,applyFilters:L,viewOrganization:M,editOrganization:G,toggleActive:j,confirmDelete:l,deleteOrganization:Q,handleOrganizationSaved:X,handleEditFromDetails:Y,getTierLabel:$,getStatusLabel:ee,getStatusIcon:te,get organizationsService(){return S},OrganizationFormDialog:nt,OrganizationDetailsDialog:jt};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),Nt={class:"organizations-page"},Mt={class:"d-flex justify-space-between align-center mb-6"},Gt={class:"d-flex align-center"},Ht={class:"font-weight-bold"},Wt={class:"text-caption text-grey-darken-1"},Zt={class:"text-caption"},Jt={class:"d-flex gap-1 align-center justify-center"};function Kt(r,e,n,t,c,f){return x(),we("div",Nt,[s("div",Mt,[e[13]||(e[13]=s("div",null,[s("h1",{class:"text-h4 font-weight-bold text-high-emphasis mb-2"}," Organizações "),s("p",{class:"text-body-1 text-grey-darken-1"}," Gerencie as organizações do sistema ")],-1)),t.isDemoUser?U("",!0):(x(),O(D,{key:0,color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=o=>t.showCreateDialog=!0)},{default:i(()=>[...e[12]||(e[12]=[u(" Nova Organização ",-1)])]),_:1}))]),a(P,{class:"mb-6"},{default:i(()=>[a(F,null,{default:i(()=>[a(J,null,{default:i(()=>[a(p,{cols:"12",md:"4"},{default:i(()=>[a(H,{modelValue:t.filters.search,"onUpdate:modelValue":e[1]||(e[1]=o=>t.filters.search=o),label:"Buscar organizações","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",clearable:"",onInput:t.debouncedSearch},null,8,["modelValue","onInput"])]),_:1}),a(p,{cols:"12",md:"3"},{default:i(()=>[a(se,{modelValue:t.filters.tier,"onUpdate:modelValue":[e[2]||(e[2]=o=>t.filters.tier=o),t.applyFilters],items:t.tierOptions,label:"Plano",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","items"])]),_:1}),a(p,{cols:"12",md:"3"},{default:i(()=>[a(se,{modelValue:t.filters.status,"onUpdate:modelValue":[e[3]||(e[3]=o=>t.filters.status=o),t.applyFilters],items:t.statusOptions,label:"Status",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","items"])]),_:1}),a(p,{cols:"12",md:"2"},{default:i(()=>[a(le,{modelValue:t.filters.isActive,"onUpdate:modelValue":[e[4]||(e[4]=o=>t.filters.isActive=o),t.applyFilters],label:"Apenas ativas",color:"primary","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(P,null,{default:i(()=>[a(it,{"items-per-page":t.filters.limit,"onUpdate:itemsPerPage":e[5]||(e[5]=o=>t.filters.limit=o),page:t.filters.page,"onUpdate:page":e[6]||(e[6]=o=>t.filters.page=o),"sort-by":t.sortBy,"onUpdate:sortBy":e[7]||(e[7]=o=>t.sortBy=o),headers:t.headers,items:t.organizations,"items-length":t.totalItems,loading:t.loading,"item-key":"id","onUpdate:options":t.loadOrganizations},{"item.name":i(({item:o})=>[s("div",Gt,[a(ze,{size:"40",color:"primary",class:"mr-3"},{default:i(()=>[a(_,null,{default:i(()=>[...e[14]||(e[14]=[u("mdi-domain",-1)])]),_:1})]),_:1}),s("div",null,[s("div",Ht,g(o.name),1),s("div",Wt,g(o.slug),1)])])]),"item.tier":i(({item:o})=>[a(N,{color:t.organizationsService.getTierColor(o.tier),size:"small",variant:"tonal"},{default:i(()=>[u(g(t.getTierLabel(o.tier)),1)]),_:2},1032,["color"])]),"item.status":i(({item:o})=>[a(N,{color:t.organizationsService.getStatusColor(o.status),size:"small",variant:"tonal"},{default:i(()=>[a(_,{start:"",size:"12"},{default:i(()=>[u(g(t.getStatusIcon(o.status)),1)]),_:2},1024),u(" "+g(t.getStatusLabel(o.status)),1)]),_:2},1032,["color"])]),"item.isActive":i(({item:o})=>[t.isDemoUser?(x(),O(N,{key:1,color:o.isActive?"success":"error",size:"small",variant:"tonal"},{default:i(()=>[u(g(o.isActive?"Ativa":"Inativa"),1)]),_:2},1032,["color"])):(x(),O(le,{key:0,"model-value":o.isActive,color:"success","hide-details":"","onUpdate:modelValue":v=>t.toggleActive(o)},null,8,["model-value","onUpdate:modelValue"]))]),"item.createdAt":i(({item:o})=>[s("div",Zt,g(t.organizationsService.formatDate(o.createdAt)),1)]),"item.actions":i(({item:o})=>[s("div",Jt,[a(oe,{text:"Ver detalhes",class:"custom-tooltip"},{activator:i(({props:v})=>[a(D,Z(v,{icon:"mdi-eye",variant:"text",size:"small",onClick:w=>t.viewOrganization(o)}),null,16,["onClick"])]),_:2},1024),t.isDemoUser?U("",!0):(x(),O(oe,{key:0,text:"Editar",class:"custom-tooltip"},{activator:i(({props:v})=>[a(D,Z(v,{icon:"mdi-pencil",variant:"text",size:"small",onClick:w=>t.editOrganization(o)}),null,16,["onClick"])]),_:2},1024)),t.isDemoUser?U("",!0):(x(),O(oe,{key:1,text:"Excluir",class:"custom-tooltip"},{activator:i(({props:v})=>[a(D,Z(v,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:w=>t.confirmDelete(o)}),null,16,["onClick"])]),_:2},1024))])]),loading:i(()=>[a(et,{type:"table-row@5"})]),_:2},1032,["items-per-page","page","sort-by","items","items-length","loading"])]),_:1}),a(t.OrganizationFormDialog,{modelValue:t.showCreateDialog,"onUpdate:modelValue":e[8]||(e[8]=o=>t.showCreateDialog=o),organization:t.selectedOrganization,onSaved:t.handleOrganizationSaved},null,8,["modelValue","organization"]),a(t.OrganizationDetailsDialog,{modelValue:t.showDetailsDialog,"onUpdate:modelValue":e[9]||(e[9]=o=>t.showDetailsDialog=o),organization:t.selectedOrganization,onEdit:t.handleEditFromDetails},null,8,["modelValue","organization"]),a(ce,{modelValue:t.showDeleteDialog,"onUpdate:modelValue":e[11]||(e[11]=o=>t.showDeleteDialog=o),"max-width":"500"},{default:i(()=>[a(P,null,{default:i(()=>[a(de,{class:"text-h5"},{default:i(()=>[...e[15]||(e[15]=[u(" Confirmar Exclusão ",-1)])]),_:1}),a(F,null,{default:i(()=>[e[17]||(e[17]=u(" Tem certeza que deseja excluir a organização ",-1)),s("strong",null,g(t.selectedOrganization?.name),1),e[18]||(e[18]=u("? ",-1)),a(tt,{type:"warning",class:"mt-4"},{default:i(()=>[...e[16]||(e[16]=[u(" Esta ação não pode ser desfeita e todos os dados relacionados serão perdidos. ",-1)])]),_:1})]),_:1}),a(ue,null,{default:i(()=>[a(me),a(D,{variant:"text",onClick:e[10]||(e[10]=o=>t.showDeleteDialog=!1)},{default:i(()=>[...e[19]||(e[19]=[u(" Cancelar ",-1)])]),_:1}),a(D,{color:"error",variant:"flat",loading:t.deleting,onClick:t.deleteOrganization},{default:i(()=>[...e[20]||(e[20]=[u(" Excluir ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Sa=ne(qt,[["render",Kt],["__scopeId","data-v-24f8d7b6"],["__file","D:/Development/Projetos/Mira/mira-client/src/views/organizations/OrganizationsView.vue"]]);export{Sa as default};
