import{k as de,W as ue,f as v,r as me,w as ce,E as fe,X as u,z as o,q as t,_ as f,Q as x,T as l,a1 as d,F as M,a8 as O,S as n,a4 as i,x as ge}from"./vendor-vue-BvKyvIVR.js";import{r as T}from"./rule-templates-_Ek9i4FY.js";import{r as ve}from"./rules-BedYAZrK.js";import{u as pe,a as k}from"./VChip-BzUv3cXC.js";import{_ as ye}from"./index-CQBjCOQw.js";import{L as _e}from"./vendor-ui-Dz8XL-co.js";import{f as y,j as V,o as be,k as C,l as xe,p as Ve}from"./VGrid-CuJrScxf.js";import{V as q,a as p}from"./VRow-C_rLTo1r.js";import{V as g}from"./VIcon-CM-KW5Qw.js";import{V as Te}from"./VPagination-C7VPvwfo.js";import{V as ke}from"./VDialog-C6XAQXKq.js";import{V as Ce,a as j}from"./VSelect-JVxEisdn.js";import{V as we}from"./VSwitch-K3EdCM7X.js";import{V as De}from"./VMenu-B2XC7rkF.js";import{a as ze,b as A,c as S,V as he}from"./VList-CaAoEaF2.js";import{V as Ae}from"./VSpacer-kp13s616.js";import"./auth-PiWOMLtm.js";import"./vendor-utils-Cfk84l6i.js";import"./token-storage.service-BqAv9k07.js";import"./tag-Bnbpnddf.js";import"./dimensions-DVh0fwa7.js";import"./forwardRefs-D_qxKlPu.js";import"./autofocus-Bh6bNAdk.js";import"./lazy-DADzjSlN.js";import"./ssrBoot-COakMcr6.js";const G="b1e58ac3-6a88-4fc3-846d-352c8ca4a1db",Se=de({__name:"RuleTemplatesView",setup(W,{expose:e}){e();const w=ue(),{isDemoUser:a}=pe(),E=v({data:[],total:0,page:1,limit:10,totalPages:0}),L=v(null),s=v([]),m=v([]),P=v(!1),B=v(null),z=v(1),R=v(!1),D=v(null),U=v(!1),c=me({search:"",severity:void 0,category:void 0,language:void 0,isActive:void 0,page:1,limit:10}),X=[{title:"Baixa",value:"low"},{title:"Média",value:"medium"},{title:"Alta",value:"high"},{title:"Crítica",value:"critical"}],_=async()=>{P.value=!0,B.value=null;try{const[r,b,N,F]=await Promise.all([T.getRuleTemplates(c),T.getStatistics(),T.getCategories(),T.getLanguages()]);E.value=r,L.value=b,s.value=N,m.value=F}catch(r){B.value=r instanceof Error?r.message:"Erro ao carregar dados"}finally{P.value=!1}},H=()=>{_()},J=()=>{c.search="",c.severity=void 0,c.category=void 0,c.language=void 0,c.isActive=void 0,z.value=1,c.page=1,_()},K=r=>{z.value=r,c.page=r,_()},Y=()=>{w.push("/rule-templates/add")},Z=r=>{w.push(`/rule-templates/${r}`)},$=r=>{w.push(`/rule-templates/${r}/edit`)},ee=async r=>{try{const b=await T.getRuleTemplate(r),{id:N,createdAt:F,updatedAt:yt,createdBy:_t,updatedBy:bt,...re}=b,ne={...re,title:`${b.title} (Cópia)`,isGlobal:!1};await T.createRuleTemplate(ne),_()}catch(b){console.error("Erro ao duplicar template:",b)}},te=async r=>{if(confirm("Tem certeza que deseja deletar este template?"))try{await T.deleteRuleTemplate(r),_()}catch(b){console.error("Erro ao deletar template:",b)}},le=r=>{D.value=r,R.value=!0},ae=async()=>{if(D.value){U.value=!0;try{await ve.createRuleConfig(G,{ruleTemplateId:D.value.id,isEnabled:!0,status:"enabled",customSeverity:D.value.severity}),R.value=!1,D.value=null,w.push("/rules")}catch(r){console.error("Erro ao configurar template:",r)}finally{U.value=!1}}},se=r=>{switch(r){case"low":return"success";case"medium":return"warning";case"high":return"orange";case"critical":return"error";default:return"grey"}},oe=r=>{switch(r){case"low":return"Baixa";case"medium":return"Média";case"high":return"Alta";case"critical":return"Crítica";default:return"N/A"}},ie=r=>new Date(r).toLocaleDateString("pt-BR");let h;ce(c,()=>{clearTimeout(h),h=setTimeout(()=>{c.page=1,z.value=1,_()},500)},{deep:!0}),fe(()=>{_()});const I={router:w,isDemoUser:a,organizationId:G,ruleTemplates:E,stats:L,availableCategories:s,availableLanguages:m,loading:P,error:B,currentPage:z,showConfigureDialog:R,selectedTemplate:D,configuringTemplate:U,filters:c,severityOptions:X,loadData:_,refreshData:H,clearFilters:J,onPageChange:K,createTemplate:Y,viewTemplate:Z,editTemplate:$,duplicateTemplate:ee,deleteTemplate:te,configureTemplate:le,confirmConfigureTemplate:ae,getSeverityColor:se,getSeverityLabel:oe,formatDate:ie,get debounceTimeout(){return h},set debounceTimeout(r){h=r}};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),Q=_e("v-code","code"),Ee={class:"rule-templates-page"},Le={class:"d-flex align-center justify-space-between mb-6"},Pe={class:"d-flex align-center gap-3"},Be={class:"d-flex align-center"},Re={class:"text-h5 font-weight-bold"},Ue={class:"d-flex align-center"},je={class:"text-h5 font-weight-bold"},Ie={class:"d-flex align-center"},Ne={class:"text-h5 font-weight-bold"},Fe={class:"d-flex align-center"},Me={class:"text-h5 font-weight-bold"},Oe={key:0,class:"text-center py-8"},qe={key:1,class:"text-center py-8"},Ge={class:"text-body-2 text-grey-darken-1 mb-4"},Qe={key:2},We={class:"d-flex justify-space-between align-start"},Xe={class:"flex-grow-1"},He={class:"d-flex align-center mb-3"},Je={class:"text-h6 mr-3"},Ke={class:"text-body-2 text-grey-darken-1 mb-3"},Ye={key:0,class:"mb-3"},Ze={class:"text-body-2 text-grey-darken-1"},$e={key:1,class:"mb-3"},et={class:"d-flex gap-4"},tt={key:0,class:"flex-1"},lt={key:1,class:"flex-1"},at={key:2,class:"mb-2"},st={class:"d-flex justify-space-between align-center"},ot={class:"text-caption text-grey"},it={class:"d-flex align-center gap-2"},rt={class:"d-flex flex-column align-end"},nt={key:0,class:"text-center py-8"},dt={class:"text-body-2 text-grey-darken-1"},ut={key:0},mt={key:1},ct={key:3,class:"d-flex justify-center mt-6"},ft={class:"mb-4"},gt={class:"text-h6 mb-2"},vt={class:"text-body-2 text-grey-darken-1"};function pt(W,e,w,a,E,L){return n(),u("div",Ee,[o("div",Le,[e[10]||(e[10]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold text-grey-darken-3 mb-2"}," Templates de Regras "),o("p",{class:"text-body-1 text-grey-darken-1"}," Biblioteca de templates de regras disponíveis para análise de código ")],-1)),o("div",Pe,[t(y,{color:"primary","prepend-icon":"mdi-refresh",onClick:a.refreshData,loading:a.loading},{default:l(()=>[...e[8]||(e[8]=[i(" Atualizar ",-1)])]),_:1},8,["loading"]),a.isDemoUser?f("",!0):(n(),x(y,{key:0,color:"success","prepend-icon":"mdi-plus",variant:"elevated",onClick:a.createTemplate},{default:l(()=>[...e[9]||(e[9]=[i(" Novo Template ",-1)])]),_:1}))])]),t(q,{class:"mb-6"},{default:l(()=>[t(p,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(V,{color:"primary",variant:"tonal"},{default:l(()=>[t(C,null,{default:l(()=>[o("div",Be,[t(g,{size:"32",class:"mr-3"},{default:l(()=>[...e[11]||(e[11]=[i("mdi-file-document-multiple",-1)])]),_:1}),o("div",null,[o("div",Re,d(a.stats?.total||0),1),e[12]||(e[12]=o("div",{class:"text-caption"},"Total de Templates",-1))])])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(V,{color:"success",variant:"tonal"},{default:l(()=>[t(C,null,{default:l(()=>[o("div",Ue,[t(g,{size:"32",class:"mr-3"},{default:l(()=>[...e[13]||(e[13]=[i("mdi-check-circle",-1)])]),_:1}),o("div",null,[o("div",je,d(a.stats?.active||0),1),e[14]||(e[14]=o("div",{class:"text-caption"},"Ativos",-1))])])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(V,{color:"warning",variant:"tonal"},{default:l(()=>[t(C,null,{default:l(()=>[o("div",Ie,[t(g,{size:"32",class:"mr-3"},{default:l(()=>[...e[15]||(e[15]=[i("mdi-alert-circle",-1)])]),_:1}),o("div",null,[o("div",Ne,d(a.stats?.bySeverity?.high||0),1),e[16]||(e[16]=o("div",{class:"text-caption"},"Alta Severidade",-1))])])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(V,{color:"info",variant:"tonal"},{default:l(()=>[t(C,null,{default:l(()=>[o("div",Fe,[t(g,{size:"32",class:"mr-3"},{default:l(()=>[...e[17]||(e[17]=[i("mdi-earth",-1)])]),_:1}),o("div",null,[o("div",Me,d(Object.keys(a.stats?.byLanguage||{}).length),1),e[18]||(e[18]=o("div",{class:"text-caption"},"Linguagens",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),t(V,{class:"mb-6"},{default:l(()=>[t(C,null,{default:l(()=>[t(q,null,{default:l(()=>[t(p,{cols:"12",md:"3"},{default:l(()=>[t(Ce,{modelValue:a.filters.search,"onUpdate:modelValue":e[0]||(e[0]=s=>a.filters.search=s),label:"Buscar templates","prepend-inner-icon":"mdi-magnify",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"2"},{default:l(()=>[t(j,{modelValue:a.filters.severity,"onUpdate:modelValue":e[1]||(e[1]=s=>a.filters.severity=s),items:a.severityOptions,label:"Severidade",variant:"outlined",density:"compact",clearable:"","item-title":"title","item-value":"value"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"2"},{default:l(()=>[t(j,{modelValue:a.filters.category,"onUpdate:modelValue":e[2]||(e[2]=s=>a.filters.category=s),items:a.availableCategories,label:"Categoria",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),t(p,{cols:"12",md:"2"},{default:l(()=>[t(j,{modelValue:a.filters.language,"onUpdate:modelValue":e[3]||(e[3]=s=>a.filters.language=s),items:a.availableLanguages,label:"Linguagem",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),t(p,{cols:"12",md:"2"},{default:l(()=>[t(we,{modelValue:a.filters.isActive,"onUpdate:modelValue":e[4]||(e[4]=s=>a.filters.isActive=s),label:"Apenas ativos",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"1"},{default:l(()=>[t(y,{icon:"mdi-filter-off",variant:"outlined",onClick:a.clearFilters,title:"Limpar filtros"})]),_:1})]),_:1})]),_:1})]),_:1}),a.loading?(n(),u("div",Oe,[t(be,{indeterminate:"",color:"primary",size:"64"}),e[19]||(e[19]=o("div",{class:"mt-4 text-body-1"},"Carregando templates...",-1))])):a.error?(n(),u("div",qe,[t(g,{size:"64",color:"error",class:"mb-4"},{default:l(()=>[...e[20]||(e[20]=[i("mdi-alert-circle",-1)])]),_:1}),e[22]||(e[22]=o("div",{class:"text-h6 mb-2"},"Erro ao carregar dados",-1)),o("div",Ge,d(a.error),1),t(y,{color:"primary",onClick:a.refreshData},{default:l(()=>[...e[21]||(e[21]=[i("Tentar Novamente",-1)])]),_:1})])):(n(),u("div",Qe,[(n(!0),u(M,null,O(a.ruleTemplates.data,s=>(n(),x(V,{key:s.id,class:"mb-4"},{default:l(()=>[t(C,null,{default:l(()=>[o("div",We,[o("div",Xe,[o("div",He,[o("h3",Je,d(s.title),1),t(k,{color:a.getSeverityColor(s.severity),size:"small",class:"mr-2"},{default:l(()=>[i(d(a.getSeverityLabel(s.severity)),1)]),_:2},1032,["color"]),t(k,{color:s.isActive?"success":"error",size:"small",class:"mr-2"},{default:l(()=>[i(d(s.isActive?"Ativo":"Inativo"),1)]),_:2},1032,["color"]),s.isGlobal?(n(),x(k,{key:0,color:"purple",size:"small",class:"mr-2"},{default:l(()=>[...e[23]||(e[23]=[i(" Global ",-1)])]),_:1})):f("",!0),t(k,{color:"info",size:"small",variant:"outlined"},{default:l(()=>[i(d(s.category),1)]),_:2},1024)]),o("p",Ke,d(s.rule),1),s.whyIsThisImportant?(n(),u("div",Ye,[e[24]||(e[24]=o("div",{class:"text-body-2 font-weight-medium mb-1"},"Por que é importante:",-1)),o("p",Ze,d(s.whyIsThisImportant),1)])):f("",!0),s.badExample||s.goodExample?(n(),u("div",$e,[e[27]||(e[27]=o("div",{class:"text-body-2 font-weight-medium mb-2"},"Exemplos:",-1)),o("div",et,[s.badExample?(n(),u("div",tt,[t(k,{color:"error",size:"small",class:"mb-1"},{default:l(()=>[...e[25]||(e[25]=[i("❌ Ruim",-1)])]),_:1}),t(Q,{class:"text-body-2"},{default:l(()=>[i(d(s.badExample),1)]),_:2},1024)])):f("",!0),s.goodExample?(n(),u("div",lt,[t(k,{color:"success",size:"small",class:"mb-1"},{default:l(()=>[...e[26]||(e[26]=[i("✅ Bom",-1)])]),_:1}),t(Q,{class:"text-body-2"},{default:l(()=>[i(d(s.goodExample),1)]),_:2},1024)])):f("",!0)])])):f("",!0),s.tags&&s.tags.length?(n(),u("div",at,[(n(!0),u(M,null,O(s.tags,m=>(n(),x(k,{key:m,size:"small",variant:"outlined",class:"mr-1"},{default:l(()=>[i(d(m),1)]),_:2},1024))),128))])):f("",!0),o("div",st,[o("div",ot," Linguagem: "+d(s.language)+" | Versão: "+d(s.version)+" | Autor: "+d(s.author||"N/A")+" | Atualizado: "+d(a.formatDate(s.updatedAt)),1),o("div",it,[a.isDemoUser?f("",!0):(n(),x(y,{key:0,size:"small",color:"primary",variant:"outlined","prepend-icon":"mdi-cog",onClick:m=>a.configureTemplate(s)},{default:l(()=>[...e[28]||(e[28]=[i(" Configurar para Organização ",-1)])]),_:1},8,["onClick"]))])])]),o("div",rt,[a.isDemoUser?(n(),x(y,{key:1,icon:"mdi-eye",variant:"text",size:"small",onClick:m=>a.viewTemplate(s.id),title:"Ver Detalhes"},null,8,["onClick"])):(n(),x(De,{key:0},{activator:l(({props:m})=>[t(y,ge({icon:"mdi-dots-vertical",variant:"text",size:"small"},{ref_for:!0},m),null,16)]),default:l(()=>[t(ze,null,{default:l(()=>[t(A,{onClick:m=>a.viewTemplate(s.id)},{default:l(()=>[t(S,null,{default:l(()=>[t(g,{class:"mr-2"},{default:l(()=>[...e[29]||(e[29]=[i("mdi-eye",-1)])]),_:1}),e[30]||(e[30]=i(" Ver Detalhes ",-1))]),_:1})]),_:1},8,["onClick"]),t(A,{onClick:m=>a.editTemplate(s.id)},{default:l(()=>[t(S,null,{default:l(()=>[t(g,{class:"mr-2"},{default:l(()=>[...e[31]||(e[31]=[i("mdi-pencil",-1)])]),_:1}),e[32]||(e[32]=i(" Editar ",-1))]),_:1})]),_:1},8,["onClick"]),t(A,{onClick:m=>a.duplicateTemplate(s.id)},{default:l(()=>[t(S,null,{default:l(()=>[t(g,{class:"mr-2"},{default:l(()=>[...e[33]||(e[33]=[i("mdi-content-copy",-1)])]),_:1}),e[34]||(e[34]=i(" Duplicar ",-1))]),_:1})]),_:1},8,["onClick"]),t(he),t(A,{onClick:m=>a.deleteTemplate(s.id),class:"text-error"},{default:l(()=>[t(S,null,{default:l(()=>[t(g,{class:"mr-2"},{default:l(()=>[...e[35]||(e[35]=[i("mdi-delete",-1)])]),_:1}),e[36]||(e[36]=i(" Deletar ",-1))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))])])]),_:2},1024)]),_:2},1024))),128)),a.ruleTemplates.data?.length?f("",!0):(n(),u("div",nt,[t(V,{class:"pa-8"},{default:l(()=>[t(g,{size:"64",color:"grey",class:"mb-4"},{default:l(()=>[...e[37]||(e[37]=[i("mdi-file-document-outline",-1)])]),_:1}),e[38]||(e[38]=o("div",{class:"text-h6 mb-2"},"Nenhum template encontrado",-1)),o("div",dt,[a.isDemoUser?(n(),u("span",mt,"Tente ajustar os filtros para encontrar templates")):(n(),u("span",ut,"Tente ajustar os filtros ou criar um novo template"))])]),_:1})]))])),a.ruleTemplates.totalPages>1?(n(),u("div",ct,[t(Te,{modelValue:a.currentPage,"onUpdate:modelValue":[e[5]||(e[5]=s=>a.currentPage=s),a.onPageChange],length:a.ruleTemplates.totalPages},null,8,["modelValue","length"])])):f("",!0),t(ke,{modelValue:a.showConfigureDialog,"onUpdate:modelValue":e[7]||(e[7]=s=>a.showConfigureDialog=s),"max-width":"600px",persistent:""},{default:l(()=>[t(V,null,{default:l(()=>[t(xe,null,{default:l(()=>[t(g,{class:"mr-2"},{default:l(()=>[...e[39]||(e[39]=[i("mdi-cog",-1)])]),_:1}),e[40]||(e[40]=i(" Configurar Template para Organização ",-1))]),_:1}),a.selectedTemplate?(n(),x(C,{key:0},{default:l(()=>[o("div",ft,[o("h4",gt,d(a.selectedTemplate.title),1),o("p",vt,d(a.selectedTemplate.rule),1)]),e[41]||(e[41]=o("p",{class:"text-body-2 mb-4"}," Este template será adicionado às regras configuradas da sua organização. Você poderá personalizar severidade, mensagens e outros parâmetros após a criação. ",-1))]),_:1})):f("",!0),t(Ve,null,{default:l(()=>[t(Ae),t(y,{onClick:e[6]||(e[6]=s=>a.showConfigureDialog=!1)},{default:l(()=>[...e[42]||(e[42]=[i("Cancelar",-1)])]),_:1}),t(y,{color:"primary",onClick:a.confirmConfigureTemplate,loading:a.configuringTemplate},{default:l(()=>[...e[43]||(e[43]=[i(" Configurar ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Qt=ye(Se,[["render",pt],["__scopeId","data-v-ab3360fc"],["__file","D:/Development/Projetos/Mira/mira-client/src/views/rule-templates/RuleTemplatesView.vue"]]);export{Qt as default};
