import{d as I,E as Je,n as t,v as le,j as ge,r as Pe,h as Z,w as ve,I as ne,$ as N,a1 as e,_ as p,y as s,V as u,a6 as Qe,aa as o,a0 as P,Z as y,ah as X,F as Q,q as Ie,D as Xe,u as ce,U as et,Y as tt}from"./vendor-vue-BKuzT1x2.js";import{b as te}from"./auth.service-BozCwdnf.js";import{u as Ce}from"./useDemoMode-DpDjlFnd.js";import{V as ke}from"./VDialog-BfRWf8LZ.js";import{z as st,a as T,b as L,_ as xe}from"./index-gFSB3kms.js";import{V as at}from"./VForm-DthKd8zl.js";import{V as J,a as $}from"./VRow-C_u8820H.js";import{V as F,a as W,b as H,e as ae,c as ze}from"./VGrid-CBGRWS1y.js";import{e as Ue,j as ot,V as oe,a as se}from"./VSelect-BorMXFwi.js";import{V as it}from"./VTextarea-CqCSgYZa.js";import{V as lt}from"./VSwitch-D3bnvThN.js";import{V as _e,a as pe,c as fe}from"./VExpansionPanels-vpUymV1E.js";import{u as nt,V as Re,m as rt}from"./autofocus-Cv2p5X6o.js";import{h as dt,p as ut,q as mt,u as ct,ao as vt,a9 as pt}from"./vendor-ui-Ca7vMALJ.js";import{V as ie}from"./VAlert-BZmB2o6G.js";import{a as j,b as ft,V as gt}from"./VChip-BfcyEr4e.js";import{b as kt}from"./VList-Dg4abNUz.js";import{V as Oe}from"./VSpacer-CTPiANoM.js";import{d as xt}from"./vendor-utils-6xD0fNU8.js";import{V as bt}from"./VDataTable-CaN6duAr.js";import{V as Se}from"./VTooltip-BVPiCKg9.js";import"./token-storage.service-BqAv9k07.js";import"./auth--EmZq-C7.js";import"./dialog-transition-B8nu4acL.js";import"./form-PEXhLZdP.js";import"./VMenu-BCjbZdow.js";import"./ssrBoot-DJyMk-ri.js";import"./VPagination-B83tja3x.js";import"./VTable-SZOAnLd3.js";import"./filter-BaTOFc6H.js";const yt=ut({...rt(),...pt(ot(),["inline"])},"VCheckbox"),Tt=dt()({name:"VCheckbox",inheritAttrs:!1,props:yt(),emits:{"update:modelValue":r=>!0,"update:focused":r=>!0},setup(r,i){let{attrs:c,slots:k}=i;const g=mt(r,"modelValue"),{isFocused:x,focus:D,blur:C}=nt(r),h=I(),E=Je();return ct(()=>{const[f,A]=vt(c),l=Re.filterProps(r),R=Ue.filterProps(r);return t(Re,le({ref:h,class:["v-checkbox",r.class]},f,l,{modelValue:g.value,"onUpdate:modelValue":z=>g.value=z,id:r.id||`checkbox-${E}`,focused:x.value,style:r.style}),{...k,default:z=>{let{id:M,messagesId:q,isDisabled:V,isReadonly:n,isValid:U}=z;return t(Ue,le(R,{id:M.value,"aria-describedby":q.value,disabled:V.value,readonly:n.value},A,{error:U.value===!1,modelValue:g.value,"onUpdate:modelValue":B=>g.value=B,onFocus:D,onBlur:C}),k)}})}),st({},h)}}),w={ANALYSIS:"analysis",WEBHOOKS:"webhooks",USERS:"users",ORGANIZATIONS:"organizations",REPOSITORIES:"repositories",RULES:"rules",LOGS:"logs",SETTINGS:"settings"},he=[{name:"analysis:read",label:"Ler Análises",description:"Visualizar análises de código e seus resultados",category:w.ANALYSIS},{name:"analysis:create",label:"Criar Análises",description:"Iniciar novas análises de código",category:w.ANALYSIS},{name:"analysis:update",label:"Atualizar Análises",description:"Modificar análises existentes",category:w.ANALYSIS},{name:"analysis:delete",label:"Excluir Análises",description:"Remover análises do sistema",category:w.ANALYSIS},{name:"webhooks:read",label:"Ler Webhooks",description:"Visualizar configurações e logs de webhooks",category:w.WEBHOOKS},{name:"webhooks:create",label:"Criar Webhooks",description:"Configurar novos webhooks",category:w.WEBHOOKS},{name:"webhooks:update",label:"Atualizar Webhooks",description:"Modificar configurações de webhooks",category:w.WEBHOOKS},{name:"webhooks:delete",label:"Excluir Webhooks",description:"Remover webhooks do sistema",category:w.WEBHOOKS},{name:"users:read",label:"Ler Usuários",description:"Visualizar informações de usuários",category:w.USERS},{name:"users:create",label:"Criar Usuários",description:"Adicionar novos usuários ao sistema",category:w.USERS},{name:"users:update",label:"Atualizar Usuários",description:"Modificar informações de usuários",category:w.USERS},{name:"users:delete",label:"Excluir Usuários",description:"Remover usuários do sistema",category:w.USERS},{name:"organizations:read",label:"Ler Organizações",description:"Visualizar informações de organizações",category:w.ORGANIZATIONS},{name:"organizations:update",label:"Atualizar Organizações",description:"Modificar configurações de organizações",category:w.ORGANIZATIONS},{name:"repositories:read",label:"Ler Repositórios",description:"Visualizar informações de repositórios",category:w.REPOSITORIES},{name:"repositories:create",label:"Criar Repositórios",description:"Adicionar novos repositórios",category:w.REPOSITORIES},{name:"repositories:update",label:"Atualizar Repositórios",description:"Modificar configurações de repositórios",category:w.REPOSITORIES},{name:"repositories:delete",label:"Excluir Repositórios",description:"Remover repositórios do sistema",category:w.REPOSITORIES},{name:"rules:read",label:"Ler Regras",description:"Visualizar regras de análise",category:w.RULES},{name:"rules:create",label:"Criar Regras",description:"Criar novas regras de análise",category:w.RULES},{name:"rules:update",label:"Atualizar Regras",description:"Modificar regras existentes",category:w.RULES},{name:"rules:delete",label:"Excluir Regras",description:"Remover regras do sistema",category:w.RULES},{name:"logs:read",label:"Ler Logs",description:"Visualizar logs do sistema",category:w.LOGS},{name:"settings:read",label:"Ler Configurações",description:"Visualizar configurações do sistema",category:w.SETTINGS},{name:"settings:update",label:"Atualizar Configurações",description:"Modificar configurações do sistema",category:w.SETTINGS}];class Vt{async getTokens(i={}){const{isDemoUser:c,getMockData:k}=Ce();if(c.value){const x={};i.search&&i.search.trim()&&(x.search=i.search),i.active!==void 0&&i.active!==null&&(x.active=i.active),i.permissions&&i.permissions.length>0&&(x.permissions=i.permissions);const D=await k("apiTokens",i.page||1,i.limit||25,x);return{data:D.data,total:D.total,page:D.page,limit:D.limit,totalPages:Math.ceil(D.total/D.limit)}}const g=new URLSearchParams;return i.search&&g.append("search",i.search),i.active!==void 0&&g.append("active",i.active.toString()),i.permissions?.length&&i.permissions.forEach(x=>g.append("permissions",x)),i.page&&g.append("page",i.page.toString()),i.limit&&g.append("limit",i.limit.toString()),i.sortBy&&g.append("sortBy",i.sortBy),i.sortOrder&&g.append("sortOrder",i.sortOrder),await te.get(`/auth/tokens?${g}`)}async getTokenDetails(i){const{isDemoUser:c,getMockItem:k}=Ce();if(c.value){const g=await k("apiTokens",i);if(!g)throw new Error("Token não encontrado");return g}return await te.get(`/auth/tokens/${i}`)}async createToken(i){return await te.post("/auth/tokens",i)}async updateToken(i,c){return await te.patch(`/auth/tokens/${i}`,c)}async revokeToken(i){await te.delete(`/auth/tokens/${i}`)}async getCurrentUser(){return await te.get("/auth/me")}async getTokenStats(i={}){const k=(await this.getTokens(i)).data,g=k.length,x=k.filter(l=>l.active).length,D=new Date,C=k.filter(l=>l.expiresAt&&new Date(l.expiresAt)<D).length,h=new Date;h.setDate(h.getDate()-7);const E=k.filter(l=>l.lastUsedAt&&new Date(l.lastUsedAt)>h).length,f=new Map;k.forEach(l=>{(l.permissions||[]).forEach(z=>{f.set(z,(f.get(z)||0)+1)})});const A=Array.from(f.entries()).map(([l,R])=>({permission:l,count:R}));return{total:g,active:x,expired:C,recentlyUsed:E,byPermissions:A}}getAvailablePermissions(){return he}getPermissionsByCategory(){const i={};return he.forEach(c=>{i[c.category]||(i[c.category]=[]),i[c.category].push(c)}),i}getPermissionCategories(){return[{name:w.ANALYSIS,label:"Análises"},{name:w.WEBHOOKS,label:"Webhooks"},{name:w.USERS,label:"Usuários"},{name:w.ORGANIZATIONS,label:"Organizações"},{name:w.REPOSITORIES,label:"Repositórios"},{name:w.RULES,label:"Regras"},{name:w.LOGS,label:"Logs"},{name:w.SETTINGS,label:"Configurações"}]}validateTokenName(i){return!i||i.trim().length===0?{isValid:!1,message:"Nome do token é obrigatório"}:i.length<3?{isValid:!1,message:"Nome deve ter pelo menos 3 caracteres"}:i.length>100?{isValid:!1,message:"Nome deve ter no máximo 100 caracteres"}:/^[a-zA-Z0-9\s\-_]+$/.test(i)?{isValid:!0}:{isValid:!1,message:"Nome pode conter apenas letras, números, espaços, hífens e underscores"}}validatePermissions(i){if(!i||i.length===0)return{isValid:!1,message:"Pelo menos uma permissão deve ser selecionada"};const c=he.map(g=>g.name),k=i.filter(g=>!c.includes(g));return k.length>0?{isValid:!1,message:`Permissões inválidas: ${k.join(", ")}`}:{isValid:!0}}validateExpirationDate(i){if(!i)return{isValid:!0};if(i<=new Date)return{isValid:!1,message:"Data de expiração deve ser no futuro"};const k=new Date;return k.setFullYear(k.getFullYear()+5),i>k?{isValid:!1,message:"Data de expiração não pode ser superior a 5 anos"}:{isValid:!0}}formatTokenForDisplay(i){if(i.length<=8)return i;const c=i.substring(0,4),k=i.substring(i.length-4),g="*".repeat(Math.min(i.length-8,20));return`${c}${g}${k}`}getTokenStatusColor(i){if(!i.active)return"error";if(i.expiresAt){const c=new Date,k=new Date(i.expiresAt);if(k<c)return"error";const g=new Date;if(g.setDate(g.getDate()+30),k<g)return"warning"}return"success"}getTokenStatusText(i){if(!i.active)return"Revogado";if(i.expiresAt){const c=new Date,k=new Date(i.expiresAt);if(k<c)return"Expirado";const g=new Date;if(g.setDate(g.getDate()+30),k<g)return"Expira em breve"}return"Ativo"}async exportTokens(i={},c="csv"){const g=(await this.getTokens(i)).data;if(c==="csv"){const x=this.convertToCSV(g);return new Blob([x],{type:"text/csv"})}else{const x=JSON.stringify(g,null,2);return new Blob([x],{type:"application/json"})}}convertToCSV(i){if(i.length===0)return"";const c=["ID","Nome","Descrição","Permissões","Status","Último Uso","IP do Último Uso","Data de Expiração","Data de Criação"],k=i.map(x=>[x.id,x.name,x.description||"",x.permissions.join("; "),this.getTokenStatusText(x),x.lastUsedAt||"Nunca usado",x.lastUsedIp||"N/A",x.expiresAt||"Sem expiração",x.createdAt]);return[c.join(","),...k.map(x=>x.map(D=>`"${D}"`).join(","))].join(`
`)}}const O=new Vt,wt={class:"dialog-header"},At={class:"dialog-header-content"},St={class:"dialog-icon-wrapper"},ht={class:"dialog-title-section"},Ct={class:"dialog-title"},Dt={class:"dialog-subtitle"},$t={class:"dialog-content"},Et={class:"pt-2"},It={class:"font-weight-medium"},Ut={class:"text-caption text-medium-emphasis"},Rt={key:1,class:"mt-4"},Pt={class:"text-subtitle-2 font-weight-medium mb-2"},zt={class:"d-flex flex-wrap ga-1"},_t={class:"text-center mb-4"},Ot={class:"text-h6 mt-2"},Nt={key:0,class:"mb-3"},Bt={class:"text-body-2"},Lt={class:"mb-3"},Ft={key:1,class:"mb-3"},jt={class:"text-body-2"},Mt={class:"mb-3"},Gt={class:"text-body-2"},qt={class:"dialog-footer"},Yt={class:"dialog-actions"},Ht=ge({__name:"TokenFormDialog",props:{modelValue:{type:Boolean},token:{default:null}},emits:["update:modelValue","saved"],setup(r,{emit:i}){const c=r,k=i,g=I(),x=I(!1),D=I(!1),C=I(!1),h=I(""),E=I(""),f=Pe({name:"",description:"",permissions:[],expiresAt:void 0}),A=Z({get(){return c.modelValue},set(b){k("update:modelValue",b)}}),l=Z(()=>!!c.token),R=Z(()=>{const b=new Date;return b.setDate(b.getDate()+1),b.toISOString().slice(0,16)}),z=Z(()=>O.getPermissionCategories()),M=Z(()=>O.getPermissionsByCategory()),q=[b=>!!b||"Nome é obrigatório",b=>{const d=O.validateTokenName(b);return d.isValid||d.message}],V=[b=>!b||b.length<=500||"Descrição deve ter no máximo 500 caracteres"],n=[b=>{if(!C.value)return!0;if(!b)return"Data de expiração é obrigatória";const d=new Date(b),S=O.validateExpirationDate(d);return S.isValid||S.message}];function U(){f.name="",f.description="",f.permissions.length=0,f.expiresAt=void 0,C.value=!1,h.value="",E.value="",x.value=!1,ne(()=>{g.value?.resetValidation()})}function B(){if(c.token&&(f.name=c.token.name,f.description=c.token.description||"",f.permissions=[...c.token.permissions||[]],c.token.expiresAt)){C.value=!0;const b=new Date(c.token.expiresAt);h.value=b.toISOString().slice(0,16),f.expiresAt=b}}function _(){if(C.value){if(!h.value){const b=new Date;b.setFullYear(b.getFullYear()+1),h.value=b.toISOString().slice(0,16)}}else h.value="",f.expiresAt=void 0}function be(b){return M.value[b]||[]}function ye(b){return O.getAvailablePermissions().find(S=>S.name===b)?.label||b}function Te(b){const d=f.permissions.indexOf(b);d>-1&&f.permissions.splice(d,1)}async function re(){if(!g.value)return;const{valid:b}=await g.value.validate();if(!b)return;const d=O.validatePermissions(f.permissions);if(!d.isValid){E.value=d.message||"Erro de validação";return}E.value="",C.value&&h.value&&(f.expiresAt=new Date(h.value));try{if(D.value=!0,l.value&&c.token){const S={name:f.name,description:f.description,permissions:f.permissions,expiresAt:f.expiresAt},Y=await O.updateToken(c.token.id,S);k("saved",Y)}else{const S=await O.createToken(f);k("saved",S)}A.value=!1}catch(S){console.error("Erro ao salvar token:",S)}finally{D.value=!1}}function de(){A.value=!1}ve(()=>c.modelValue,b=>{b&&(U(),l.value&&ne(()=>{B()}))}),ve(()=>c.token,()=>{c.modelValue&&(U(),l.value&&ne(()=>{B()}))},{deep:!0}),ve(h,b=>{C.value&&b&&(f.expiresAt=new Date(b))});function Ve(b){return b?new Date(b).toLocaleDateString("pt-BR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}return(b,d)=>(p(),N(ke,{modelValue:A.value,"onUpdate:modelValue":d[6]||(d[6]=S=>A.value=S),"max-width":"1000px",persistent:"",transition:"dialog-bottom-transition",class:"modern-dialog"},{default:e(()=>[t(F,{elevation:"24",class:"dialog-card"},{default:e(()=>[s("div",wt,[s("div",At,[s("div",St,[t(T,{icon:l.value?"mdi-pencil-outline":"mdi-key-plus",size:"28",class:"dialog-icon"},null,8,["icon"])]),s("div",ht,[s("h2",Ct,u(l.value?"Editar Token de API":"Criar Novo Token de API"),1),s("p",Dt,u(l.value?"Modifique as configurações do token":"Configure um novo token de API para acessar o sistema"),1)])]),t(L,{icon:"mdi-close",variant:"text",size:"40",class:"dialog-close-btn",onClick:de})]),s("div",$t,[t(at,{ref_key:"form",ref:g,modelValue:x.value,"onUpdate:modelValue":d[5]||(d[5]=S=>x.value=S),onSubmit:Qe(re,["prevent"])},{default:e(()=>[t(J,null,{default:e(()=>[t($,{cols:"12",md:"8"},{default:e(()=>[t(F,{variant:"outlined",class:"mb-4"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...d[7]||(d[7]=[o("mdi-key",-1)])]),_:1}),d[8]||(d[8]=o(" Informações Básicas ",-1))]),_:1}),t(H,null,{default:e(()=>[t(oe,{modelValue:f.name,"onUpdate:modelValue":d[0]||(d[0]=S=>f.name=S),label:"Nome do Token *",rules:q,variant:"outlined",density:"comfortable",class:"mb-4",required:"",autofocus:""},null,8,["modelValue"]),t(it,{modelValue:f.description,"onUpdate:modelValue":d[1]||(d[1]=S=>f.description=S),label:"Descrição (opcional)",variant:"outlined",density:"comfortable",rows:"3",counter:"500",rules:V},null,8,["modelValue"])]),_:1})]),_:1}),t(F,{variant:"outlined",class:"mb-4"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...d[9]||(d[9]=[o("mdi-calendar-clock",-1)])]),_:1}),d[10]||(d[10]=o(" Configuração de Expiração ",-1))]),_:1}),t(H,null,{default:e(()=>[t(J,null,{default:e(()=>[t($,{cols:"12",md:"4"},{default:e(()=>[t(lt,{modelValue:C.value,"onUpdate:modelValue":[d[2]||(d[2]=S=>C.value=S),_],label:"Token com expiração",color:"primary","hide-details":""},null,8,["modelValue"]),d[11]||(d[11]=s("div",{class:"text-caption text-medium-emphasis mt-1"}," Define se o token terá data de expiração ",-1))]),_:1}),C.value?(p(),N($,{key:0,cols:"12",md:"8"},{default:e(()=>[t(oe,{modelValue:h.value,"onUpdate:modelValue":d[3]||(d[3]=S=>h.value=S),label:"Data de Expiração *",type:"datetime-local",variant:"outlined",density:"comfortable",rules:n,min:R.value,hint:"Token será automaticamente desativado nesta data","persistent-hint":""},null,8,["modelValue","min"])]),_:1})):P("",!0)]),_:1})]),_:1})]),_:1}),t(F,{variant:"outlined"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...d[12]||(d[12]=[o("mdi-shield-key",-1)])]),_:1}),d[13]||(d[13]=o(" Permissões do Token ",-1))]),_:1}),t(H,null,{default:e(()=>[d[14]||(d[14]=s("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Selecione as permissões que este token terá acesso. Tokens devem ter apenas as permissões mínimas necessárias. ",-1)),t(_e,{variant:"accordion",multiple:""},{default:e(()=>[(p(!0),y(Q,null,X(z.value,S=>(p(),N(pe,{key:S.name,title:S.label},{default:e(()=>[t(fe,null,{default:e(()=>[s("div",Et,[(p(!0),y(Q,null,X(be(S.name),Y=>(p(),N(Tt,{key:Y.name,modelValue:f.permissions,"onUpdate:modelValue":d[4]||(d[4]=K=>f.permissions=K),value:Y.name,label:Y.label,density:"comfortable",class:"mb-1"},{label:e(()=>[s("div",null,[s("div",It,u(Y.label),1),s("div",Ut,u(Y.description),1)])]),_:2},1032,["modelValue","value","label"]))),128))])]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1}),E.value?(p(),N(ie,{key:0,type:"error",variant:"outlined",class:"mt-3"},{default:e(()=>[o(u(E.value),1)]),_:1})):P("",!0),f.permissions.length>0?(p(),y("div",Rt,[s("h4",Pt," Permissões Selecionadas ("+u(f.permissions.length)+") ",1),s("div",zt,[(p(!0),y(Q,null,X(f.permissions,S=>(p(),N(j,{key:S,size:"small",variant:"outlined",color:"primary",closable:"","onClick:close":Y=>Te(S)},{default:e(()=>[o(u(ye(S)),1)]),_:2},1032,["onClick:close"]))),128))])])):P("",!0)]),_:1})]),_:1})]),_:1}),t($,{cols:"12",md:"4",class:"sidebar-column"},{default:e(()=>[t(F,{variant:"outlined",class:"sticky-card"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...d[15]||(d[15]=[o("mdi-information",-1)])]),_:1}),d[16]||(d[16]=o(" Resumo ",-1))]),_:1}),t(H,null,{default:e(()=>[s("div",_t,[t(ae,{size:"80",color:"primary"},{default:e(()=>[t(T,{size:"40"},{default:e(()=>[...d[17]||(d[17]=[o("mdi-key",-1)])]),_:1})]),_:1}),s("div",Ot,u(f.name||"Novo Token"),1),d[18]||(d[18]=s("div",{class:"text-body-2 text-medium-emphasis"},"Token de API",-1))]),f.name?(p(),y("div",Nt,[d[19]||(d[19]=s("strong",null,"Nome do Token:",-1)),s("div",Bt,u(f.name),1)])):P("",!0),s("div",Lt,[d[20]||(d[20]=s("strong",null,"Status de Expiração:",-1)),t(j,{color:C.value?"warning":"success",size:"small",class:"mt-1"},{default:e(()=>[t(T,{start:"",icon:C.value?"mdi-calendar-clock":"mdi-calendar-remove"},null,8,["icon"]),o(" "+u(C.value?"Com expiração":"Sem expiração"),1)]),_:1},8,["color"])]),C.value&&h.value?(p(),y("div",Ft,[d[21]||(d[21]=s("strong",null,"Data de Expiração:",-1)),s("div",jt,u(Ve(h.value)),1)])):P("",!0),s("div",Mt,[d[22]||(d[22]=s("strong",null,"Permissões:",-1)),s("div",Gt,u(f.permissions.length)+" selecionadas",1)]),d[23]||(d[23]=s("div",{class:"mt-4 pa-3 bg-orange-lighten-5 rounded border"},[s("div",{class:"text-caption font-weight-bold mb-2 text-orange-darken-2"},"AVISO DE SEGURANÇA"),s("div",{class:"text-caption text-orange-darken-1"}," O token será exibido apenas uma vez após a criação. Guarde-o em local seguro. ")],-1)),d[24]||(d[24]=s("div",{class:"mt-3 pa-3 bg-blue-lighten-5 rounded border"},[s("div",{class:"text-caption font-weight-bold mb-2 text-blue-darken-2"},"BOAS PRÁTICAS"),s("div",{class:"text-caption text-blue-darken-1"},[o(" • Use apenas as permissões necessárias"),s("br"),o(" • Configure data de expiração quando possível"),s("br"),o(" • Use nomes descritivos para identificação ")])],-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",qt,[s("div",Yt,[t(L,{variant:"outlined",size:"large",class:"action-btn cancel-btn",disabled:D.value,onClick:de},{default:e(()=>[...d[25]||(d[25]=[o(" Cancelar ",-1)])]),_:1},8,["disabled"]),t(L,{color:"success",variant:"elevated",size:"large",class:"action-btn primary-btn",loading:D.value,disabled:!x.value||f.permissions.length===0,onClick:re},{default:e(()=>[t(T,{start:""},{default:e(()=>[o(u(l.value?"mdi-content-save":"mdi-key-plus"),1)]),_:1}),o(" "+u(l.value?"Salvar Alterações":"Criar Token"),1)]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1},8,["modelValue"]))}}),Wt=xe(Ht,[["__scopeId","data-v-666e3acf"]]),Kt={class:"dialog-header"},Zt={class:"dialog-header-content"},Jt={class:"dialog-icon-wrapper"},Qt={class:"dialog-title-section"},Xt={class:"dialog-subtitle"},es={class:"dialog-content"},ts={class:"info-item"},ss={class:"info-value"},as={class:"info-item"},os={key:0,class:"info-item"},is={class:"info-value"},ls={class:"info-item"},ns={key:0,class:"info-value"},rs={key:1,class:"info-value text-medium-emphasis"},ds={class:"info-item"},us={key:0,class:"info-value"},ms={key:1,class:"info-value text-medium-emphasis"},cs={class:"info-item"},vs={class:"info-value"},ps={class:"info-item"},fs={key:0,class:"info-value"},gs={key:1,class:"info-value text-medium-emphasis"},ks={class:"info-item"},xs={key:0,class:"info-value"},bs={key:1,class:"info-value text-medium-emphasis"},ys={key:0},Ts={class:"text-subtitle-2 font-weight-medium mb-2"},Vs={class:"d-flex flex-wrap ga-2 mb-3"},ws={key:1,class:"text-medium-emphasis"},As={class:"text-center mb-4"},Ss={class:"text-h6 mt-2"},hs={class:"mb-3"},Cs={class:"text-body-2 font-mono"},Ds={class:"mb-3"},$s={class:"mb-3"},Es={class:"text-body-2"},Is={class:"mb-3"},Us={class:"text-body-2"},Rs={key:0,class:"mb-3"},Ps={key:1,class:"mb-3"},zs={class:"text-body-2"},_s={class:"mt-3 pa-3 bg-blue-lighten-5 rounded border"},Os={class:"text-caption text-blue-darken-1"},Ns={key:0},Bs={key:1},Ls={key:2},Fs={class:"dialog-footer"},js={class:"dialog-actions"},Ms=ge({__name:"TokenDetailsDialog",props:{modelValue:{type:Boolean},token:{default:null}},emits:["update:modelValue"],setup(r,{emit:i}){const c=r,k=i,g=Z({get(){return c.modelValue},set(V){k("update:modelValue",V)}}),x=Z(()=>O.getPermissionCategories()),D=Z(()=>O.getAvailablePermissions());function C(V){return O.getTokenStatusColor(V)}function h(V){return O.getTokenStatusText(V)}function E(V){switch(C(V)){case"success":return"mdi-check-circle";case"warning":return"mdi-alert-circle";case"error":return"mdi-close-circle";default:return"mdi-help-circle"}}function f(V){return new Date(V).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function A(V,n){const U=n||[];return D.value.filter(B=>B.category===V&&U.includes(B.name))}function l(V){return{"analysis:read":"mdi-file-search","analysis:create":"mdi-file-plus","analysis:update":"mdi-file-edit","analysis:delete":"mdi-file-remove","webhooks:read":"mdi-webhook","webhooks:create":"mdi-webhook","webhooks:update":"mdi-webhook","webhooks:delete":"mdi-webhook","users:read":"mdi-account-search","users:create":"mdi-account-plus","users:update":"mdi-account-edit","users:delete":"mdi-account-remove","organizations:read":"mdi-domain","organizations:update":"mdi-domain","repositories:read":"mdi-source-repository","repositories:create":"mdi-source-repository-multiple","repositories:update":"mdi-source-commit","repositories:delete":"mdi-source-repository-multiple","rules:read":"mdi-rule","rules:create":"mdi-plus","rules:update":"mdi-pencil","rules:delete":"mdi-delete","logs:read":"mdi-file-document-multiple","settings:read":"mdi-cog","settings:update":"mdi-cog"}[V]||"mdi-key"}function R(V){if(!V.expiresAt)return"";const n=new Date,U=new Date(V.expiresAt);if(U<n)return"text-error";const B=new Date;return B.setDate(B.getDate()+30),U<B?"text-warning":"text-success"}function z(V){return V.expiresAt?new Date(V.expiresAt)<new Date:!1}function M(V){return V.active?z(V)?"Este token expirou e não pode mais ser usado.":"Este token está inativo.":"Este token foi revogado e não pode mais ser usado."}function q(V){return new Date(V).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}return(V,n)=>(p(),N(ke,{modelValue:g.value,"onUpdate:modelValue":n[2]||(n[2]=U=>g.value=U),"max-width":"1000px",persistent:"",transition:"dialog-bottom-transition",class:"modern-dialog"},{default:e(()=>[r.token?(p(),N(F,{key:0,elevation:"24",class:"dialog-card"},{default:e(()=>[s("div",Kt,[s("div",Zt,[s("div",Jt,[t(T,{icon:"mdi-key",size:"28",class:"dialog-icon"})]),s("div",Qt,[n[3]||(n[3]=s("h2",{class:"dialog-title"},"Detalhes do Token",-1)),s("p",Xt,u(r.token.name)+" - Informações completas do token de API",1)])]),t(L,{icon:"mdi-close",variant:"text",size:"40",class:"dialog-close-btn",onClick:n[0]||(n[0]=U=>g.value=!1)})]),s("div",es,[t(J,null,{default:e(()=>[t($,{cols:"12",md:"8"},{default:e(()=>[t(F,{variant:"outlined",class:"mb-4"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...n[4]||(n[4]=[o("mdi-key",-1)])]),_:1}),n[5]||(n[5]=o(" Informações Básicas ",-1))]),_:1}),t(H,null,{default:e(()=>[t(J,null,{default:e(()=>[t($,{cols:"12",md:"6"},{default:e(()=>[s("div",ts,[n[6]||(n[6]=s("div",{class:"info-label"},"Nome do Token",-1)),s("div",ss,u(r.token.name),1)])]),_:1}),t($,{cols:"12",md:"6"},{default:e(()=>[s("div",as,[n[7]||(n[7]=s("div",{class:"info-label"},"Status",-1)),t(j,{color:C(r.token),variant:"tonal",size:"small",class:"mt-1"},{default:e(()=>[t(T,{start:"",size:"16"},{default:e(()=>[o(u(E(r.token)),1)]),_:1}),o(" "+u(h(r.token)),1)]),_:1},8,["color"])])]),_:1})]),_:1}),r.token.description?(p(),y("div",os,[n[8]||(n[8]=s("div",{class:"info-label"},"Descrição",-1)),s("div",is,u(r.token.description),1)])):P("",!0)]),_:1})]),_:1}),t(F,{variant:"outlined",class:"mb-4"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...n[9]||(n[9]=[o("mdi-chart-line",-1)])]),_:1}),n[10]||(n[10]=o(" Informações de Uso ",-1))]),_:1}),t(H,null,{default:e(()=>[t(J,null,{default:e(()=>[t($,{cols:"12",md:"6"},{default:e(()=>[s("div",ls,[n[11]||(n[11]=s("div",{class:"info-label"},"Último Uso",-1)),r.token.lastUsedAt?(p(),y("div",ns,u(f(r.token.lastUsedAt)),1)):(p(),y("div",rs,"Nunca usado"))])]),_:1}),t($,{cols:"12",md:"6"},{default:e(()=>[s("div",ds,[n[12]||(n[12]=s("div",{class:"info-label"},"IP do Último Uso",-1)),r.token.lastUsedIp?(p(),y("div",us,[t(j,{size:"small",variant:"outlined",color:"primary"},{default:e(()=>[o(u(r.token.lastUsedIp),1)]),_:1})])):(p(),y("div",ms,"N/A"))])]),_:1})]),_:1})]),_:1})]),_:1}),t(F,{variant:"outlined",class:"mb-4"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...n[13]||(n[13]=[o("mdi-calendar-clock",-1)])]),_:1}),n[14]||(n[14]=o(" Datas e Períodos ",-1))]),_:1}),t(H,null,{default:e(()=>[t(J,null,{default:e(()=>[t($,{cols:"12",md:"4"},{default:e(()=>[s("div",cs,[n[15]||(n[15]=s("div",{class:"info-label"},"Criado em",-1)),s("div",vs,u(f(r.token.createdAt)),1)])]),_:1}),t($,{cols:"12",md:"4"},{default:e(()=>[s("div",ps,[n[16]||(n[16]=s("div",{class:"info-label"},"Atualizado em",-1)),r.token.updatedAt?(p(),y("div",fs,u(f(r.token.updatedAt)),1)):(p(),y("div",gs,"N/A"))])]),_:1}),t($,{cols:"12",md:"4"},{default:e(()=>[s("div",ks,[n[17]||(n[17]=s("div",{class:"info-label"},"Expira em",-1)),r.token.expiresAt?(p(),y("div",xs,[s("span",{class:Ie(R(r.token))},u(f(r.token.expiresAt)),3)])):(p(),y("div",bs,"Sem expiração"))])]),_:1})]),_:1})]),_:1})]),_:1}),t(F,{variant:"outlined",class:"mb-4"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...n[18]||(n[18]=[o("mdi-shield-key",-1)])]),_:1}),o(" Permissões ("+u((r.token.permissions||[]).length)+") ",1)]),_:1}),t(H,null,{default:e(()=>[(r.token.permissions||[]).length>0?(p(),y("div",ys,[(p(!0),y(Q,null,X(x.value,U=>(p(),y("div",{key:U.name,class:"mb-4"},[A(U.name,r.token.permissions||[]).length>0?(p(),y(Q,{key:0},[s("h4",Ts,u(U.label),1),s("div",Vs,[(p(!0),y(Q,null,X(A(U.name,r.token.permissions||[]),B=>(p(),N(j,{key:B.name,size:"small",variant:"outlined",color:"primary"},{default:e(()=>[t(T,{start:"",size:"16"},{default:e(()=>[o(u(l(B.name)),1)]),_:2},1024),o(" "+u(B.label),1)]),_:2},1024))),128))])],64)):P("",!0)]))),128))])):(p(),y("div",ws," Nenhuma permissão configurada "))]),_:1})]),_:1}),z(r.token)||!r.token.active?(p(),N(ie,{key:0,type:"warning",variant:"outlined",class:"mb-4"},{title:e(()=>[...n[19]||(n[19]=[o(" Token Inativo ",-1)])]),default:e(()=>[s("div",null,u(M(r.token)),1)]),_:1})):P("",!0),t(ie,{type:"info",variant:"outlined",class:"mb-4"},{title:e(()=>[...n[20]||(n[20]=[o(" Como Usar ",-1)])]),default:e(()=>[n[21]||(n[21]=s("div",null,[o(" Para usar este token, adicione o header de autorização nas suas requisições: "),s("code",{class:"d-block mt-2 pa-2 bg-grey-lighten-4 rounded"}," Authorization: Bearer <seu-token> ")],-1))]),_:1})]),_:1}),t($,{cols:"12",md:"4",class:"sidebar-column"},{default:e(()=>[t(F,{variant:"outlined",class:"sticky-card"},{default:e(()=>[t(W,null,{default:e(()=>[t(T,{class:"mr-2"},{default:e(()=>[...n[22]||(n[22]=[o("mdi-information",-1)])]),_:1}),n[23]||(n[23]=o(" Resumo ",-1))]),_:1}),t(H,null,{default:e(()=>[s("div",As,[t(ae,{size:"80",color:C(r.token)},{default:e(()=>[t(T,{size:"40",icon:E(r.token)},null,8,["icon"])]),_:1},8,["color"]),s("div",Ss,u(r.token.name),1),n[24]||(n[24]=s("div",{class:"text-body-2 text-medium-emphasis"},"Token de API",-1))]),s("div",hs,[n[25]||(n[25]=s("strong",null,"ID do Token:",-1)),s("div",Cs,u(r.token.id),1)]),s("div",Ds,[n[26]||(n[26]=s("strong",null,"Status Atual:",-1)),t(j,{color:C(r.token),size:"small",class:"mt-1"},{default:e(()=>[t(T,{start:"",icon:E(r.token)},null,8,["icon"]),o(" "+u(h(r.token)),1)]),_:1},8,["color"])]),s("div",$s,[n[27]||(n[27]=s("strong",null,"Permissões:",-1)),s("div",Es,u((r.token.permissions||[]).length)+" configuradas",1)]),s("div",Is,[n[28]||(n[28]=s("strong",null,"Criado em:",-1)),s("div",Us,u(q(r.token.createdAt)),1)]),r.token.expiresAt?(p(),y("div",Rs,[n[29]||(n[29]=s("strong",null,"Expira em:",-1)),s("div",{class:Ie(["text-body-2",R(r.token)])},u(q(r.token.expiresAt)),3)])):P("",!0),r.token.lastUsedAt?(p(),y("div",Ps,[n[30]||(n[30]=s("strong",null,"Último uso:",-1)),s("div",zs,u(q(r.token.lastUsedAt)),1)])):P("",!0),n[32]||(n[32]=s("div",{class:"mt-4 pa-3 bg-orange-lighten-5 rounded border"},[s("div",{class:"text-caption font-weight-bold mb-2 text-orange-darken-2"},"AVISO DE SEGURANÇA"),s("div",{class:"text-caption text-orange-darken-1"}," Mantenha este token seguro e nunca o compartilhe. Revogue-o imediatamente se suspeitar de comprometimento. ")],-1)),s("div",_s,[n[31]||(n[31]=s("div",{class:"text-caption font-weight-bold mb-2 text-blue-darken-2"},"SOBRE O STATUS",-1)),s("div",Os,[r.token.active&&!z(r.token)?(p(),y("span",Ns," Token ativo e funcionando normalmente. ")):z(r.token)?(p(),y("span",Bs," Token expirado e não pode mais ser usado. ")):(p(),y("span",Ls," Token foi revogado e está inativo. "))])])]),_:1})]),_:1})]),_:1})]),_:1})]),s("div",Fs,[s("div",js,[t(L,{variant:"outlined",size:"large",class:"action-btn cancel-btn",onClick:n[1]||(n[1]=U=>g.value=!1)},{default:e(()=>[...n[33]||(n[33]=[o(" Fechar ",-1)])]),_:1})])])]),_:1})):P("",!0)]),_:1},8,["modelValue"]))}}),Gs=xe(Ms,[["__scopeId","data-v-a6cb65c1"]]),qs={class:"d-flex align-center"},Ys={class:"mb-6"},Hs={class:"text-subtitle-1 font-weight-medium mb-3"},Ws={class:"d-flex justify-center mb-4"},Ks={class:"mb-6"},Zs={class:"mb-3"},Js={class:"font-weight-medium"},Qs={class:"mb-3"},Xs={key:0,class:"mb-3"},ea={class:"mb-3"},ta={class:"text-caption text-medium-emphasis mb-1"},sa={class:"d-flex flex-wrap ga-1"},aa={class:"mb-3"},oa={class:"mb-3"},ia={key:0},la={key:1,class:"text-medium-emphasis"},na={class:"mb-6"},ra={class:"bg-surface-variant pa-3 rounded text-caption overflow-x-auto"},da={class:"bg-surface-variant pa-3 rounded text-caption overflow-x-auto"},ua={class:"bg-surface-variant pa-3 rounded text-caption overflow-x-auto"},ma=ge({__name:"TokenCreatedDialog",props:{modelValue:{type:Boolean},token:{default:null},plainTextToken:{default:""}},emits:["update:modelValue"],setup(r,{emit:i}){const c=r,k=i,g=Z({get(){return c.modelValue},set(A){k("update:modelValue",A)}});async function x(){try{await navigator.clipboard.writeText(c.plainTextToken)}catch(A){console.error("Erro ao copiar token:",A),D()}}function D(){ne(()=>{const A=document.querySelector(".token-field input");A&&(A.select(),A.setSelectionRange(0,c.plainTextToken.length))})}function C(A){return O.getAvailablePermissions().find(R=>R.name===A)?.label||A}function h(A){return new Date(A).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function E(){if(!c.token||!c.plainTextToken)return;const A={name:c.token.name||"Token sem nome",description:c.token.description||"",token:c.plainTextToken,permissions:c.token.permissions||[],createdAt:c.token.createdAt||new Date().toISOString(),expiresAt:c.token.expiresAt||null,usage:{curl:`curl -H "Authorization: Bearer ${c.plainTextToken}" -H "Content-Type: application/json" http://localhost:3001/api/analysis`,javascript:`fetch('http://localhost:3001/api/analysis', {
  headers: {
    'Authorization': 'Bearer ${c.plainTextToken}',
    'Content-Type': 'application/json'
  }
})`}},l=JSON.stringify(A,null,2),R=new Blob([l],{type:"application/json"}),z=URL.createObjectURL(R),M=document.createElement("a");M.href=z,M.download=`mira-api-token-${(c.token.name||"token").toLowerCase().replace(/\s+/g,"-")}.json`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(z)}function f(){g.value=!1}return(A,l)=>(p(),N(ke,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=R=>g.value=R),"max-width":"600",persistent:"",scrollable:""},{default:e(()=>[r.token?(p(),N(F,{key:0},{default:e(()=>[t(W,{class:"text-h6 d-flex align-center justify-space-between bg-success text-white sticky-header"},{default:e(()=>[s("div",qs,[t(T,{class:"me-2"},{default:e(()=>[...l[1]||(l[1]=[o("mdi-check-circle",-1)])]),_:1}),l[2]||(l[2]=o(" Token Criado com Sucesso! ",-1))]),t(L,{icon:"mdi-close",variant:"text",size:"small",color:"white",onClick:f})]),_:1}),t(H,null,{default:e(()=>[t(ie,{type:"success",variant:"outlined",class:"mb-6"},{title:e(()=>[t(T,{class:"me-2"},{default:e(()=>[...l[3]||(l[3]=[o("mdi-party-popper",-1)])]),_:1}),l[4]||(l[4]=o(" Parabéns! ",-1))]),default:e(()=>[s("div",null,[l[5]||(l[5]=o(' Seu token de API "',-1)),s("strong",null,u(r.token.name||"Token sem nome"),1),l[6]||(l[6]=o('" foi criado com sucesso. ',-1))])]),_:1}),s("div",Ys,[s("h3",Hs,[t(T,{class:"me-2"},{default:e(()=>[...l[7]||(l[7]=[o("mdi-key",-1)])]),_:1}),l[8]||(l[8]=o(" Seu Token de API ",-1))]),t(ie,{type:"info",variant:"outlined",class:"mb-4"},{title:e(()=>[t(T,{class:"me-2"},{default:e(()=>[...l[9]||(l[9]=[o("mdi-information",-1)])]),_:1}),l[10]||(l[10]=o(" Importante! ",-1))]),default:e(()=>[l[11]||(l[11]=s("div",null,[o(" Este é o único momento em que você poderá ver o token completo. "),s("strong",null,"Copie e salve-o em um local seguro"),o(", pois não será possível recuperá-lo posteriormente. ")],-1))]),_:1}),t(oe,{"model-value":r.plainTextToken,label:"Token de API",variant:"outlined",readonly:"",type:"text",class:"token-field mb-4","append-inner-icon":"mdi-content-copy","onClick:appendInner":x,onClick:D},null,8,["model-value"]),s("div",Ws,[t(L,{color:"primary","prepend-icon":"mdi-content-copy",onClick:x},{default:e(()=>[...l[12]||(l[12]=[o(" Copiar Token ",-1)])]),_:1})])]),s("div",Ks,[l[20]||(l[20]=s("h3",{class:"text-subtitle-1 font-weight-medium mb-3"},"Detalhes do Token",-1)),t(J,null,{default:e(()=>[t($,{cols:"12",md:"6"},{default:e(()=>[s("div",Zs,[l[13]||(l[13]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Nome",-1)),s("div",Js,u(r.token.name||"Token sem nome"),1)])]),_:1}),t($,{cols:"12",md:"6"},{default:e(()=>[s("div",Qs,[l[16]||(l[16]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Status",-1)),t(j,{color:"success",variant:"flat",size:"small"},{default:e(()=>[t(T,{start:"",size:"12"},{default:e(()=>[...l[14]||(l[14]=[o("mdi-check-circle",-1)])]),_:1}),l[15]||(l[15]=o(" Ativo ",-1))]),_:1})])]),_:1})]),_:1}),r.token.description?(p(),y("div",Xs,[l[17]||(l[17]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Descrição",-1)),s("div",null,u(r.token.description),1)])):P("",!0),s("div",ea,[s("div",ta," Permissões ("+u((r.token.permissions||[]).length)+") ",1),s("div",sa,[(p(!0),y(Q,null,X((r.token.permissions||[]).slice(0,5),R=>(p(),N(j,{key:R,size:"x-small",variant:"outlined",color:"primary"},{default:e(()=>[o(u(C(R)),1)]),_:2},1024))),128)),(r.token.permissions||[]).length>5?(p(),N(j,{key:0,size:"x-small",variant:"outlined"},{default:e(()=>[o(" +"+u((r.token.permissions||[]).length-5)+" mais ",1)]),_:1})):P("",!0)])]),t(J,null,{default:e(()=>[t($,{cols:"12",md:"6"},{default:e(()=>[s("div",aa,[l[18]||(l[18]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Criado em",-1)),s("div",null,u(r.token.createdAt?h(r.token.createdAt):"Data não disponível"),1)])]),_:1}),t($,{cols:"12",md:"6"},{default:e(()=>[s("div",oa,[l[19]||(l[19]=s("div",{class:"text-caption text-medium-emphasis mb-1"},"Expira em",-1)),r.token.expiresAt?(p(),y("div",ia,u(h(r.token.expiresAt)),1)):(p(),y("div",la,"Sem expiração"))])]),_:1})]),_:1})]),s("div",na,[l[22]||(l[22]=s("h3",{class:"text-subtitle-1 font-weight-medium mb-3"},"Como Usar",-1)),t(_e,{variant:"accordion"},{default:e(()=>[t(pe,{title:"Requisições HTTP"},{default:e(()=>[t(fe,null,{default:e(()=>[l[21]||(l[21]=s("p",{class:"mb-3"}," Para usar este token em suas requisições, adicione o header de autorização: ",-1)),s("pre",ra,[s("code",null,"Authorization: Bearer "+u(r.plainTextToken),1)])]),_:1})]),_:1}),t(pe,{title:"Exemplo com cURL"},{default:e(()=>[t(fe,null,{default:e(()=>[s("pre",da,[s("code",null,'curl -H "Authorization: Bearer '+u(r.plainTextToken)+`" \\
     -H "Content-Type: application/json" \\
     http://localhost:3001/api/analyses`,1)])]),_:1})]),_:1}),t(pe,{title:"Exemplo JavaScript"},{default:e(()=>[t(fe,null,{default:e(()=>[s("pre",ua,[s("code",null,`fetch('http://localhost:3001/api/analysis', {
  headers: {
    'Authorization': 'Bearer `+u(r.plainTextToken)+`',
    'Content-Type': 'application/json'
  }
})`,1)])]),_:1})]),_:1})]),_:1})]),t(ie,{type:"warning",variant:"outlined",class:"mb-4"},{title:e(()=>[t(T,{class:"me-2"},{default:e(()=>[...l[23]||(l[23]=[o("mdi-shield-alert",-1)])]),_:1}),l[24]||(l[24]=o(" Dicas de Segurança ",-1))]),default:e(()=>[l[25]||(l[25]=s("ul",{class:"mb-0"},[s("li",null,"Nunca compartilhe seu token em repositórios públicos"),s("li",null,"Use variáveis de ambiente para armazenar tokens"),s("li",null,"Revogue tokens não utilizados regularmente"),s("li",null,"Configure tokens com permissões mínimas necessárias"),s("li",null,"Monitore o uso dos seus tokens na tela de gerenciamento")],-1))]),_:1})]),_:1}),t(kt),t(ze,{class:"sticky-footer bg-grey-lighten-5 pa-4"},{default:e(()=>[t(L,{variant:"outlined","prepend-icon":"mdi-download",onClick:E},{default:e(()=>[...l[26]||(l[26]=[o(" Baixar como Arquivo ",-1)])]),_:1}),t(Oe),t(L,{color:"primary",onClick:f},{default:e(()=>[...l[27]||(l[27]=[o(" Continuar ",-1)])]),_:1})]),_:1})]),_:1})):P("",!0)]),_:1},8,["modelValue"]))}}),ca=xe(ma,[["__scopeId","data-v-f862cba0"]]),va={class:"api-tokens-view pa-6"},pa={class:"d-flex justify-space-between align-center mb-6"},fa={class:"d-flex ga-2"},ga={class:"d-flex align-center"},ka={class:"text-h5 font-weight-bold"},xa={class:"d-flex align-center"},ba={class:"text-h5 font-weight-bold"},ya={class:"d-flex align-center"},Ta={class:"text-h5 font-weight-bold"},Va={class:"d-flex align-center"},wa={class:"text-h5 font-weight-bold"},Aa={class:"px-4 py-3 d-flex align-center justify-space-between border-b"},Sa={class:"d-flex align-center gap-3"},ha={class:"d-flex align-center gap-2"},Ca={class:"px-4 py-4 advanced-filters-section"},Da={class:"d-flex align-center gap-3"},$a={class:"d-flex align-center gap-3"},Ea={class:"d-flex align-center justify-end gap-2"},Ia={class:"d-flex flex-column"},Ua={class:"font-weight-medium"},Ra={key:0,class:"text-caption text-medium-emphasis"},Pa={class:"d-flex flex-wrap ga-1"},za={key:0,class:"d-flex flex-column"},_a={class:"text-caption"},Oa={key:0,class:"text-caption text-medium-emphasis"},Na={key:1,class:"text-caption text-medium-emphasis"},Ba={key:0,class:"text-caption"},La={key:1,class:"text-caption text-medium-emphasis"},Fa={class:"text-caption"},ja={class:"d-flex ga-1 align-center justify-center"},Ma={key:0,class:"text-center pa-8"},Ga={class:"text-body-2 text-medium-emphasis mb-4"},qa={class:"d-flex align-center mb-4"},Ya={class:"mb-0"},Ha=ge({__name:"ApiTokensView",setup(r){const{isDemoUser:i}=Ce(),c=I(!1),k=I([]),g=I({total:0,active:0,expired:0,recentlyUsed:0,byPermissions:[]}),x=I(!1),D=I(!1),C=I(!1),h=I(!1),E=I(null),f=I(null),A=I(null),l=I(""),R=I(!1),z=I(!1),M=I(null),q=I(void 0),V=I(void 0),n=I(void 0),U=I(""),B=I(""),_=Pe({search:"",active:void 0,page:1,limit:25,sortBy:"createdAt",sortOrder:"desc"}),be=[{title:"Ativo",value:!0},{title:"Inativo",value:!1}],ye=[{title:"Leitura",value:"read"},{title:"Escrita",value:"write"},{title:"Administrador",value:"admin"}],Te=[{title:"Próximos 7 dias",value:"week"},{title:"Próximos 30 dias",value:"month"},{title:"Expirados",value:"expired"},{title:"Sem expiração",value:"never"}],re=[{title:"Usado recentemente",value:"recent"},{title:"Não usado há 30 dias",value:"inactive"},{title:"Nunca usado",value:"never"}],de=[{title:"Data de criação",value:"createdAt"},{title:"Nome",value:"name"},{title:"Último uso",value:"lastUsedAt"},{title:"Expiração",value:"expiresAt"}],Ve=[{title:"Crescente",value:"asc"},{title:"Decrescente",value:"desc"}],b=[{title:"Nome",key:"name",sortable:!1},{title:"Status",key:"status",sortable:!1},{title:"Permissões",key:"permissions",sortable:!1},{title:"Último Uso",key:"lastUsedAt",sortable:!1},{title:"Expira em",key:"expiresAt",sortable:!1},{title:"Criado em",key:"createdAt",sortable:!1},{title:"Ações",key:"actions",sortable:!1,align:"center"}],d=Z(()=>{let v=0;return _.search&&v++,_.active!==void 0&&v++,q.value&&v++,V.value&&v++,n.value&&v++,U.value&&v++,B.value&&v++,v}),S=xt(()=>{me()},500);let Y=null;const K=()=>{Y&&clearTimeout(Y),Y=setTimeout(()=>{me()},300)};async function ue(){try{c.value=!0;const m=((await O.getTokens(_)).data||[]).map(G=>({...G,active:typeof G.active=="string"?G.active==="true":!!G.active}));k.value.length=0,k.value.push(...m)}catch{}finally{c.value=!1}}async function ee(){try{const v=await O.getTokenStats(_);g.value=v}catch{}}function me(){_.page=1,ue(),ee()}function Ne(v){_.page=v,ue()}async function we(){await ue(),await ee(),await ne()}function Be(v){if(_.active=void 0,q.value=void 0,V.value=void 0,n.value=void 0,U.value="",B.value="",v==="active")_.active=!0;else if(v==="expired")V.value="expired";else if(v==="recent"){const a=new Date;a.setDate(a.getDate()-7),U.value=a.toISOString().split("T")[0]}else v==="unused"&&(n.value="never");me()}function Le(){_.search="",_.active=void 0,M.value=null,q.value=void 0,V.value=void 0,n.value=void 0,U.value="",B.value="",me()}function De(){E.value=null,x.value=!0}async function Fe(v){try{if(i.value){E.value=v,D.value=!0;return}const a=await O.getTokenDetails(v.id);E.value=a,D.value=!0}catch{E.value=v,D.value=!0}}async function je(v){try{if(i.value){E.value=v,x.value=!0;return}const a=await O.getTokenDetails(v.id);E.value=a,x.value=!0}catch{E.value=v,x.value=!0}}function Me(v){f.value=v,h.value=!0}function Ge(v){f.value=v,Ye()}async function qe(){if(f.value)try{R.value=!0,await O.revokeToken(f.value.id);const v=k.value.findIndex(a=>a.id===f.value.id);v>-1&&k.value[v]&&(k.value[v].active=!1),await ee(),h.value=!1,f.value=null}catch{}finally{R.value=!1}}async function Ye(){if(f.value)try{R.value=!0,await O.updateToken(f.value.id,{active:!0});const v=k.value.findIndex(a=>a.id===f.value.id);v>-1&&k.value[v]&&(k.value[v].active=!0),await ee(),f.value=null}catch{}finally{R.value=!1}}function He(v){if(x.value=!1,E.value=null,"plainTextToken"in v)A.value=v.token,l.value=v.plainTextToken,C.value=!0;else if("token"in v&&"tokenInfo"in v)A.value=v.tokenInfo,l.value=v.token,C.value=!0;else{const a=k.value.findIndex(m=>m.id===v.id);a>-1&&(k.value[a]=v),ee()}}function $e(v){return O.getTokenStatusColor(v)}function We(v){return O.getTokenStatusText(v)}function Ke(v){switch($e(v)){case"success":return"mdi-check-circle";case"warning":return"mdi-alert-circle";case"error":return"mdi-close-circle";default:return"mdi-help-circle"}}function Ze(v){return O.getAvailablePermissions().find(G=>G.name===v)?.label||v}function Ae(v){return new Date(v).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}return Xe(()=>{ue(),ee()}),ve(C,async(v,a)=>{a===!0&&v===!1&&(await we(),A.value=null,l.value="")},{immediate:!1}),(v,a)=>(p(),y("div",va,[s("div",pa,[a[18]||(a[18]=s("div",null,[s("h1",{class:"text-h4 font-weight-bold"},"Tokens de API"),s("p",{class:"text-subtitle-1 text-medium-emphasis mt-1"}," Gerencie tokens de acesso para integração com a API ")],-1)),s("div",fa,[t(L,{variant:"outlined","prepend-icon":"mdi-refresh",loading:c.value,onClick:we},{default:e(()=>[...a[16]||(a[16]=[o(" Atualizar ",-1)])]),_:1},8,["loading"]),ce(i)?P("",!0):(p(),N(L,{key:0,color:"primary","prepend-icon":"mdi-key-plus",onClick:De},{default:e(()=>[...a[17]||(a[17]=[o(" Novo Token ",-1)])]),_:1}))])]),t(J,{class:"mb-6"},{default:e(()=>[t($,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t(F,{class:"pa-4"},{default:e(()=>[s("div",ga,[t(ae,{color:"primary",class:"me-3"},{default:e(()=>[t(T,{color:"white"},{default:e(()=>[...a[19]||(a[19]=[o("mdi-key",-1)])]),_:1})]),_:1}),s("div",null,[s("div",ka,u(g.value.total),1),a[20]||(a[20]=s("div",{class:"text-caption text-medium-emphasis"},"Total de Tokens",-1))])])]),_:1})]),_:1}),t($,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t(F,{class:"pa-4"},{default:e(()=>[s("div",xa,[t(ae,{color:"success",class:"me-3"},{default:e(()=>[t(T,{color:"white"},{default:e(()=>[...a[21]||(a[21]=[o("mdi-key-star",-1)])]),_:1})]),_:1}),s("div",null,[s("div",ba,u(g.value.active),1),a[22]||(a[22]=s("div",{class:"text-caption text-medium-emphasis"},"Tokens Ativos",-1))])])]),_:1})]),_:1}),t($,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t(F,{class:"pa-4"},{default:e(()=>[s("div",ya,[t(ae,{color:"error",class:"me-3"},{default:e(()=>[t(T,{color:"white"},{default:e(()=>[...a[23]||(a[23]=[o("mdi-key-remove",-1)])]),_:1})]),_:1}),s("div",null,[s("div",Ta,u(g.value.expired),1),a[24]||(a[24]=s("div",{class:"text-caption text-medium-emphasis"},"Tokens Expirados",-1))])])]),_:1})]),_:1}),t($,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t(F,{class:"pa-4"},{default:e(()=>[s("div",Va,[t(ae,{color:"info",class:"me-3"},{default:e(()=>[t(T,{color:"white"},{default:e(()=>[...a[25]||(a[25]=[o("mdi-clock-check",-1)])]),_:1})]),_:1}),s("div",null,[s("div",wa,u(g.value.recentlyUsed),1),a[26]||(a[26]=s("div",{class:"text-caption text-medium-emphasis"},"Usados Recentemente",-1))])])]),_:1})]),_:1})]),_:1}),t(F,{class:"mb-6 filter-card"},{default:e(()=>[s("div",Aa,[s("div",Sa,[t(oe,{modelValue:_.search,"onUpdate:modelValue":a[0]||(a[0]=m=>_.search=m),label:"Buscar tokens...","prepend-inner-icon":"mdi-magnify",variant:"solo",density:"compact","hide-details":"",clearable:"",style:{"min-width":"280px"},onInput:ce(S)},null,8,["modelValue","onInput"]),d.value>0?(p(),N(j,{key:0,size:"small",color:"primary",variant:"tonal",class:"ml-2"},{default:e(()=>[o(u(d.value)+" filtro"+u(d.value>1?"s":""),1)]),_:1})):P("",!0)]),s("div",ha,[t(ft,{modelValue:M.value,"onUpdate:modelValue":[a[1]||(a[1]=m=>M.value=m),Be],variant:"outlined",color:"primary"},{default:e(()=>[t(j,{value:"active",size:"small"},{default:e(()=>[t(T,{start:""},{default:e(()=>[...a[27]||(a[27]=[o("mdi-key-star",-1)])]),_:1}),a[28]||(a[28]=o(" Ativos ",-1))]),_:1}),t(j,{value:"expired",size:"small"},{default:e(()=>[t(T,{start:""},{default:e(()=>[...a[29]||(a[29]=[o("mdi-key-remove",-1)])]),_:1}),a[30]||(a[30]=o(" Expirados ",-1))]),_:1}),t(j,{value:"recent",size:"small"},{default:e(()=>[t(T,{start:""},{default:e(()=>[...a[31]||(a[31]=[o("mdi-clock-check",-1)])]),_:1}),a[32]||(a[32]=o(" Recentes ",-1))]),_:1}),t(j,{value:"unused",size:"small"},{default:e(()=>[t(T,{start:""},{default:e(()=>[...a[33]||(a[33]=[o("mdi-key-outline",-1)])]),_:1}),a[34]||(a[34]=o(" Não Usados ",-1))]),_:1})]),_:1},8,["modelValue"]),t(L,{color:z.value?"primary":"default",variant:z.value?"flat":"outlined",size:"small",onClick:a[2]||(a[2]=m=>z.value=!z.value),class:"ml-1"},{default:e(()=>[t(T,null,{default:e(()=>[o("mdi-filter"+u(z.value?"-check":""),1)]),_:1}),a[35]||(a[35]=o(" Filtros ",-1))]),_:1},8,["color","variant"]),d.value>0?(p(),N(L,{key:0,variant:"outlined",size:"small",color:"error",onClick:Le,class:"ml-2"},{default:e(()=>[t(T,{start:""},{default:e(()=>[...a[36]||(a[36]=[o("mdi-filter-remove",-1)])]),_:1}),a[37]||(a[37]=o(" Limpar ",-1))]),_:1})):P("",!0)])]),t(gt,null,{default:e(()=>[et(s("div",Ca,[t(J,null,{default:e(()=>[t($,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t(se,{modelValue:_.active,"onUpdate:modelValue":[a[3]||(a[3]=m=>_.active=m),K],label:"Status",items:be,variant:"outlined",density:"compact",clearable:"","prepend-inner-icon":"mdi-toggle-switch"},null,8,["modelValue"])]),_:1}),t($,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t(se,{modelValue:q.value,"onUpdate:modelValue":[a[4]||(a[4]=m=>q.value=m),K],label:"Permissão",items:ye,variant:"outlined",density:"compact",clearable:"","prepend-inner-icon":"mdi-shield-key"},null,8,["modelValue"])]),_:1}),t($,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t(se,{modelValue:V.value,"onUpdate:modelValue":[a[5]||(a[5]=m=>V.value=m),K],label:"Expiração",items:Te,variant:"outlined",density:"compact",clearable:"","prepend-inner-icon":"mdi-calendar-clock"},null,8,["modelValue"])]),_:1}),t($,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t(se,{modelValue:n.value,"onUpdate:modelValue":[a[6]||(a[6]=m=>n.value=m),K],label:"Uso",items:re,variant:"outlined",density:"compact",clearable:"","prepend-inner-icon":"mdi-chart-line"},null,8,["modelValue"])]),_:1}),t($,{cols:"12",md:"4"},{default:e(()=>[s("div",Da,[t(T,{color:"medium-emphasis"},{default:e(()=>[...a[38]||(a[38]=[o("mdi-calendar-range",-1)])]),_:1}),a[39]||(a[39]=s("div",{class:"text-caption text-medium-emphasis"},"Data de Criação:",-1)),t(oe,{modelValue:U.value,"onUpdate:modelValue":a[7]||(a[7]=m=>U.value=m),type:"date",label:"De",variant:"outlined",density:"compact","hide-details":"",onChange:K},null,8,["modelValue"]),t(oe,{modelValue:B.value,"onUpdate:modelValue":a[8]||(a[8]=m=>B.value=m),type:"date",label:"Até",variant:"outlined",density:"compact","hide-details":"",onChange:K},null,8,["modelValue"])])]),_:1}),t($,{cols:"12",md:"4"},{default:e(()=>[s("div",$a,[t(se,{modelValue:_.sortBy,"onUpdate:modelValue":[a[9]||(a[9]=m=>_.sortBy=m),K],label:"Ordenar por",items:de,variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort"},null,8,["modelValue"]),t(se,{modelValue:_.sortOrder,"onUpdate:modelValue":[a[10]||(a[10]=m=>_.sortOrder=m),K],label:"Ordem",items:Ve,variant:"outlined",density:"compact"},null,8,["modelValue"])])]),_:1}),t($,{cols:"12",md:"4"},{default:e(()=>[s("div",Ea,[t(L,{color:"primary","prepend-icon":"mdi-refresh",onClick:we},{default:e(()=>[...a[40]||(a[40]=[o(" Atualizar ",-1)])]),_:1})])]),_:1})]),_:1})],512),[[tt,z.value]])]),_:1})]),_:1}),t(F,null,{default:e(()=>[t(H,{class:"pa-0"},{default:e(()=>[t(bt,{headers:b,items:k.value,loading:c.value,"items-per-page":_.limit||25,class:"elevation-0","item-key":"id","no-data-text":"","onUpdate:page":Ne},{"item.name":e(({item:m})=>[s("div",Ia,[s("span",Ua,u(m.name),1),m.description?(p(),y("span",Ra,u(m.description),1)):P("",!0)])]),"item.status":e(({item:m})=>[t(j,{color:$e(m),variant:"flat",size:"small"},{default:e(()=>[t(T,{start:"",size:"12"},{default:e(()=>[o(u(Ke(m)),1)]),_:2},1024),o(" "+u(We(m)),1)]),_:2},1032,["color"])]),"item.permissions":e(({item:m})=>[s("div",Pa,[(p(!0),y(Q,null,X((m.permissions||[]).slice(0,2),G=>(p(),N(j,{key:G,size:"x-small",variant:"outlined",class:"text-caption"},{default:e(()=>[o(u(Ze(G)),1)]),_:2},1024))),128)),(m.permissions||[]).length>2?(p(),N(j,{key:0,size:"x-small",variant:"outlined",class:"text-caption"},{default:e(()=>[o(" +"+u((m.permissions||[]).length-2),1)]),_:2},1024)):P("",!0)])]),"item.lastUsedAt":e(({item:m})=>[m.lastUsedAt?(p(),y("div",za,[s("span",_a,u(Ae(m.lastUsedAt)),1),m.lastUsedIp?(p(),y("span",Oa,u(m.lastUsedIp),1)):P("",!0)])):(p(),y("span",Na,"Nunca usado"))]),"item.expiresAt":e(({item:m})=>[m.expiresAt?(p(),y("span",Ba,u(Ae(m.expiresAt)),1)):(p(),y("span",La,"Sem expiração"))]),"item.createdAt":e(({item:m})=>[s("span",Fa,u(Ae(m.createdAt)),1)]),"item.actions":e(({item:m})=>[s("div",ja,[t(Se,{text:"Ver detalhes",class:"custom-tooltip"},{activator:e(({props:G})=>[t(L,le(G,{icon:"mdi-eye",variant:"text",size:"small",onClick:Ee=>Fe(m)}),null,16,["onClick"])]),_:2},1024),ce(i)?P("",!0):(p(),N(Se,{key:0,text:"Editar",class:"custom-tooltip"},{activator:e(({props:G})=>[t(L,le(G,{icon:"mdi-pencil",variant:"text",size:"small",onClick:Ee=>je(m)}),null,16,["onClick"])]),_:2},1024)),ce(i)?P("",!0):(p(),N(Se,{key:1,text:m.active?"Revogar":"Reativar",class:"custom-tooltip"},{activator:e(({props:G})=>[t(L,le(G,{icon:m.active?"mdi-key-remove":"mdi-key-plus",variant:"text",size:"small",color:m.active?"error":"success",onClick:Ee=>m.active?Me(m):Ge(m)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]))])]),bottom:e(()=>[k.value.length===0&&!c.value?(p(),y("div",Ma,[t(T,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:e(()=>[...a[41]||(a[41]=[o("mdi-key-outline",-1)])]),_:1}),a[43]||(a[43]=s("div",{class:"text-h6 text-medium-emphasis mb-2"},"Nenhum token encontrado",-1)),s("div",Ga,u(_.search?"Tente ajustar os filtros de busca":"Crie seu primeiro token de API"),1),_.search?P("",!0):(p(),N(L,{key:0,color:"primary","prepend-icon":"mdi-key-plus",onClick:De},{default:e(()=>[...a[42]||(a[42]=[o(" Criar Token ",-1)])]),_:1}))])):P("",!0)]),_:2},1032,["items","loading","items-per-page"])]),_:1})]),_:1}),t(Wt,{modelValue:x.value,"onUpdate:modelValue":a[11]||(a[11]=m=>x.value=m),token:E.value,onSaved:He},null,8,["modelValue","token"]),t(Gs,{modelValue:D.value,"onUpdate:modelValue":a[12]||(a[12]=m=>D.value=m),token:E.value},null,8,["modelValue","token"]),t(ca,{modelValue:C.value,"onUpdate:modelValue":a[13]||(a[13]=m=>C.value=m),token:A.value,"plain-text-token":l.value},null,8,["modelValue","token","plain-text-token"]),t(ke,{modelValue:h.value,"onUpdate:modelValue":a[15]||(a[15]=m=>h.value=m),"max-width":"400"},{default:e(()=>[t(F,null,{default:e(()=>[t(W,{class:"text-h6"},{default:e(()=>[...a[44]||(a[44]=[o(" Revogar Token ",-1)])]),_:1}),t(H,null,{default:e(()=>[s("div",qa,[t(T,{color:"warning",size:"24",class:"me-3"},{default:e(()=>[...a[45]||(a[45]=[o("mdi-alert",-1)])]),_:1}),a[46]||(a[46]=s("span",null,"Esta ação não pode ser desfeita",-1))]),s("p",Ya,[a[47]||(a[47]=o(" Tem certeza que deseja revogar o token ",-1)),s("strong",null,'"'+u(f.value?.name)+'"',1),a[48]||(a[48]=o("? ",-1))]),a[49]||(a[49]=s("p",{class:"text-caption text-medium-emphasis mt-2"}," Todas as aplicações que usam este token perderão acesso imediatamente. ",-1))]),_:1}),t(ze,null,{default:e(()=>[t(Oe),t(L,{onClick:a[14]||(a[14]=m=>h.value=!1)},{default:e(()=>[...a[50]||(a[50]=[o(" Cancelar ",-1)])]),_:1}),t(L,{color:"error",loading:R.value,onClick:qe},{default:e(()=>[...a[51]||(a[51]=[o(" Revogar ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),So=xe(Ha,[["__scopeId","data-v-85237972"]]);export{So as default};
