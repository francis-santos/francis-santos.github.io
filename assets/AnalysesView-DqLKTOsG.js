import{k as Z,W as H,f as c,j as N,E as J,X as i,z as o,q as r,Q as _,_ as T,T as a,a1 as d,S as n,a4 as u,F as K,a8 as Y,x as $,Z as ee}from"./vendor-vue-BvKyvIVR.js";import{d as te}from"./dashboard.service-DgUQ6u-a.js";import{_ as oe}from"./index-CQBjCOQw.js";import{f as B,j as D,o as A,k as le}from"./VGrid-CuJrScxf.js";import{V as se}from"./VAlert-ChhMmNH2.js";import{V as f}from"./VIcon-CM-KW5Qw.js";import{V as re}from"./VPagination-C7VPvwfo.js";import{V as ae,a as V}from"./VRow-C_rLTo1r.js";import{V as ne,a as C}from"./VSelect-JVxEisdn.js";import{V as ie}from"./VTable-BhCG_aMe.js";import{a as S}from"./VChip-BzUv3cXC.js";import{V as de}from"./VTooltip-Bl0kBka4.js";import"./auth-PiWOMLtm.js";import"./vendor-utils-Cfk84l6i.js";import"./token-storage.service-BqAv9k07.js";import"./vendor-ui-Dz8XL-co.js";import"./tag-Bnbpnddf.js";import"./dimensions-DVh0fwa7.js";import"./autofocus-Bh6bNAdk.js";import"./forwardRefs-D_qxKlPu.js";import"./VList-CaAoEaF2.js";import"./ssrBoot-COakMcr6.js";import"./VMenu-B2XC7rkF.js";import"./lazy-DADzjSlN.js";const ue=Z({__name:"AnalysesView",setup(q,{expose:e}){e();const k=H(),l=c([]),v=c(!1),y=c(null),t=c(1),p=c(1),P=c(0),z=c(20),b=c("all"),w=c("all"),R=c("createdAt"),j=c("desc"),h=c(""),L=N(()=>{let s=l.value;if(b.value!=="all"&&(s=s.filter(m=>m.status===b.value)),w.value!=="all"&&(s=s.filter(m=>m.repositoryName===w.value)),h.value.trim()){const m=h.value.toLowerCase().trim();s=s.filter(g=>g.repositoryName.toLowerCase().includes(m)||g.branchName.toLowerCase().includes(m)||g.commitSha.toLowerCase().includes(m))}return s}),O=N(()=>{const s=new Set(l.value.map(m=>m.repositoryName));return Array.from(s).sort()}),U=[{value:"all",title:"Todos os Status"},{value:"pending",title:"Pendente"},{value:"processing",title:"Processando"},{value:"completed",title:"Completa"},{value:"failed",title:"Falhou"}];async function x(){v.value=!0,y.value=null;try{const s=await te.getAnalyses(t.value,z.value);l.value=s.data,p.value=s.totalPages,P.value=s.total}catch(s){y.value="Erro ao carregar análises",console.error("Error loading analyses:",s)}finally{v.value=!1}}function E(s){switch(s){case"completed":return"success";case"processing":return"warning";case"pending":return"info";case"failed":return"error";default:return"grey"}}function M(s){switch(s){case"completed":return"Completa";case"processing":return"Processando";case"pending":return"Pendente";case"failed":return"Falhou";default:return s}}function Q(s){return new Date(s).toLocaleString("pt-BR")}function I(s){if(!s)return"N/A";if(s<1e3)return`${s}ms`;if(s<6e4)return`${(s/1e3).toFixed(1)}s`;{const m=Math.floor(s/6e4),g=Math.floor(s%6e4/1e3);return`${m}m ${g}s`}}function G(s){k.push(`/analyses/${s.id}`)}function W(s){t.value=s,x()}function X(){t.value=1,x()}J(()=>{x()});const F={router:k,analyses:l,loading:v,error:y,currentPage:t,totalPages:p,totalAnalyses:P,itemsPerPage:z,statusFilter:b,repositoryFilter:w,sortBy:R,sortOrder:j,searchQuery:h,filteredAnalyses:L,uniqueRepositories:O,statusOptions:U,loadAnalyses:x,getStatusColor:E,getStatusText:M,formatDate:Q,formatProcessingTime:I,viewAnalysisDetails:G,changePage:W,refreshAnalyses:X};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),ce={class:"analyses-page"},me={class:"d-flex align-center justify-space-between mb-6"},fe={class:"d-flex align-center justify-space-between mb-4"},pe={class:"text-body-2 text-grey-darken-1"},ge={key:1,class:"text-center py-12"},ve=["onClick"],ye={class:"d-flex align-center"},xe={class:"font-weight-medium"},_e={class:"font-mono text-caption"},Ve={key:0,class:"d-flex align-center"},ke={key:1,class:"d-flex align-center"},be={key:2,class:"d-flex align-center"},we={key:0,class:"d-flex align-center"},he={key:1,class:"d-flex align-center"},Ae={key:2,class:"d-flex align-center"},Ce={class:"ms-2 text-caption"},Se={key:3,class:"text-caption text-grey"},Pe={key:0,class:"d-flex align-center"},ze={key:1,class:"d-flex align-center"},Fe={key:2,class:"d-flex align-center"},Ne={class:"text-caption"},Te={key:3,class:"text-caption text-grey"},Be={class:"text-caption"},De={key:3,class:"text-center py-12"},qe={key:4,class:"d-flex justify-center mt-6"};function Re(q,e,k,l,v,y){return n(),i("div",ce,[o("div",me,[e[7]||(e[7]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold text-grey-darken-3 mb-2"}," Análises "),o("p",{class:"text-body-1 text-grey-darken-1"}," Gerencie e monitore todas as análises de código ")],-1)),r(B,{color:"primary","prepend-icon":"mdi-refresh",onClick:l.refreshAnalyses,loading:l.loading},{default:a(()=>[...e[6]||(e[6]=[u(" Atualizar ",-1)])]),_:1},8,["loading"])]),r(D,{class:"mb-6",elevation:"2"},{default:a(()=>[r(le,null,{default:a(()=>[r(ae,null,{default:a(()=>[r(V,{cols:"12",md:"3"},{default:a(()=>[r(ne,{modelValue:l.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=t=>l.searchQuery=t),label:"Buscar análises","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),r(V,{cols:"12",md:"3"},{default:a(()=>[r(C,{modelValue:l.statusFilter,"onUpdate:modelValue":e[1]||(e[1]=t=>l.statusFilter=t),items:l.statusOptions,label:"Status",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),r(V,{cols:"12",md:"3"},{default:a(()=>[r(C,{modelValue:l.repositoryFilter,"onUpdate:modelValue":e[2]||(e[2]=t=>l.repositoryFilter=t),items:[{value:"all",title:"Todos os Repositórios"},...l.uniqueRepositories.map(t=>({value:t,title:t}))],label:"Repositório",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),r(V,{cols:"12",md:"3"},{default:a(()=>[r(C,{modelValue:l.sortBy,"onUpdate:modelValue":e[3]||(e[3]=t=>l.sortBy=t),items:[{value:"createdAt",title:"Data de Criação"},{value:"completedAt",title:"Data de Conclusão"},{value:"repositoryName",title:"Repositório"},{value:"status",title:"Status"}],label:"Ordenar por",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o("div",fe,[o("div",pe," Mostrando "+d(l.filteredAnalyses.length)+" de "+d(l.totalAnalyses)+" análises ",1)]),l.error?(n(),_(se,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":e[4]||(e[4]=t=>l.error=null)},{default:a(()=>[u(d(l.error),1)]),_:1})):T("",!0),l.loading?(n(),i("div",ge,[r(A,{indeterminate:"",color:"primary",size:"64"}),e[8]||(e[8]=o("p",{class:"text-body-1 text-grey-darken-1 mt-4"}," Carregando análises... ",-1))])):l.filteredAnalyses.length>0?(n(),_(D,{key:2,elevation:"2"},{default:a(()=>[r(ie,null,{default:a(()=>[e[22]||(e[22]=o("thead",null,[o("tr",null,[o("th",null,"Repositório"),o("th",null,"Branch"),o("th",null,"Commit"),o("th",null,"Status"),o("th",null,"Issues"),o("th",null,"Score"),o("th",null,"Tempo"),o("th",null,"Criado em"),o("th",null,"Ações")])],-1)),o("tbody",null,[(n(!0),i(K,null,Y(l.filteredAnalyses,t=>(n(),i("tr",{key:t.id,class:"analysis-row",onClick:p=>l.viewAnalysisDetails(t)},[o("td",null,[o("div",ye,[r(f,{class:"me-2",size:"20"},{default:a(()=>[...e[9]||(e[9]=[u("mdi-source-repository",-1)])]),_:1}),o("div",null,[o("div",xe,d(t.repositoryName),1)])])]),o("td",null,[r(S,{size:"small",variant:"tonal",color:"primary"},{default:a(()=>[u(d(t.branchName),1)]),_:2},1024)]),o("td",null,[o("span",_e,d(t.commitSha.substring(0,8)),1)]),o("td",null,[t.status==="failed"&&t.errorMessage?(n(),_(de,{key:0,bottom:""},{activator:a(({props:p})=>[r(S,$({ref_for:!0},p,{color:l.getStatusColor(t.status),size:"small",variant:"tonal","prepend-icon":"mdi-alert-circle"}),{default:a(()=>[u(d(l.getStatusText(t.status)),1)]),_:2},1040,["color"])]),default:a(()=>[o("span",null,d(t.errorMessage),1)]),_:2},1024)):(n(),_(S,{key:1,color:l.getStatusColor(t.status),size:"small",variant:"tonal"},{default:a(()=>[u(d(l.getStatusText(t.status)),1)]),_:2},1032,["color"]))]),o("td",null,[t.status==="failed"?(n(),i("div",Ve,[r(f,{class:"me-1",size:"16",color:"error"},{default:a(()=>[...e[10]||(e[10]=[u(" mdi-alert-circle ",-1)])]),_:1}),e[11]||(e[11]=o("span",{class:"text-error"},"Falha",-1))])):t.status==="pending"||t.status==="processing"?(n(),i("div",ke,[r(f,{class:"me-1",size:"16",color:"grey"},{default:a(()=>[...e[12]||(e[12]=[u(" mdi-clock-outline ",-1)])]),_:1}),e[13]||(e[13]=o("span",{class:"text-grey"},"-",-1))])):(n(),i("div",be,[r(f,{class:"me-1",size:"16",color:t.issuesFound>0?"warning":"success"},{default:a(()=>[u(d(t.issuesFound>0?"mdi-alert":"mdi-check-circle"),1)]),_:2},1032,["color"]),o("span",null,d(t.issuesFound),1)]))]),o("td",null,[t.status==="failed"?(n(),i("div",we,[r(f,{class:"me-1",size:"16",color:"error"},{default:a(()=>[...e[14]||(e[14]=[u(" mdi-close-circle ",-1)])]),_:1}),e[15]||(e[15]=o("span",{class:"text-error text-caption"},"Falha",-1))])):t.status==="pending"||t.status==="processing"?(n(),i("div",he,[r(A,{indeterminate:"",size:"20",width:"2",color:"primary"}),e[16]||(e[16]=o("span",{class:"ms-2 text-caption text-grey"},"Processando...",-1))])):t.qualityScore?(n(),i("div",Ae,[r(A,{"model-value":t.qualityScore*10,color:t.qualityScore>=8?"success":t.qualityScore>=6?"warning":"error",size:"24",width:"3"},null,8,["model-value","color"]),o("span",Ce,d(t.qualityScore?.toFixed(1)),1)])):(n(),i("span",Se,"N/A"))]),o("td",null,[t.status==="failed"?(n(),i("div",Pe,[r(f,{class:"me-1",size:"16",color:"error"},{default:a(()=>[...e[17]||(e[17]=[u(" mdi-close-circle ",-1)])]),_:1}),e[18]||(e[18]=o("span",{class:"text-error text-caption"},"-",-1))])):t.status==="pending"||t.status==="processing"?(n(),i("div",ze,[r(f,{class:"me-1",size:"16",color:"grey"},{default:a(()=>[...e[19]||(e[19]=[u(" mdi-clock-outline ",-1)])]),_:1}),e[20]||(e[20]=o("span",{class:"text-grey text-caption"},"-",-1))])):t.processingTimeMs?(n(),i("div",Fe,[r(f,{class:"me-1",size:"16",color:"info"},{default:a(()=>[...e[21]||(e[21]=[u(" mdi-timer-outline ",-1)])]),_:1}),o("span",Ne,d(l.formatProcessingTime(t.processingTimeMs)),1)])):(n(),i("span",Te,"N/A"))]),o("td",null,[o("span",Be,d(l.formatDate(t.createdAt)),1)]),o("td",null,[r(B,{icon:"mdi-eye",size:"small",variant:"text",color:"primary",onClick:ee(p=>l.viewAnalysisDetails(t),["stop"])},null,8,["onClick"])])],8,ve))),128))])]),_:1})]),_:1})):(n(),i("div",De,[r(f,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:a(()=>[...e[23]||(e[23]=[u(" mdi-clipboard-search-outline ",-1)])]),_:1}),e[24]||(e[24]=o("h3",{class:"text-h6 text-grey-darken-1 mb-2"}," Nenhuma análise encontrada ",-1)),e[25]||(e[25]=o("p",{class:"text-body-2 text-grey-darken-1"}," Não há análises que correspondam aos filtros selecionados. ",-1))])),l.totalPages>1?(n(),i("div",qe,[r(re,{modelValue:l.currentPage,"onUpdate:modelValue":[e[5]||(e[5]=t=>l.currentPage=t),l.changePage],length:l.totalPages,"total-visible":7},null,8,["modelValue","length"])])):T("",!0)])}const nt=oe(ue,[["render",Re],["__scopeId","data-v-62cdd0a8"],["__file","D:/Development/Projetos/Mira/mira-client/src/views/analyses/AnalysesView.vue"]]);export{nt as default};
